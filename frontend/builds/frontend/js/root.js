(function(e){function t(t){for(var n,r,o=t[0],l=t[1],c=t[2],d=0,u=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&u.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);p&&p(t);while(u.length)u.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],n=!0,r=1;r<i.length;r++){var o=i[r];0!==s[o]&&(n=!1)}n&&(a.splice(t--,1),e=l(l.s=i[0]))}return e}var n={},r={root:0},s={root:0},a=[];function o(e){return l.p+"js/"+({}[e]||e)+".js"}function l(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={"chunk-0126003e":1,"chunk-1205d8a1":1,"chunk-1b959bc8":1,"chunk-224ce980":1,"chunk-35ec7b04":1,"chunk-5226b226":1,"chunk-906ec400":1,"chunk-9a5a2602":1,"chunk-a25c3638":1};r[e]?t.push(r[e]):0!==r[e]&&i[e]&&t.push(r[e]=new Promise((function(t,i){for(var n="css/"+({}[e]||e)+".css",s=l.p+n,a=document.getElementsByTagName("link"),o=0;o<a.length;o++){var c=a[o],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===n||d===s))return t()}var u=document.getElementsByTagName("style");for(o=0;o<u.length;o++){c=u[o],d=c.getAttribute("data-href");if(d===n||d===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||s,a=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=n,delete r[e],p.parentNode.removeChild(p),i(a)},p.href=s;var h=document.getElementsByTagName("head")[0];h.appendChild(p)})).then((function(){r[e]=0})));var n=s[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,i){n=s[e]=[t,i]}));t.push(n[2]=a);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=o(e);var u=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(p);var i=s[e];if(0!==i){if(i){var n=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",u.name="ChunkLoadError",u.type=n,u.request=r,i[1](u)}s[e]=void 0}};var p=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},l.m=e,l.c=n,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(i,n,function(t){return e[t]}.bind(null,n));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/static/frontend/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var p=d;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"0271":function(e,t,i){"use strict";i("b630")},"0469":function(e,t,i){e.exports=i.p+"img/detective-working.gif"},"04b2":function(e,t,i){},"0df4":function(e,t,i){},"0ebf":function(e,t,i){"use strict";i("5e59")},"0fb5":function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var n=i("a026"),r=i("6c44"),s=i("59cf");const a=n["default"].observable({value:s["c"]});function o(){return Object(s["b"])(a)}function l(){return Object(s["d"])(o())}function c(e){a.value=e,Object(r["a"])()&&localStorage.setItem("colorTheme",a.value),l()}},"0fcf":function(e,t,i){},"0fd0":function(e,t,i){"use strict";i("474a")},1:function(e,t){},"140e":function(e,t,i){},"152e":function(e,t,i){},"17ae":function(e,t,i){var n={"./DiscordPlugin":["0f1e","chunk-1b959bc8"],"./DiscordPlugin.vue":["0f1e","chunk-1b959bc8"],"./EmailPlugin":["c308","chunk-a25c3638"],"./EmailPlugin.vue":["c308","chunk-a25c3638"],"./PushbulletPlugin":["1cfc","chunk-0126003e"],"./PushbulletPlugin.vue":["1cfc","chunk-0126003e"],"./PushoverPlugin":["46f8","chunk-5226b226"],"./PushoverPlugin.vue":["46f8","chunk-5226b226"],"./SlackPlugin":["ff58","chunk-906ec400"],"./SlackPlugin.vue":["ff58","chunk-906ec400"],"./TelegramPlugin":["814e","chunk-1205d8a1"],"./TelegramPlugin.vue":["814e","chunk-1205d8a1"],"./TwilioPlugin":["e2bc","chunk-224ce980"],"./TwilioPlugin.vue":["e2bc","chunk-224ce980"]};function r(e){if(!i.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],r=t[0];return i.e(t[1]).then((function(){return i(r)}))}r.keys=function(){return Object.keys(n)},r.id="17ae",e.exports=r},"1c3a":function(e,t,i){e.exports=i.p+"img/moonraker_verification_code.png"},"1d3e":function(e,t,i){"use strict";i("0df4")},"1d76":function(e,t,i){"use strict";i("99bb")},"1f6a":function(e,t,i){e.exports=i.p+"img/mainsail_logo.png"},"1fd9":function(e,t,i){"use strict";i("9193")},"222b":function(e,t,i){e.exports=i.p+"img/octopod.webp"},"25ab":function(e,t,i){"use strict";i("32a2")},"25bf":function(e,t,i){"use strict";i("f74a")},"26a6":function(e,t,i){},2814:function(e,t,i){e.exports=i.p+"img/install_plugin.png"},"28eb":function(e,t,i){},"2e7f":function(e,t,i){e.exports=i.p+"img/octoprint_logo.png"},"30c2":function(e,t,i){},3141:function(e,t,i){"use strict";i("664c")},"32a2":function(e,t,i){},3568:function(e,t,i){"use strict";i("f121")},3840:function(e,t,i){},3890:function(e,t,i){"use strict";i("5116")},3957:function(e,t,i){e.exports=i.p+"img/polymer.webp"},"3cd0":function(e,t,i){},"3ee0":function(e,t,i){e.exports=i.p+"img/printoid.webp"},4432:function(e,t,i){"use strict";i("8e26")},"474a":function(e,t,i){},"49f2":function(e,t,i){},"4bc7":function(e,t,i){},"4de7":function(e,t,i){e.exports=i.p+"img/webpage-multiple.svg"},"4e03":function(e,t,i){e.exports=i.p+"img/plugin_wizard_websetup.png"},"4f95":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"f",(function(){return s})),i.d(t,"e",(function(){return a})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return l}));const n=()=>JSON.parse(document.querySelector("#app-platform-json").text)["platform"],r=()=>""!==n(),s=()=>JSON.parse(document.querySelector("#user-json").text),a=()=>JSON.parse(document.querySelector("#settings-json").text),o=()=>"true"===new URLSearchParams(window.location.search).get("onlyNotifications"),l=()=>"true"===new URLSearchParams(window.location.search).get("onlyName")},5116:function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);var n=i("a026"),r=i("8c4f"),s=i("5886"),a=i("6c44");const o=(e,t)=>{var i=Object(a["a"])()?localStorage.getItem(e):null,n=i||t;try{return JSON.parse(n)}catch(r){return n}},l=(e,t)=>{Object(a["a"])()&&localStorage.setItem(e,t)},c=(e,t,i)=>{let r=document.createElement("div");const s=new n["default"]({render:i=>i(e,{props:t})}).$mount(r);return n["default"].swal({...i,customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:e=>{e.querySelector("#replace-here").replaceWith(s.$el)},onDestroy:()=>{s.$destroy(),r.remove()}})},d=(e,t,i)=>n["default"].swal({...i,customClass:{container:"dark-backdrop"},html:'<div id="replace-here">Placeholder</div>',onBeforeOpen:t=>{t.querySelector("#replace-here").replaceWith(e)}}),u=(e,t)=>{e.use(s["a"],t);const i=e.swal.mixin({title:"Are you sure?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",customClass:{container:"dark-backdrop"}}),n=e.swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3}),r=e.swal.mixin({icon:"error",customClass:{container:"dark-backdrop error-alert"}}),a=e.swal.mixin({customClass:{container:"dark-backdrop"}}),u=(t,i)=>{if(!o(i,!1)){const n={...t,position:"top-end",confirmButtonText:"Gotcha! Don't show this again."};return e.swal(n).then((function(e){e.value&&(l(i,!0),console.log(e))}))}};e.prototype.$swal["openModalWithComponent"]=c,e.prototype.$swal["openModalWithElement"]=d,e.prototype.$swal["Confirm"]=i,e.prototype.$swal["Toast"]=n,e.prototype.$swal["DismissableToast"]=u,e.prototype.$swal["Reject"]=r,e.prototype.$swal["Prompt"]=a};var p={install:u},h=i("5f5b"),f=i("c0eb"),m=i("2ead"),v=i.n(m);n["default"].filter("floor",e=>Math.floor(e));const g=/(?:^|[-_/])(\w)/g,b="root",_="anonymous component",w=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/,y=e=>{const t=w.exec(e);return t?t.slice(1):[]},C=(e,t)=>{let i=y(e)[2];return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},k=e=>{if(!e)return _;if(e.$root===e)return b;if(!e.$options)return _;if(e.$options.name)return e.$options.name;if(e.$options._componentTag)return e.$options._componentTag;if(e.$options.__file){const t=e.$options.__file.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"),i=C(t,".vue");return i.replace(g,(e,t)=>t?t.toUpperCase():"")}return _},S=(e,t,i,n,r,s)=>{let a=0;for(let o in t){if(a+=1,a>s)break;"object"==typeof t[o]?r>n&&S(e,t[o],i+"."+o,n+1,r,s):e[i+"."+o]=t[o]}},P=e=>{const t=e.config.errorHandler;e.config.errorHandler=(i,n,r)=>{if(window.Sentry){const e={};let t=n;if(n._original&&(t=n._original),t)try{e.componentName=k(t),S(e,JSON.parse(JSON.stringify(t.$options.propsData)),"props",0,2,10)}catch(s){console.log("Unable to extract metadata from Vue component.")}r&&(e.lifecycleHook=r),setTimeout(()=>{window.Sentry.getCurrentHub().withScope(t=>{t.setContext("vue",e),window.Sentry.getCurrentHub().captureException(i)})})}"function"===typeof t&&t.call(e,i,n,r),e.util&&e.util.warn(`Error in ${r}: "${i.toString()}"`,n),console.error(i)}};var x=P,T=i("0fb5"),F=i("fc02"),D=i.n(F),I=i("eaf3"),O=i("67b0"),A=(e,t)=>{Object(T["b"])(),x(n["default"]),n["default"].use(r["a"]),n["default"].use(h["a"]),n["default"].use(p),n["default"].use(f["a"]),n["default"].use(v.a),n["default"].use(D.a),n["default"].use(I["a"]),n["default"].use(O["a"]),document.getElementById("app")&&new n["default"]({router:e,components:t}).$mount("#app")},E=(i("13d5"),{email:{displayName:"Email",componentName:"EmailPlugin"},twilio:{displayName:"SMS",componentName:"TwilioPlugin"},pushbullet:{displayName:"Pushbullet",componentName:"PushbulletPlugin"},discord:{displayName:"Discord",componentName:"DiscordPlugin"},telegram:{displayName:"Telegram",componentName:"TelegramPlugin"},pushover:{displayName:"Pushover",componentName:"PushoverPlugin"},slack:{displayName:"Slack",componentName:"SlackPlugin"}});const M={ThemePreferences:"/user_preferences/personalization/",ProfilePreferences:"/user_preferences/profile/",AuthorizedApps:"/user_preferences/authorized_apps/",GeneralNotifications:"/user_preferences/general_notifications/",PushNotifications:"/user_preferences/mobile_push_notifications/"},N=Object.keys(E).reduce((e,t)=>Object.assign(e,{[t]:`/user_preferences/notification_${t}/`}),{});var R={...M,...N};const L={printerWizard:"/printers/wizard/",printerWizardSetup:"/printers/wizard/setup/"};var j=L,B=function(){var e=this,t=e._self._c;return t("b-container",[t("b-row",{staticClass:"justify-content-center"},[e.user?t("b-col",{staticClass:"mt-3",attrs:{lg:"8"}},[0===e.printersToShow.length?t("div",{staticClass:"wizard-container full-on-mobile"},[t("b-container",[t("b-row",[t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3"},[t("svg",{staticClass:"logo-img",attrs:{viewBox:"0 0 1965 240"}},[t("use",{attrs:{href:"#svg-logo-compact"}})])])]),t("b-row",[t("h1",{staticClass:"mx-auto"},[e._v("Welcome To Obico")])]),t("b-row",[t("b-col",[t("hr")])],1),e.isEnt&&e.trialDaysLeft>0?t("b-row",[t("b-col",[e.trialDaysLeft>=29?t("h3",{staticClass:"py-3"},[e._v(" Your 30-Day "),t("a",{staticClass:"link",attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/upgrade-to-pro/"}},[e._v("Pro Plan")]),e._v(" Free Trial Has Started! ")]):t("h3",{staticClass:"py-3"},[e._v(" "+e._s(e.trialDaysLeft)+" Days Left on Your "),t("a",{staticClass:"link",attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/upgrade-to-pro/"}},[e._v("Pro Plan ")]),e._v("Free Trial! ")]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("Unlimited Secure Tunneling to your OctoPrint")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("Premium 25 FPS Webcam Streaming")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("250 AI Failure Detection Hours")])]),t("div",{staticClass:"pb-1"},[t("i",{staticClass:"feature-check fas fa-check-circle"}),t("span",{staticClass:"feature-text"},[e._v("G-Code Remote Upload and Printing")])]),t("div",{staticClass:"lead py-4"},[e._v("OctoPrint has not been linked to your Obico account.")]),t("div",{staticClass:"d-flex flex-column align-center justify-content-center"},[t("div",[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:e.wizardUrl}},[e._v("Link OctoPrint Now")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" It's as easy as 1-2-3. ")])])])])],1):e._e(),t("div",{staticClass:"footer-note small"},[e._v(" Not ready to start yet? "),t("a",{attrs:{href:"mailto:support@obico.io?subject=Please%20pause%20my%20free%20trial"}},[e._v("Email us")]),e._v(" to pause your free trial. ")])],1)],1):t("div",[t("div",{staticClass:"text-center"},[t("svg",{attrs:{width:"100",height:"30"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),e.authorized?t("div",{staticClass:"authorization-successful"},[t("h4",{staticClass:"title"},[e._v("Authorization Successful!")]),t("p",[e._v("You can close this page")])]):t("div",[t("div",[t("div",{staticClass:"lead text-center mt-3 mb-5"},[e._v("Tunnel Access Authorization")]),t("h4",{staticClass:"my-4"},[t("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.appName))]),e._v(" is requesting to access you OctoPrint Tunnel. ")]),t("p",{staticClass:"text-muted"},[t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("OctoPrint Tunnel")]),e._v(" is a secure way provided by "),t("a",{attrs:{href:"https://www.obico.io/",target:"_blank"}},[e._v("Obico")]),e._v(" to remotely access your OctoPrint. With the OctoPrint Tunnel, you can use "+e._s(e.appName)+" to access your OctoPrint from anywhere. ")]),e.user.is_pro?e._e():t("b-alert",{staticClass:"my-3",attrs:{variant:"warning",dismissible:"",show:""}},[t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Tunnel usage of a free account is "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#why-is-the-limit-on-free-account-only-100mb",target:"_blank"}},[e._v("capped at 300MB per month")]),e._v(". You can "),t("a",{attrs:{href:"http://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("upgrade to the Obico app Pro plan for 1 Starbucks a month")]),e._v(" to enjoy unlimited tunnel usage. ")])]),e.user.is_pro&&e.trialDaysLeft>0?t("b-alert",{staticClass:"my-3",attrs:{variant:"warning",dismissible:"",show:""}},[t("div",[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" After the Free trial expires, tunnel data usage will be "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#why-is-the-limit-on-free-account-only-100mb",target:"_blank"}},[e._v("capped at 300MB per month")]),e._v(". You can "),t("a",{attrs:{href:"http://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("upgrade to the Obico app Pro plan for 1 Starbucks a month")]),e._v(" to continue enjoying unlimited tunnel usage. ")])]):e._e(),t("div",{staticClass:"mt-5"},[t("p",{staticClass:"lead"},[e._v(" Tunnel access by "),t("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.appName))]),e._v(" (make sure you trust it): ")]),0===e.printersToShow.length?t("h5",[e._v("You have 0 active printers")]):1===e.printersToShow.length?t("h5",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.printersToShow[0].name)+" ")]):e.printersToShow.length>1?t("select",{directives:[{name:"model",rawName:"v-model",value:e.printerToAuthorize,expression:"printerToAuthorize"}],staticClass:"custom-select",on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.printerToAuthorize=t.target.multiple?i:i[0]}}},[t("option",{attrs:{selected:"",disabled:""},domProps:{value:null}},[e._v("Please select a printer")]),e._l(e.printersToShow,(function(i){return t("option",{key:i.id,domProps:{value:i.id}},[e._v(" "+e._s(i.name)+" ")])}))],2):e._e(),e.printersToShow.length?t("div",{staticClass:"d-flex mt-4 mb-3"},[t("button",{staticClass:"btn btn-primary",staticStyle:{flex:"1"},attrs:{disabled:!e.printerToAuthorize||e.performingAuthRequest},on:{click:e.authorize}},[e.performingAuthRequest?t("b-spinner",{attrs:{small:"",label:"Loading..."}}):t("span",[e._v("Authorize")])],1),t("a",{staticClass:"btn btn-outline-secondary ml-2",staticStyle:{flex:"1"},attrs:{href:"/user_preferences/authorized_apps"}},[e._v("Manage Apps")])]):e._e()])],1),t("div",{staticClass:"mt-4"},[t("p",{staticClass:"text-muted small mb-1"},[e._v("Security notes:")]),t("ul",{staticClass:"text-muted small pl-4"},[t("li",[e._v(" The app can only access the tunnel, not your Obico account info such as your email address. ")]),t("li",[e._v(" The access remains valid until explicitly revoked. You can revoke the access by going to Preferences -> Authorized Apps. ")])])])])])]):t("b-col",{staticClass:"mt-5"},[t("div",[t("b-container",[t("div",{staticClass:"d-flex justify-content-center align-items-center"},[t("img",{staticClass:"logo-icon",attrs:{src:e.appLogo}}),t("h3",[e._v("⇄")]),t("svg",{staticClass:"logo-icon obico"},[t("use",{attrs:{href:"#svg-logo-compact"}})]),t("h3",[e._v("⇄")]),t("img",{staticClass:"logo-icon",attrs:{src:i("2e7f")}})]),t("div",{staticClass:"my-4"},[t("div",{staticClass:"mx-auto text-center"},[t("h4",[e._v("OctoPrint Tunnel")]),t("div",{staticClass:"lead"},[e._v("Powered by Obico")])])]),t("div",{staticClass:"account-details"},[t("p",[e._v(" With the OctoPrint Tunnel by Obico, you can now use "+e._s(e.appName)+" to "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/",target:"_blank"}},[e._v("securely control and monitor your printer from anywhere")]),e._v(". ")]),t("div",{staticClass:"text-muted"},[e._v("Obico Free Account:")]),t("ul",{staticClass:"text-muted"},[t("li",[e._v("Unlimited realtime webcam at 0.1FPS.")]),t("li",[e._v("300MB monthly tunnel data cap (excluding webcam streaming).")]),t("li",[e._v("10 hours/mo AI failure detection.")])]),t("div",{staticClass:"text-muted"},[e._v(" Obico Pro Account ("),t("a",{attrs:{href:"https://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("from $4/mo")]),e._v("): ")]),t("ul",{staticClass:"text-muted"},[t("li",[e._v("Unlimited realtime webcam streaming.")]),t("li",[e._v("Unlimited tunnel data usage.")]),t("li",[e._v("50 hours/mo AI failure detection.")]),t("li",[t("a",{attrs:{href:"https://app.obico.io/ent_pub/pricing/",target:"_blank"}},[e._v("And much more...")])])])]),t("div",[t("div",{staticClass:"my-5 w-100"},[t("a",{staticClass:"btn btn-primary btn-block",attrs:{href:e.loginUrl}},[e._v("SIGN IN ")]),t("div",{staticClass:"text-center pt-3 w-100"},[t("div",{staticClass:"font-weight-light text-muted"},[e._v("- OR -")]),t("a",{staticClass:"btn",attrs:{href:e.signupUrl}},[e._v("SIGN UP")])])])])])],1)])],1)],1)},$=[],U=(i("14d9"),i("bc3a")),z=i.n(U),V=i("c1df"),W=i.n(V),q=i("c7f6"),G=i("9b02"),H=i.n(G),J=i("49d5"),Y=i.n(J),K=i("0e49"),Q=i.n(K);const Z=e=>e?W()(e):null,X={Printing:{key:"printing",title:"Printing..."},Finished:{key:"finished",title:"Finished"},Cancelled:{key:"cancelled",title:"Cancelled"}},ee=e=>{if(e.started_at=Z(e.started_at),e.uploaded_at=Z(e.uploaded_at),e.finished_at=Z(e.finished_at),e.cancelled_at=Z(e.cancelled_at),e.ended_at=Z(e.ended_at),e.ended_at){const t=W.a.duration(e.ended_at.diff(e.started_at));e.duration=t.hours()?t.hours()+"h ":"",e.duration+=t.minutes()+"m"}return e.has_alerts=Boolean(e.alerted_at),e.reviewNeeded=null===e.alert_overwrite&&null!==e.tagged_video_url,e.focusedFeedbackNeeded=e.printshotfeedback_set&&e.printshotfeedback_set.find(e=>null===e.answered_at),e.status=e.ended_at?e.cancelled_at?X.Cancelled:X.Finished:X.Printing,e.printer&&(e.printer=ne(e.printer)),e.g_code_file&&(e.g_code_file=te(e.g_code_file)),e},te=e=>(e.created_at=Z(e.created_at),e.updated_at=Z(e.updated_at),e.deleted=Z(e.deleted),e.filesize=Y()(e.num_bytes),e.print_set&&(e.print_set.map(e=>ee(e)),e.print_set.sort((e,t)=>e.ended_at||t.ended_at?e.ended_at?t.ended_at?e.ended_at>t.ended_at?-1:e.ended_at<t.ended_at?1:0:1:-1:e.started_at>t.started_at?-1:e.started_at<t.started_at?1:0),e.last_print=e.print_set[0],e.failedPrints=e.print_set.filter(e=>e.cancelled_at).length,e.successPrints=e.print_set.filter(e=>e.finished_at).length,e.totalPrints=e.print_set.length),e),ie=e=>(e.created_at=Z(e.created_at),e.updated_at=Z(e.updated_at),e.numItems=e.g_code_file_count+e.g_code_folder_count,e),ne=(e,t)=>{const i={createdAt:function(){return Z(this.created_at)},isOffline:function(){return null===H()(this,"status",null)},isPaused:function(){return H()(this,"status.state.flags.paused",!1)},isDisconnected:function(){return H()(this,"status.state.flags.closedOrError",!0)},isActive:function(){const e=H()(this,"status.state.flags");return Boolean(e&&e.operational&&(!e.ready||e.paused))},inTransientState:function(){return!this.hasError()&&H()(this,"status.state.text","").includes("ing")&&!H()(this,"status.state.text","").includes("Printing")},inUserInteractionRequired:function(){return H()(this,"status.user_interaction_required",!1)},hasError:function(){return H()(this,"status.state.flags.error")||H()(this,"status.state.text","").toLowerCase().includes("error")},isAgentMoonraker:function(){return"moonraker_obico"===H()(this,"agent_name","")},agentDisplayName:function(){return this.isAgentMoonraker()?"Klipper":"OctoPrint"},basicStreamingInWebrtc:function(){return"octoprint_obico"===H()(this,"settings.agent_name","")&&Q()(H()(this,"settings.agent_version","0.0.0"),"2.1.0")||"moonraker_obico"===H()(this,"settings.agent_name","")&&Q()(H()(this,"settings.agent_version","0.0.0"),"0.3.0")},alertUnacknowledged:function(){return H()(this,"current_print.alerted_at")&&W()(H()(this,"current_print.alerted_at")).isAfter(W()(H()(this,"current_print.alert_acknowledged_at")||0))},isPrintable:function(){return!this.isOffline()&&!this.isDisconnected()&&!this.isActive()},printabilityText:function(){return this.isPrintable()?"Ready":"Unavailable"},browsabilityMinPluginVersion:function(){const e="2.3.0",t="1.2.0";return this.isAgentMoonraker()?t:e},isBrowsable:function(){return!(this.isOffline()||!Q()(H()(this,"settings.agent_version","0.0.0"),this.browsabilityMinPluginVersion()))},browsabilityText:function(){return this.isBrowsable()?"Available to browse files":"Unable to browse files"}};return t?(H()(t,"status._ts",-1)>H()(e,"status._ts",H()(t,"status._ts",0))&&delete e.status,{...t,...e,...i}):{...e,...i}},re=e=>(e.created_at=Z(e.created_at),e);var se=i("4f95"),ae=i("222b"),oe=i.n(ae),le=i("ca14"),ce=i.n(le),de=i("3957"),ue=i.n(de),pe=i("3ee0"),he=i.n(pe),fe=i("d1d5"),me=i.n(fe),ve={name:"NewOctoPrintTunnelPage",components:{},data(){return{user:null,printers:[],printerId:null,printerToAuthorize:null,performingAuthRequest:!1,authorized:!1}},computed:{printersToShow(){return this.printerId?this.printers.filter(e=>e.id==this.printerId):this.printers},loginUrl(){return"/accounts/login/?hide_navbar=true&next="+encodeURIComponent(window.location.pathname+window.location.search)},signupUrl(){return"/accounts/signup/?hide_navbar=true&next="+encodeURIComponent(window.location.pathname+window.location.search)},wizardUrl(){return"/printers/wizard/?redirectToTunnelCreation="+encodeURIComponent(window.location.pathname+window.location.search)},appName(){return new URLSearchParams(window.location.search).get("app")||"Unknown App"},trialDaysLeft(){var e,t;return"pro-trial"!==(null===(e=this.user)||void 0===e||null===(t=e.subscription)||void 0===t?void 0:t.plan_id)?-1:W()(this.user.subscription.expired_at).diff(W()(),"days")+1},appLogo(){switch(this.appName.toLowerCase()){case"octopod":return oe.a;case"printoid":return he.a;case"polymer":return ue.a;case"octoapp":return ce.a;default:return me.a}}},created(){this.user=Object(se["f"])();const{IS_ENT:e}=Object(se["e"])();this.isEnt=!!e,this.printerId=new URLSearchParams(window.location.search).get("printer_id"),this.user&&this.fetchPrinters()},methods:{fetchPrinters(){return z.a.get(q["a"].printers()).then(e=>{e.data.forEach(e=>{this.printers.push(ne(e))}),1==this.printersToShow.length&&(this.printerToAuthorize=this.printersToShow[0].id)})},authorize(){this.printersToShow.length&&(this.performingAuthRequest=!0,z.a.post(q["a"].tunnels(),{app_name:this.appName,target_printer_id:this.printerToAuthorize||this.printersToShow[0].id}).then(e=>{this.authorized=!0;const t=e.data.tunnel_endpoint,i=new URLSearchParams(window.location.search).get("success_redirect_url")||"/tunnels/succeeded/";window.location.replace(`${i}?tunnel_endpoint=${t}`)}).catch(e=>{this.performingAuthRequest=!1,this.$swal.Reject.fire({title:"Oops",text:e.message})}))}}},ge=ve,be=(i("6181"),i("2877")),_e=Object(be["a"])(ge,B,$,!1,null,"037fa5fa",null),we=_e.exports,ye=function(){var e=this,t=e._self._c;return t("div",[!e.isPro&&e.usageFetched?t("div",{staticClass:"floating-panel"},[e.showDetails?t("div",{on:{click:function(t){e.showDetails=!1},mouseover:function(t){e.showDetails=!0},mouseleave:function(t){e.showDetails=!1}}},[t("div",{staticClass:"text-muted"},[e._v(" Monthly data usage ("),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/octoprint-tunneling/#is-octoprint-tunneling-free-to-all-users",target:"_blank"}},[e._v("Resets in "+e._s(e.daysUntilReset)+" days")]),e._v(") ")]),t("div",{class:e.usageClass},[e._v("Used "+e._s(e.usageMTD)+" of "+e._s(e.humanizedUsageCap)+".")]),e.overage?t("div",[e._v(" Your month-to-date tunneling usage is over the Free plan limit. "),t("a",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",href:"/ent_pub/pricing/"}},[e._v("Get Unlimited Tunneling")])]):e._e()]):t("div",{class:e.usageClass,on:{click:function(t){e.showDetails=!0},mouseover:function(t){e.showDetails=!0},mouseleave:function(t){e.showDetails=!1}}},[e._v(" "+e._s(e.percentage)+"% ")])]):e._e(),t("div",[e.printerId?t("iframe",{staticClass:"tunnel-iframe",attrs:{src:e.iframeUrl()+"#temp"}}):e._e()])])},Ce=[],ke=i("6625"),Se=i.n(ke),Pe={name:"OctoPrintTunnelPage",components:{},props:{},data:function(){return{bytesMTD:null,usageCap:null,usageFetched:!1,isPro:!0,printerId:null,showDetails:!1}},computed:{usageClass(){return{"text-success":this.bytesMTD<.8*this.usageCap,"text-warning":this.bytesMTD>=.8*this.usageCap&&this.bytesMTD<this.usageCap,"text-danger":this.bytesMTD>=this.usageCap}},usageMTD(){return Y()(this.bytesMTD)},humanizedUsageCap(){return Y()(this.usageCap)},overage(){return this.bytesMTD>=this.usageCap},percentage(){return Math.round(this.bytesMTD/this.usageCap*100)},daysUntilReset(){const e=W()().endOf("month");return e.diff(W()(),"days")+1}},created(){this.isPro=Object(se["f"])().is_pro,this.printerId=Se()(window.location.pathname,"/").slice(-2,-1).pop()},mounted(){const e=Object(a["a"])()?localStorage.getItem("skip-tunneling-warning"):null;"yes"!==e&&(this.$swal.Prompt.fire({html:'\n          <h4 class="text-center p-2">\n            <svg class="menu-icon" style="height: 1.1em; width: 1em; margin-right: 0.75em;">\n              <use href="#svg-octoprint-tunneling" />\n            </svg>\n            OctoPrint Secure Tunnel\n          </h4>\n          <div class="p-1">\n            It may take long time for OctoPrint page to load as it is securely tunneled via the Obico app server.\n          </div>\n          <div class="p-1">\n            <a target="_blank" href="https://www.obico.io/docs/user-guides/octoprint-tunneling/#is-octoprint-tunneling-free-to-all-users">\n            Learn more about OctoPrint Tunneling\'s security and page load speed.\n            <i class="fas fa-external-link-alt"></i>\n          </a>\n        </div>\n        ',input:"checkbox",inputPlaceholder:"Don't show again"},"octoprint-tunnel.warning").then(e=>{e.isConfirmed&&e.value&&Object(a["a"])()&&localStorage.setItem("skip-tunneling-warning","yes")}),window.matchMedia("(pointer:none), (pointer:coarse)")&&document.querySelector(".swal2-popup").classList.add("x150"));const t=this,i=(e=!1)=>{z.a.get(q["a"].tunnelUsage()).then(i=>{t.bytesMTD=i.data.total,t.usageCap=i.data.monthly_cap,e&&(t.usageFetched=!0)})};setInterval(i,15e3),setTimeout(()=>{i(!0)},4e3)},methods:{iframeUrl(){return`/octoprint/${this.printerId}/`}}},xe=Pe,Te=(i("ea12"),i("c15a"),Object(be["a"])(xe,ye,Ce,!1,null,"5f6abe5d",null)),Fe=Te.exports,De=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{attrs:{lg:"8"}},[t("div",{staticClass:"card"},[t("h5",{staticClass:"card-header text-center"},[e._v(" F "),t("i",{staticClass:"fas fa-search focused-feedback-icon"}),e._v("CUSED FEEDBACK ")]),t("loading",{attrs:{active:null===e.print,"is-full-page":!0}}),null!==e.print?t("div",[e.print.access_consented_at?t("div",[t("div",[t("vue-slick-carousel",{ref:"carousel",attrs:{arrows:!0,dots:!0},on:{afterChange:e.onNextShot},scopedSlots:e._u([{key:"customPaging",fn:function(i){return[t("div",{class:e.pageClass(i)},[e._v("•")])]}}],null,!1,3226812120)},e._l(e.shots,(function(i,n){return t("print-shot-card",{key:n,attrs:{shot:i},on:{shotChanged:e.onShotChanged}})})),1)],1)]):t("focused-feedback-consent",{attrs:{print:e.print},on:{"continue-btn-pressed":e.consentBtnPressed}})],1):e._e()],1)])],1)],1)]},proxy:!0}])})},Ie=[],Oe=i("c707"),Ae=i.n(Oe),Ee=i("51f5"),Me=i.n(Ee),Ne=i("a7ab"),Re=i.n(Ne),Le=(i("7b8d"),i("6a2c"),i("9062")),je=i.n(Le),Be=(i("e40d"),function(){var e=this,t=e._self._c;return t("div",[t("img",{staticClass:"card-img-top",attrs:{src:e.shot.image_url}}),t("div",{staticClass:"px-3 pt-4"},[t("b-form-group",{attrs:{label:"Do you see any spaghetti in this picture?"}},[t("b-form-radio-group",{attrs:{options:e.options},on:{change:e.updateShot},model:{value:e.answer,callback:function(t){e.answer=t},expression:"answer"}})],1),e._m(0)],1)])}),$e=[function(){var e=this,t=e._self._c;return t("small",{staticClass:"text-muted"},[e._v(" Not sure? Look at "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work#spaghetti-examples"}},[e._v("some examples. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])}],Ue=i("8226"),ze=i("2924"),Ve={name:"PrintShotCard",components:{BFormGroup:Ue["a"],BFormRadioGroup:ze["a"]},props:{shot:{type:Object,required:!0}},data(){return{answer:this.shot.answer,options:[{text:"Yes",value:"LOOKS_BAD"},{text:"No",value:"LOOKS_OK"},{text:"I am not sure",value:"UNDECIDED"}]}},methods:{updateShot:function(e){z.a.put(q["a"].printShotFeedback(this.shot.id,this.shot.print_id),{answer:e}).then(e=>{const{instance:t,credited_dhs:i}=e.data;i>0?this.$swal.Prompt.fire({title:"You are awesome!",html:"<p>The AI failure detection just got a little better because of your feedback!</p><p>You just earned 2 non-expirable AI Detection Hours - Yay!</p>",confirmButtonText:"I'm done!",showCancelButton:!0,cancelButtonText:"Change feedback"}).then(e=>{e.isConfirmed?window.location.href="/prints/":this.$emit("shotChanged",t)}):this.$emit("shotChanged",t)})}}},We=Ve,qe=Object(be["a"])(We,Be,$e,!1,null,null,null),Ge=qe.exports,He=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-wrapper",class:{collapsed:e.collapsed,"is-in-mobile":e.inMobileWebView,"is-in-popup":e.isPopup}},[t("nav",{staticClass:"side-nav"},[t("a",{staticClass:"sidebar-header",attrs:{href:"/"}},[t("svg",{staticClass:"logo-small"},[t("use",{attrs:{href:"#svg-logo-compact"}})])]),t("ul",{staticClass:"list-unstyled m-0"},[e.isEnt&&!e.user.is_pro?t("li",{class:{active:"/ent_pub/pricing/"===e.path}},[e._m(0)]):e._e(),e.user?t("li",{class:{active:"/printers/"===e.path}},[t("a",{attrs:{href:"/printers/"}},[t("svg",{staticStyle:{"margin-bottom":"5px"},attrs:{width:"1.4em",height:"1.4em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})]),t("br"),e._v(" Printers ")])]):e._e(),e.user?t("li",{class:{active:e.path.includes("/print_history/")||e.path.includes("/prints/")}},[e._m(1)]):e._e(),e.user?t("li",{class:{active:e.path.includes("/g_code_")}},[e._m(2)]):e._e()]),t("div",{staticClass:"side-nav-footer"},[t("ul",{staticClass:"list-unstyled m-0"},[e.isEnt?t("li",{class:{active:"/ent_pub/pricing/"===e.path}},[e._m(3)]):e._e(),e._m(4),e._m(5),e._m(6),e.user?t("li",{class:{active:"/printer_events/"===e.path}},[t("a",{attrs:{href:"/printer_events/"}},[t("i",{staticClass:"fas fa-bell position-relative"},[e.hasUnseenPrinterEvents?t("span",{staticClass:"badge"},[e._v(e._s(e.unseenPrinterEventsDisplay))]):e._e()]),t("span",{staticClass:"trim-text"},[e._v("Notifications")])])]):e._e(),e.user?t("li",{class:{active:"/user_preferences/"===e.path}},[e._m(7)]):e._e()])])]),t("div",{staticClass:"content-wrapper",class:{"hide-top-nav":!e.$slots.topBarLeft&&!e.$slots.topBarRight}},[t("b-navbar",{staticClass:"top-nav"},[t("div",{staticClass:"d-flex align-items-center"},[t("b-button",{staticClass:"shadow-none p-0 mr-3 position-relative toggle-sidebar",attrs:{variant:"_"},on:{click:function(t){e.collapsed=!e.collapsed}}},[t("i",{staticClass:"fas fa-bars position-relative"},[e.hasUnseenPrinterEvents?t("div",{staticClass:"notification-dot"},[t("svg",{attrs:{width:"8px",height:"8px"}},[t("use",{attrs:{href:"#svg-circle-icon"}})])]):e._e()])]),e._t("topBarLeft")],2),e._t("topBarRight")],2),t("div",{staticClass:"page-content"},[e.layoutSections.contentTop?t("content-top"):e._e(),e._t("content")],2)],1),t("div",{staticClass:"content-overlay",on:{click:function(t){e.collapsed=!0}}})])},Je=[function(){var e=this,t=e._self._c;return t("a",{staticClass:"primary",attrs:{href:"/ent_pub/pricing/"}},[t("i",{staticClass:"fas fa-star"}),e._v(" Upgrade to Pro ")])},function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"/print_history/"}},[t("i",{staticClass:"fas fa-history"}),e._v(" Print History ")])},function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"/g_code_folders/cloud/"}},[t("i",{staticClass:"fas fa-file-code"}),e._v(" G-Codes ")])},function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"/ent_pub/pricing/"}},[t("i",{staticClass:"fas fa-dollar-sign"}),e._v(" Pricing ")])},function(){var e=this,t=e._self._c;return t("li",[t("a",{attrs:{href:"https://www.obico.io/help/",target:"_blank"}},[t("i",{staticClass:"fas fa-question"}),e._v(" Help ")])])},function(){var e=this,t=e._self._c;return t("li",[t("a",{attrs:{href:"https://obico.io/discord",target:"_blank"}},[t("i",{staticClass:"fas fa-comments"}),e._v(" Community ")])])},function(){var e=this,t=e._self._c;return t("li",[t("hr",{staticClass:"my-0 mx-2"})])},function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"/user_preferences/"}},[t("i",{staticClass:"fas fa-cog"}),t("span",{staticClass:"trim-text"},[e._v("Preferences")])])}],Ye={},Ke={name:"PageLayout",components:{...Object.keys(Ye).reduce((e,t)=>Object.assign(e,{[t]:Ye[t].importComponent}),{})},props:{isPopup:{type:Boolean,default:!1}},data(){return{layoutSections:Ye,collapsed:!0,path:window.location.pathname,user:null,allowSignUp:!1,isEnt:!1}},computed:{inMobileWebView(){return Object(se["a"])()},hasUnseenPrinterEvents(){return H()(this.user,"unseen_printer_events",0)>0},unseenPrinterEventsDisplay(){const e=H()(this.user,"unseen_printer_events",0);return e>99?"99+":e}},created(){const{ACCOUNT_ALLOW_SIGN_UP:e,IS_ENT:t}=Object(se["e"])();this.allowSignUp=!!e,this.isEnt=!!t,this.user=Object(se["f"])()},mounted(){const e=document.querySelector(".message-snippet");e&&this.inMobileWebView&&e.classList.add("is-in-mobile"),this.inMobileWebView&&(document.querySelector("body").style.paddingBottom=0)}},Qe=Ke,Ze=(i("a499"),i("abc7"),Object(be["a"])(Qe,He,Je,!1,null,"494dbd47",null)),Xe=Ze.exports,et=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-body consent-section"},[t("div",[e._v(" Number of snapshots: "),t("span",{staticClass:"feedback-estimate"},[e._v(e._s(e.print.printshotfeedback_set.length))])]),t("p",[e._v(" Estimated time to finish: "),t("span",{staticClass:"feedback-estimate"},[e._v(e._s(e.estimatedFeedbackTime))])]),e._m(0),t("br"),t("button",{staticClass:"btn btn-primary btn-block",attrs:{disabled:!e.consentChecked,type:"button"},on:{click:function(t){return e.$emit("continue-btn-pressed")}}},[e._v(" Start Focused Feedback ")]),t("br"),t("div",{staticClass:"custom-control custom-checkbox form-check-inline"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.consentChecked,expression:"consentChecked"}],staticClass:"custom-control-input",attrs:{id:"consented-checkbox",type:"checkbox",name:"consented"},domProps:{checked:Array.isArray(e.consentChecked)?e._i(e.consentChecked,null)>-1:e.consentChecked},on:{change:function(t){var i=e.consentChecked,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&(e.consentChecked=i.concat([s])):a>-1&&(e.consentChecked=i.slice(0,a).concat(i.slice(a+1)))}else e.consentChecked=r}}}),e._m(1)]),t("br"),t("div",[t("span",{staticClass:"text-muted"},[e._v("File:")]),e._v(" "+e._s(e.print.filename)+" ")]),t("div",[t("span",{staticClass:"text-muted"},[e._v("Printed:")]),e._v(" "+e._s(e.print.started_at.fromNow())+" ")]),t("br"),e.print.video_url?t("video-box",{attrs:{"video-url":e.print.video_url,"poster-url":e.print.poster_url,"full-screen-btn":!1}}):t("div",[t("detective-working")],1)],1)},tt=[function(){var e=this,t=e._self._c;return t("p",{staticClass:"font-weight-light"},[e._v(" Help Obi get better at detecting failures by giving her in-depth feedback on the snapshots of the print. You will earn "),t("strong",{staticClass:"text-light"},[e._v("2 non-expirable AI Detection Hours")]),e._v(" after you finish this Focused Feedback. "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("Learn more. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"16px"},attrs:{for:"consented-checkbox"}},[e._v(" I grant the Obico app team members the permission to review the time-lapse video of the print shown on this page. "),t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-need-to-grant-permission-to-tsd-team-to-review-your-time-lapse"}},[e._v("Why is this necessary? "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])])}],it=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-top"},[t("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions,playsinline:!0},on:{timeupdate:e.onTimeUpdate}}),t("div",{staticClass:"buttons-container"},[e.downloadBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Download"},on:{click:function(t){return e.$emit("download")}}},[t("i",{staticClass:"fas fa-download",attrs:{"aria-hidden":"true"}})]):e._e(),e.fullscreenBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Full screen"},on:{click:function(t){return e.$emit("fullscreen")}}},[t("i",{staticClass:"fa fa-expand",attrs:{"aria-hidden":"true"}})]):e._e(),e.exitFullscreenBtn?t("a",{staticClass:"action-btn",attrs:{role:"button",title:"Exit full screen"},on:{click:function(t){return e.$emit("exitFullscreen")}}},[t("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})]):e._e()])],1)},nt=[],rt=(i("fda2"),i("d6d3")),st={name:"VideoBox",components:{videoPlayer:rt["videoPlayer"]},props:{videoUrl:{type:String,required:!0},posterUrl:{type:String,default:null},fullscreenBtn:{type:Boolean,default:!0},exitFullscreenBtn:{type:Boolean,default:!1},downloadBtn:{type:Boolean,default:!1},fluid:{type:Boolean,default:!0},autoplay:{type:Boolean,default:!1},defaultFullScreenToggle:{type:Boolean,default:!1}},computed:{playerOptions(){return{muted:!0,preload:"none",language:"en",playbackRates:[.5,1,1.5,2],fluid:this.fluid,fill:!this.fluid,autoplay:this.autoplay,sources:[{type:"video/mp4",src:this.videoUrl}],controlBar:{fullscreenToggle:this.defaultFullScreenToggle},poster:this.posterUrl}}},methods:{onTimeUpdate(e){this.$emit("timeupdate",e.currentTime()/e.duration())}}},at=st,ot=(i("58d0"),Object(be["a"])(at,it,nt,!1,null,"10df198e",null)),lt=ot.exports,ct=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card bg-dark text-white"},[t("img",{staticClass:"card-img",attrs:{src:i("0469"),alt:"Obi is still working"}}),e._m(0)])},dt=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-overlay",staticStyle:{"background-color":"rgba(0, 0, 0, 0.6)"}},[t("h5",{staticClass:"card-title text-center"},[e._v("Obi is still busy working on your time-lapse")])])}],ut={name:"DetectiveWorking"},pt=ut,ht=(i("9675"),Object(be["a"])(pt,ct,dt,!1,null,"f48a916e",null)),ft=ht.exports,mt={name:"FocusedFeedbackConsent",components:{VideoBox:lt,DetectiveWorking:ft},props:{print:{type:Object,required:!0}},data(){return{consentChecked:!1}},computed:{estimatedFeedbackTime(){const e=12*this.print.printshotfeedback_set.length;return e<60?e+" seconds":W.a.duration(e,"seconds").humanize()}}},vt=mt,gt=(i("0ebf"),Object(be["a"])(vt,et,tt,!1,null,"1bb94a58",null)),bt=gt.exports,_t={name:"PrintShotFeedbackApp",components:{FocusedFeedbackConsent:bt,Loading:je.a,PrintShotCard:Ge,VueSlickCarousel:Re.a,PageLayout:Xe},props:{config:{default:()=>{},type:Object}},data:function(){return{shots:[],currentShot:0,print:null}},computed:{},mounted(){this.fetchData()},methods:{fetchData(){z.a.get(q["a"].print(this.config.printId)).then(e=>{this.print=ee(e.data),this.shots=Ae()(this.print.printshotfeedback_set,"id")})},updatePrint(e){z.a.patch(q["a"].print(this.print.id),e).then(e=>this.print=e.data)},consentBtnPressed(){this.updatePrint({access_consented_at:W()()})},onShotChanged(e){const t=Me()(this.shots,t=>t.id==e.id);this.$set(this.shots,t,e),this.$refs.carousel.next()},onNextShot(e){this.currentShot=e},pageClass(e){return e===this.currentShot?"page-visiting":this.shots[e].answered_at?"text-success":"page-unvisited"}}},wt=_t,yt=(i("4432"),Object(be["a"])(wt,De,Ie,!1,null,"798e9044",null)),Ct=yt.exports,kt=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("cascaded-dropdown",{attrs:{"menu-options":e.menuOptions,"menu-selections":e.menuSelections},on:{menuSelectionChanged:e.menuSelectionChanged}})],1)]},proxy:!0},{key:"content",fn:function(){return[e.shouldShowFilterWarning?t("a",{staticClass:"active-filter-notice",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onShowAllClicked.apply(null,arguments)}}},[t("div",{staticClass:"filter"},[t("i",{staticClass:"fas fa-filter mr-2"}),e._v(" "+e._s(e.activeFiltering)+" ")]),t("div",{staticClass:"action-btn"},[e._v("SHOW ALL")])]):e._e(),t("b-container",[t("b-row",[e.prints.length?t("b-col",[e._l(e.prints,(function(e){return t("print-history-item",{key:e.id,staticClass:"print-item",attrs:{print:e}})})),t("mugen-scroll",{attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?e._e():t("div",{staticClass:"text-center p-4"},[t("b-spinner",{attrs:{label:"Loading..."}})],1)])],2):t("b-col",[e._v(" Not found ")])],1)],1)]},proxy:!0}])})},St=[],Pt=i("996c"),xt=i.n(Pt),Tt=function(){var e=this,t=e._self._c;return t("div",[null===e.menuExpanded?e._l(e.menuOptions,(function(i,n){return t("b-dropdown-item",{key:n},[t("div",{staticClass:"d-flex justify-content-between clickable-area",on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.menuExpanded=n}}},[t("div",[t("i",{class:i.iconClass}),e.activeItems[n]?t("span",[e._v(" "+e._s(e.activeItems[n].title)+" "),e.activeItems[n].iconClass?t("i",{class:e.activeItems[n].iconClass}):e._e()]):t("span",[e._v(" "+e._s(n)+" ")])]),t("div",[t("i",{staticClass:"fas fa-chevron-right m-0"})])])])})):e._e(),null!==e.menuExpanded?[t("b-dropdown-item",[t("div",{staticClass:"clickable-area",on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.menuExpanded=null}}},[t("i",{staticClass:"fas fa-chevron-left"}),e._v("Back ")])]),e._l(e.menuOptions[e.menuExpanded].options,(function(i){return t("b-dropdown-item",{key:i.value},[t("div",{staticClass:"clickable-area",on:{click:function(t){return e.onSelected(i)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.menuSelections[e.menuExpanded]===i.value?"visible":"hidden"}}),e._v(" "+e._s(i.title)+" "),i.iconClass?t("i",{class:i.iconClass}):e._e()])])}))]:e._e()],2)},Ft=[],Dt={name:"CascadedDropdown",props:{menuOptions:{type:Object,required:!0},menuSelections:{type:Object,required:!0}},data:function(){return{menuExpanded:null}},computed:{activeItems(){let e={};for(const t of Object.keys(this.menuSelections))e[t]=this.menuOptions[t].options.find(e=>e.value===this.menuSelections[t]);return e}},methods:{onSelected(e){this.$emit("menuSelectionChanged",this.menuExpanded,e),this.menuExpanded=null}}},It=Dt,Ot=Object(be["a"])(It,Tt,Ft,!1,null,null,null),At=Ot.exports,Et=function(){var e=this,t=e._self._c;return t("div",{staticClass:"print-container",on:{click:e.openPrint}},[t("div",{staticClass:"status-indicator",class:e.print.status.key}),t("div",{staticClass:"main-content overflow-truncated-parent"},[t("div",{staticClass:"top"},[t("div",{staticClass:"title overflow-truncated"},[e._v(e._s(e.print.filename))])]),t("div",{staticClass:"bottom"},[t("div",{staticClass:"info"},[t("svg",{staticClass:"icon",attrs:{width:"1em",height:"1em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})]),t("span",[e._v(e._s(e.print.printer?e.print.printer.name:"Unavailable"))])]),t("div",{staticClass:"info"},[t("i",{staticClass:"far fa-clock icon"}),e.print.ended_at?t("span",[e._v(e._s(e.print.ended_at.fromNow()))]):t("span",[e._v("Printing...")])]),e.print.reviewNeeded||e.print.focusedFeedbackNeeded?t("div",{staticClass:"info feedback-info",class:{focused:e.print.focusedFeedbackNeeded}},[e.print.reviewNeeded?t("span",[e._v("Review needed")]):t("span",[e._v("Focused feedback needed")])]):e._e()])]),e.print.poster_url?t("div",{staticClass:"poster"},[t("div",{staticClass:"img",style:{backgroundImage:`url(${e.print.poster_url})`}})]):e._e()])},Mt=[],Nt={name:"PrintHistoryItem",components:{},props:{print:{type:Object,required:!0}},data:function(){return{PrintStatus:X}},methods:{openPrint(){window.location.assign(`/prints/${this.print.id}/`)}}},Rt=Nt,Lt=(i("0271"),Object(be["a"])(Rt,Et,Mt,!1,null,"6c4169a8",null)),jt=Lt.exports;const Bt={filtering:"prints-filtering",sorting:"prints-sorting"},$t=24;var Ut={name:"PrintHistoryPage",components:{MugenScroll:xt.a,PageLayout:Xe,CascadedDropdown:At,PrintHistoryItem:jt},data:function(){return{prints:[],loading:!1,noMoreData:!1,menuSelections:{"Sort By":o(Bt.sorting,"date_desc"),"Filter By":o(Bt.filtering,"none")},menuOptions:{"Sort By":{iconClass:"fas fa-sort-amount-up",options:[{value:"date_asc",title:"Sort By Date",iconClass:"fas fa-long-arrow-alt-up"},{value:"date_desc",title:"Sort By Date",iconClass:"fas fa-long-arrow-alt-down"}]},"Filter By":{iconClass:"fas fa-filter",options:[{value:"none",title:"All"},{value:"finished",title:"Succeeded"},{value:"cancelled",title:"Cancelled"},{value:"need_alert_overwrite",title:"Review Needed"},{value:"need_print_shot_feedback",title:"Focused-Review Needed"}]}}}},computed:{shouldShowFilterWarning(){return"none"!==this.menuSelections["Filter By"]},activeFiltering(){const e=this.menuOptions["Filter By"].options.filter(e=>e.value===this.menuSelections["Filter By"]);return e.length?e[0].title:null}},created(){this.refetchData()},methods:{fetchMoreData(){this.noMoreData||(this.loading=!0,z.a.get(q["a"].prints(),{params:{start:this.prints.length,limit:$t,filter:this.menuSelections["Filter By"],sorting:this.menuSelections["Sort By"]}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<$t,this.prints.push(...e.data.map(e=>ee(e)))}).catch(e=>{this.$swal.Reject.fire({title:"Error",text:e.message})}))},refetchData(){this.prints=[],this.selectedPrintIds=new Set,this.noMoreData=!1,this.fetchMoreData()},onSelectedChanged(e,t){const i=new Set(this.selectedPrintIds);t?i.add(e):i.delete(e),this.selectedPrintIds=i},menuSelectionChanged(e,t){this.$set(this.menuSelections,e,t.value);const i="Sort By"===e?Bt.sorting:Bt.filtering;l(i,t.value),this.refetchData()},onShowAllClicked(){this.$set(this.menuSelections,"Filter By","none"),l(Bt.filtering,"none"),this.refetchData()}}},zt=Ut,Vt=(i("ff7a"),Object(be["a"])(zt,kt,St,!1,null,"e328846e",null)),Wt=Vt.exports,qt=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[t("div",{staticClass:"actions-with-selected-desktop"},[t("b-form-group",{staticClass:"m-0"},[t("b-form-checkbox",{attrs:{size:"lg"},model:{value:e.allPrintsSelected,callback:function(t){e.allPrintsSelected=t},expression:"allPrintsSelected"}})],1),t("div",[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.selectedPrintIds.size,expression:"!selectedPrintIds.size"}],staticClass:"label",on:{click:function(t){e.allPrintsSelected=!e.allPrintsSelected}}},[e._v("Select all")]),t("b-dropdown",{directives:[{name:"show",rawName:"v-show",value:e.selectedPrintIds.size,expression:"selectedPrintIds.size"}],attrs:{"toggle-class":"btn btn-sm actions-with-selected-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(" "+e._s(e.selectedPrintIds.size)+" item"+e._s(1===e.selectedPrintIds.size?"":"s")+" selected... ")]},proxy:!0}])},[t("b-dropdown-item",[t("div",{staticClass:"text-danger",on:{click:e.onDeleteBtnClick}},[t("i",{staticClass:"far fa-trash-alt"}),e._v("Delete ")])])],1)],1)],1)]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",[t("a",{staticClass:"btn shadow-none icon-btn d-none d-md-inline",attrs:{href:"/prints/upload/",title:"Upload Time-Lapse"}},[t("i",{staticClass:"fas fa-upload"})]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("b-dropdown-item",{staticClass:"d-md-none",attrs:{href:"/prints/upload/"}},[t("i",{staticClass:"fas fa-upload"}),e._v("Upload Time-Lapse ")]),t("b-dropdown-divider",{staticClass:"d-md-none"}),t("cascaded-dropdown",{attrs:{"menu-options":e.menuOptions,"menu-selections":e.menuSelections},on:{menuSelectionChanged:e.menuSelectionChanged}})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[e.shouldShowFilterWarning?t("a",{staticClass:"active-filter-notice",on:{click:e.onShowAllClicked}},[t("div",{staticClass:"filter"},[t("i",{staticClass:"fas fa-filter mr-2"}),e._v(" "+e._s(e.activeFiltering)+" ")]),t("div",[e._v("SHOW ALL")])]):e._e(),t("b-container",[t("b-row",{directives:[{name:"show",rawName:"v-show",value:e.prints.length,expression:"prints.length"}],staticClass:"print-cards"},e._l(e.visiblePrints,(function(i){return t("print-card",{key:i.id,attrs:{print:i,selected:e.selectedPrintIds.has(i.id)},on:{selectedChanged:e.onSelectedChanged,printDeleted:e.onPrintDeleted,printDataChanged:e.printDataChanged,fullscreen:e.openFullScreen}})})),1),t("mugen-scroll",{staticClass:"text-center p-4",attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?t("div",{staticClass:"text-center p-2"},[e._v("No more time-lapses.")]):e._e(),e.noMoreData?e._e():t("b-spinner",{attrs:{label:"Loading..."}})],1),t("b-modal",{attrs:{id:"tl-fullscreen-modal",size:"full","hide-header":!0,"hide-footer":!0},on:{hidden:e.fullScreenClosed}},[t("FullScreenPrintCard",{attrs:{print:e.fullScreenPrint,"video-url":e.fullScreenPrintVideoUrl,autoplay:!0}})],1)],1)]},proxy:!0}])})},Gt=[],Ht=i("dd61"),Jt=i.n(Ht),Yt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 print-card"},[t("div",{staticClass:"card vld-parent"},[e.isPublic?t("div",{staticClass:"card-header"},[e._v("- By "+e._s(e.print.creator_name))]):t("div",{staticClass:"card-header"},[t("div",{style:{visibility:e.hasSelectedChangedListener?"visible":"hidden"}},[t("b-form-checkbox",{staticClass:"text-decoration-none",attrs:{size:"lg"},model:{value:e.isSelected,callback:function(t){e.isSelected=t},expression:"isSelected"}})],1),t("b-form-radio-group",{attrs:{buttons:"","button-variant":"outline-primary",name:"radio-btn-outline"},model:{value:e.selectedCardView,callback:function(t){e.selectedCardView=t},expression:"selectedCardView"}},[t("b-form-radio",{staticClass:"no-corner no-shadow",attrs:{value:"detective",disabled:!e.canShowDetectiveView}},[t("i",{staticClass:"fas fa-balance-scale"})]),t("b-form-radio",{staticClass:"no-corner no-shadow",attrs:{value:"info"}},[t("i",{staticClass:"fas fa-info"})])],1),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[e.print.video_url&&!e.print.video_archived_at?t("b-dropdown-item",{attrs:{href:e.print.video_url,target:"_blank"}},[t("i",{staticClass:"fas fa-download"}),e._v("Download Original Time-lapse ")]):e._e(),e.print.tagged_video_url&&!e.print.video_archived_at?t("b-dropdown-item",{attrs:{href:e.print.tagged_video_url,target:"_blank"}},[t("i",{staticClass:"fas fa-download"}),e._v("Download Detective Time-lapse ")]):e._e(),t("b-dropdown-divider"),t("b-dropdown-item",{on:{click:e.deleteVideo}},[t("span",{staticClass:"text-danger"},[t("i",{staticClass:"fas fa-trash-alt"}),e._v("Delete ")])])],1)],1),t("div",[e.print.video_archived_at?t("div",{staticClass:"position-relative"},[t("div",{staticClass:"poster-placeholder-wrapper"},[t("svg",{staticClass:"poster-placeholder"},[t("use",{attrs:{href:e.posterSrc}})])]),t("div",{staticClass:"archived-info"},[t("div",{staticClass:"text"},[e._v(" Video file is deleted. "),t("a",{attrs:{href:"#"},on:{click:function(t){return e.showVideoArchivedDescription(t)}}},[e._v("Why?")])])])]):t("div",[e.videoUrl?t("video-box",{attrs:{"video-url":e.videoUrl,"poster-url":e.print.poster_url,fluid:!0,"fullscreen-btn":e.hasFullscreenListener},on:{timeupdate:e.onTimeUpdate,fullscreen:function(t){return e.$emit("fullscreen",e.print.id,e.videoUrl)}}}):t("div",[t("detective-working")],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"info"==e.cardView&&!e.isPublic,expression:"cardView == 'info' && !isPublic"}]},[t("div",{staticClass:"card-body"},[t("div",{staticClass:"container"},[t("div",{staticClass:"row"},[e._m(0),t("div",{staticClass:"col-8"},[e._v(e._s(e.print.filename))])]),t("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"row",attrs:{title:e.humanizedPrintedOrUploadedTime(e.longFormat=!0)}},[t("div",{staticClass:"text-muted col-4"},[e._v(" "+e._s(e.wasTimelapseUploaded?"Uploaded":"Printed")+" "),t("span",{staticClass:"float-right"},[e._v(":")])]),t("div",{staticClass:"col-8"},[e._v(e._s(e.humanizedPrintedOrUploadedTime())+" "+e._s(e.endStatus))])]),!e.wasTimelapseUploaded&&e.duration?t("div",{staticClass:"row",attrs:{id:"dur-"+e.print.id}},[t("b-tooltip",{attrs:{target:"dur-"+e.print.id,triggers:"hover"}},[e._v(" "+e._s(e._f("floor")(e._f("duration")(e.duration,"asHours")))+":"+e._s(e._f("duration")(e.duration,"minutes"))+":"+e._s(e._f("duration")(e.duration,"seconds"))+" ")]),e._m(1),t("div",{staticClass:"col-8"},[e._v(e._s(e.duration.humanize()))])],1):e._e()])])]),e.isPublic?t("div",{staticClass:"bg-warning alert-banner text-center",style:{opacity:e.normalizedP>.4?1:0}},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Possible failure detected! ")]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:"detective"==e.cardView||e.isPublic,expression:"cardView == 'detective' || isPublic"}]},[e.print.prediction_json_url?t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}}):e._e(),e.isPublic?e._e():t("div",{staticClass:"feedback-section"},[t("div",{staticClass:"text-center py-2 px-3"},[t("div",{staticClass:"lead",class:[e.print.alerted_at?"text-danger":"text-success"]},[e._v(" "+e._s(e.print.alerted_at?"Failure detected":"No failure detected")+" ")]),t("div",{staticClass:"py-2"},[e._v(" Did we get it right? "),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedUp?"primary":"outline"},on:{click:e.onThumbUpClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-up"})],1),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedDown?"primary":"outline"},on:{click:e.onThumbDownClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-down"})],1)],1),t("transition",{attrs:{name:"bounce"}},[e.focusedFeedbackEligible?t("div",{staticClass:"pt-2"},[t("a",{staticClass:"btn btn-sm btn-outline-primary px-4",attrs:{role:"button",href:e.focusedFeedbackLink}},[e._v(" F "),t("i",{staticClass:"fas fa-search focused-feedback-icon"}),e._v("CUSED FEEDBACK "),e.focusedFeedbackCompleted?e._e():t("svg",{staticClass:"seg-control-icon ml-1 double-hours-icon"},[t("use",{attrs:{href:"#svg-hour-double"}})])])]):e._e()])],1),t("div",{staticClass:"text-muted py-2 px-3 help-text"},[e.focusedFeedbackEligible?t("small",[e.focusedFeedbackCompleted?t("span",[e._v("Thank you for completing the Focused Feedback. You have earned 2 non-expirable AI Detection Hours. You can click the button again to change your feedback.")]):t("span",[e._v(" With Focused Feedback, you can tell us exactly where we got it wrong. This is the most effective way to help us improve. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-earn-detective-hours-for-giving-focused-feedback"}},[e._v("You will earn 2 AI Detection Hours once you finish the Focused Feedback")]),e._v(". ")])]):t("small",[e._v(" Every time you give us feedback, "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("you help us get better at detecting failures")]),e._v(". ")])])])],1)])])])},Kt=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-muted col-4"},[e._v(" File "),t("span",{staticClass:"float-right"},[e._v(":")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-muted col-4"},[e._v(" Duration "),t("span",{staticClass:"float-right"},[e._v(":")])])}],Qt=i("9380"),Zt=i.n(Qt),Xt=i("b279"),ei=function(){var e=this,t=e._self._c;return t("div",{staticClass:"obico-gauge-container"},[t("span",{style:{color:e.titleColor},attrs:{id:"title"}},[e._v(e._s(e.titleText))]),t("div",{staticClass:"obico-gauge"},[t("radial-gauge",{attrs:{value:e.value,options:e.computedOptions}})],1),t("hr")])},ti=[],ii=i("7489"),ni=i("59cf"),ri={name:"FailureDetectionGauge",components:{RadialGauge:ii["a"]},props:{normalizedP:{type:Number,required:!0},isWatching:{type:Boolean,default:!0},options:{type:Object,default:null}},computed:{computedOptions(){if(null!==this.options)return this.options;const e={highlight1:Object(T["a"])()===ni["a"].Light?"#929292":"#8395a7",highlight2:Object(T["a"])()===ni["a"].Light?"#b7b7b7":"#a8bacc",highlight3:Object(T["a"])()===ni["a"].Light?"#7b7b7b":"#6c7e90",needle:Object(T["a"])()===ni["a"].Light?"#2d3e4f":"#ffffff"};return{valueDec:0,valueInt:0,width:240,height:240,units:!1,box:!1,minValue:0,maxValue:100,majorTicks:["","","",""],minorTicks:4,highlights:[{from:0,to:33,color:this.isWatching?"#5cb85c":e.highlight1},{from:33,to:67,color:this.isWatching?"#f0ad4e":e.highlight2},{from:67,to:100,color:this.isWatching?"#d9534f":e.highlight3}],colorPlate:"rgba(255,255,255,.0)",colorTitle:"#5cb85c",colorStrokeTicks:"#EBEBEB",colorNeedleEnd:this.isWatching?"rgba(255, 160, 122, .9)":e.needle,colorNeedle:this.isWatching?"rgba(240, 128, 128, 1)":e.needle,colorNeedleShadowUp:this.isWatching?"rgba(2,255,255,0.2)":e.needle,valueBox:!1,animationRule:"bounce",animationDuration:500,animatedValue:!0,startAngle:90,ticksAngle:180,borders:!1}},value(){return 100*this.normalizedP},titleText(){switch(this.level()){case 0:return"Looking Good";case 1:return"Fishy...";case 2:return"Failing!";default:return"Looking Good"}},titleColor(){switch(this.level()){case 0:return"#5cb85c";case 1:return"#f0ad4e";case 2:return"#d9534f";default:return"#5cb85c"}}},methods:{level(){return this.value>66?2:this.value>33?1:0}}},si=ri,ai=(i("0fd0"),Object(be["a"])(si,ei,ti,!1,null,"c291e2d4",null)),oi=ai.exports,li={name:"PrintCard",components:{VideoBox:lt,FailureDetectionGauge:oi,DetectiveWorking:ft},props:{print:{type:Object,required:!0},isPublic:{type:Boolean,default:!1},selected:{type:Boolean,default:!1}},data:function(){return{ALERT_THRESHOLD:.4,currentPosition:0,predictions:[],selectedCardView:"detective",inflightAlertOverwrite:null,isSelected:this.selected}},computed:{wasTimelapseUploaded(){return null!==this.print.uploaded_at},endStatus(){return this.print.cancelled_at?"(Cancelled)":""},duration(){return this.print.ended_at&&this.print.started_at?W.a.duration(this.print.ended_at.diff(this.print.started_at)):null},canShowDetectiveView(){return null!==this.print.prediction_json_url&&null!==this.print.tagged_video_url||!!(this.print.uploaded_at&&W()().diff(this.print.uploaded_at,"hours")<24)},cardView(){return this.canShowDetectiveView?this.selectedCardView:"info"},videoUrl(){return"info"==this.cardView?this.print.video_url:this.print.tagged_video_url},thumbedUp(){return!!this.print.alert_overwrite&&this.print.has_alerts^"NOT_FAILED"===this.print.alert_overwrite},thumbedDown(){return!!this.print.alert_overwrite&&this.print.has_alerts^"FAILED"===this.print.alert_overwrite},focusedFeedbackEligible(){return this.print.printshotfeedback_set.length>0&&this.print.alert_overwrite},focusedFeedbackCompleted(){return this.print.printshotfeedback_set.length>0&&0==Zt()(this.print.printshotfeedback_set,e=>!e.answered_at).length},focusedFeedbackLink(){return`/prints/shot-feedback/${this.print.id}/`},hasSelectedChangedListener(){return Boolean(this.$listeners&&this.$listeners.selectedChanged)},hasFullscreenListener(){return Boolean(this.$listeners&&this.$listeners.fullscreen)},normalizedP(){return Object(Xt["c"])(this.predictions,this.currentPosition,this.isPublic)},posterSrc(){return this.print.poster_url||"#svg-3d-printer"}},watch:{isSelected(e){this.$emit("selectedChanged",this.print.id,e)}},mounted(){this.print.prediction_json_url&&this.fetchPredictions(),this.print.tagged_video_url||(this.selectedCardView="info")},methods:{onTimeUpdate(e){this.currentPosition=e},deleteVideo(){z.a.delete(q["a"].print(this.print.id)).then(()=>{this.$emit("printDeleted",this.print.id)})},onThumbUpClick(){this.inflightAlertOverwrite=this.print.has_alerts?"FAILED":"NOT_FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},onThumbDownClick(){this.inflightAlertOverwrite=this.print.has_alerts?"NOT_FAILED":"FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},alertOverwrite(e){z.a.patch(q["a"].print(this.print.id),{alert_overwrite:e}).then(e=>{this.$emit("printDataChanged",e.data),this.inflightAlertOverwrite=null})},fetchPredictions(){z.a.get(this.print.prediction_json_url).then(e=>{this.predictions=e.data})},humanizedPrintedOrUploadedTime(e=!1){if(!this.print.uploaded_at&&!this.print.ended_at)return"-";const t=this.wasTimelapseUploaded?this.print.uploaded_at:this.print.ended_at;return e?t.format("LLLL"):t.fromNow()},showVideoArchivedDescription(e){e.preventDefault(),this.$swal.Prompt.fire({title:"Time-lapse video deleted",html:'\n          <p>Time-lapse videos older than 6-months are deleted from the Obico app server as they are rarely needed and cost significant amount to store in the cloud.</p>\n          <p>If you are a Pro subscriber and you don\'t want your time-lapse videos to be deleted, please <a href="mailto:support@obico.io?subject=Please%20keep%20my%20timelapse%20videos">contact us</a>.</p>\n          ',showCloseButton:!0})}}},ci=li,di=(i("7a9c"),Object(be["a"])(ci,Yt,Kt,!1,null,"3c97968b",null)),ui=di.exports,pi=function(){var e=this,t=e._self._c;return t("div",[t("video-box",{attrs:{"video-url":e.videoUrl,"poster-url":e.print.poster_url,fluid:!1,autoplay:e.autoplay,"fullscreen-btn":!1},on:{timeupdate:e.onTimeUpdate}}),e.isPublic?t("div",{staticClass:"bg-warning alert-banner text-center",style:{opacity:e.normalizedP>.4?1:0}},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Possible failure detected! ")]):e._e(),t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}})],1)},hi=[],fi={name:"FullScreenPrintCard",components:{VideoBox:lt,FailureDetectionGauge:oi},props:{print:{type:Object,required:!0},videoUrl:{type:String,required:!0},initialPosition:{type:Number,default:()=>0},autoplay:{type:Boolean,default:()=>!1},isPublic:{type:Boolean,default:!1}},data(){return{currentPosition:0,predictions:[]}},computed:{normalizedP(){return Object(Xt["c"])(this.predictions,this.currentPosition,this.isPublic)}},mounted(){this.print.prediction_json_url&&this.fetchPredictions()},methods:{onTimeUpdate(e){this.currentPosition=e},fetchPredictions(){z.a.get(this.print.prediction_json_url).then(e=>{this.predictions=e.data})}}},mi=fi,vi=(i("6892"),Object(be["a"])(mi,pi,hi,!1,null,"749e3f52",null)),gi=vi.exports;const bi={filtering:"prints-filtering",sorting:"prints-sorting"},_i=6;var wi={name:"PrintsPage",components:{MugenScroll:xt.a,PrintCard:ui,FullScreenPrintCard:gi,PageLayout:Xe,CascadedDropdown:At},data:function(){return{prints:[],selectedPrintIds:new Set,loading:!1,noMoreData:!1,fullScreenPrint:null,fullScreenPrintVideoUrl:null,menuSelections:{"Sort By":o(bi.sorting,"date_desc"),"Filter By":o(bi.filtering,"none")},menuOptions:{"Sort By":{iconClass:"fas fa-sort-amount-up",options:[{value:"date_asc",title:"Sort By Date",iconClass:"fas fa-long-arrow-alt-up"},{value:"date_desc",title:"Sort By Date",iconClass:"fas fa-long-arrow-alt-down"}]},"Filter By":{iconClass:"fas fa-filter",options:[{value:"none",title:"All"},{value:"finished",title:"Succeeded"},{value:"cancelled",title:"Cancelled"},{value:"need_alert_overwrite",title:"Review Needed"},{value:"need_print_shot_feedback",title:"Focused-Review Needed"}]}}}},computed:{visiblePrints(){return this.prints.filter(e=>e.ended_at)},allPrintsSelected:{get:function(){return this.selectedPrintIds.size>=this.prints.length&&0!==this.prints.length},set:function(e){this.selectedPrintIds=e?new Set(Jt()(this.prints,"id")):new Set}},shouldShowFilterWarning(){return"none"!==this.menuSelections["Filter By"]},activeFiltering(){const e=this.menuOptions["Filter By"].options.filter(e=>e.value===this.menuSelections["Filter By"]);return e.length?e[0].title:null}},created(){this.refetchData()},methods:{fetchMoreData(){this.noMoreData||(this.loading=!0,z.a.get(q["a"].prints(),{params:{start:this.prints.length,limit:_i,filter:this.menuSelections["Filter By"],sorting:this.menuSelections["Sort By"]}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<_i,this.prints.push(...e.data.map(e=>ee(e)))}))},refetchData(){this.prints=[],this.selectedPrintIds=new Set,this.noMoreData=!1,this.fetchMoreData()},onSelectedChanged(e,t){const i=new Set(this.selectedPrintIds);t?i.add(e):i.delete(e),this.selectedPrintIds=i},menuSelectionChanged(e,t){this.$set(this.menuSelections,e,t.value);const i="Sort By"===e?bi.sorting:bi.filtering;l(i,t.value),this.refetchData()},onDeleteBtnClick(){const e=Array.from(this.selectedPrintIds);this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${this.selectedPrintIds.size} print(s)? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&z.a.post(q["a"].printsBulkDelete(),{print_ids:e}).then(()=>{e.forEach(e=>this.onPrintDeleted(e,!1)),this.$swal.Toast.fire({title:e.length+" time-lapse(s) deleted!"}),this.selectedPrintIds=new Set})})},onPrintDeleted(e,t=!0){const i=Me()(this.prints,t=>t.id==e),n=this.prints[i];this.$delete(this.prints,i),t&&this.$swal.Toast.fire({title:`Time-lapse ${n.filename} deleted!`})},printDataChanged(e){const t=Me()(this.prints,t=>t.id==e.id);this.$set(this.prints,t,ee(e))},openFullScreen(e,t){const i=Me()(this.prints,t=>t.id==e);-1!=i&&(this.fullScreenPrint=this.prints[i],this.fullScreenPrintVideoUrl=t,this.$bvModal.show("tl-fullscreen-modal"))},fullScreenClosed(){this.fullScreenPrint=null,this.fullScreenPrintVideoUrl=null},onShowAllClicked(){this.$set(this.menuSelections,"Filter By","none"),l(bi.filtering,"none"),this.refetchData()}}},yi=wi,Ci=(i("1fd9"),Object(be["a"])(yi,qt,Gt,!1,null,"65950ffd",null)),ki=Ci.exports,Si=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[e.loading?e._e():t("b-container",{attrs:{fluid:""}},[t("b-row",[t("b-col",{attrs:{lg:"5"}},[t("div",{staticClass:"print-info"},[t("div",{staticClass:"card-container header"},[t("div",{staticClass:"info"},[t("div",{staticClass:"status",class:e.print.status.key},[e._v(e._s(e.print.status.title))]),t("div",{staticClass:"date"},[e._v(e._s(e.print.ended_at?e.print.ended_at.fromNow():"-"))])])]),t("div",{staticClass:"card-container printer"},[t("div",{staticClass:"icon"},[t("svg",{staticStyle:{"margin-bottom":"5px"},attrs:{width:"1em",height:"1em"}},[t("use",{attrs:{href:"#svg-3d-printer"}})])]),t("div",{staticClass:"info overflow-truncated-parent"},[t("div",{staticClass:"title overflow-truncated"},[e._v(e._s(e.printer.name))]),t("div",{staticClass:"subtitle overflow-truncated",class:[e.printer.isPrintable()?"text-success":"text-warning"]},[e._v(" "+e._s(e.printer.printabilityText())+" ")])]),t("div",{staticClass:"action"},[t("button",{staticClass:"btn btn-primary",attrs:{disabled:!e.printer.isPrintable()},on:{click:e.onRepeatPrintClicked}},[e.isSending?t("b-spinner",{attrs:{small:""}}):t("span",[e._v("Repeat print")])],1)])]),t("div",{staticClass:"card-container file"},[t("div",{staticClass:"icon"},[t("i",{staticClass:"fas fa-file-code"})]),t("div",{staticClass:"info overflow-truncated-parent"},[t("div",{staticClass:"title overflow-truncated"},[e._v(e._s(e.print.filename))]),e.print.g_code_file?t("div",{staticClass:"subtitle text-secondary overflow-truncated"},[t("span",[e._v(e._s(e.print.g_code_file.filesize))]),e.print.g_code_file.created_at?t("span",[e._v(", created "+e._s(e.print.g_code_file.created_at.fromNow()))]):e._e()]):e._e()]),e.print.g_code_file?t("div",{staticClass:"action"},[t("a",{staticClass:"btn btn-secondary",attrs:{href:`/g_code_files/cloud/${e.print.g_code_file.id}/`}},[e._v("Open file")])]):e._e()]),t("div",{staticClass:"card-container"},[t("div",{staticClass:"info-line"},[t("div",{staticClass:"title"},[e._v("Start time")]),t("div",{staticClass:"value"},[e._v(e._s(e.print.started_at.format(e.absoluteDateFormat)))])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"title"},[e._v("End time")]),t("div",{staticClass:"value"},[e._v(" "+e._s(e.print.ended_at?e.print.ended_at.format(e.absoluteDateFormat):"-")+" ")])]),t("div",{staticClass:"info-line"},[t("div",{staticClass:"title"},[e._v("Duration")]),t("div",{staticClass:"value"},[e._v(e._s(e.print.duration?e.print.duration:"-"))])])])])]),t("b-col",{staticClass:"mt-3 mt-lg-0",attrs:{lg:"7"}},[t("div",{staticClass:"time-lapse"},[e.print.video_archived_at?t("div",{staticClass:"card-container"},[t("h2",{staticClass:"title"},[e._v("Time-Lapse video deleted")]),t("p",[e._v(" Time-lapse videos older than 6-months are deleted from the Obico app server as they are rarely needed and cost significant amount to store in the cloud. ")]),t("p",[e._v(" If you are a Pro subscriber and you don't want your time-lapse videos to be deleted, please "),t("a",{attrs:{href:"mailto:support@obico.io?subject=Please%20keep%20my%20timelapse%20videos"}},[e._v("contact us")]),e._v(". ")])]):e.print.video_url||e.print.tagged_video_url?t("div",[t("b-card",{attrs:{"no-body":""}},[t("b-tabs",{attrs:{pills:"",card:""}},[t("b-tab",{attrs:{title:"Detective Time-Lapse",disabled:!e.canShowDetectiveView}},[t("b-card-text",[e.print.tagged_video_url?t("div",{class:{"is-fullscreen":!!e.fullscreenUrl&&e.fullscreenUrl===e.print.tagged_video_url}},[t("div",{staticClass:"video-wrapper"},[t("video-box",{attrs:{"video-url":e.print.tagged_video_url,"poster-url":e.print.poster_url,fluid:!1,"fullscreen-btn":null===e.fullscreenUrl,"exit-fullscreen-btn":null!==e.fullscreenUrl,"download-btn":!0},on:{timeupdate:e.onTimeUpdate,fullscreen:()=>e.enterFullscreen(e.print.tagged_video_url),exitFullscreen:e.exitFullscreen,download:()=>e.downloadFile(e.print.tagged_video_url,e.print.id+"_tagged.mp4")}})],1),t("div",{staticClass:"detective-footer"},[e.print.prediction_json_url?t("failure-detection-gauge",{attrs:{"normalized-p":e.normalizedP}}):e._e(),t("div",{staticClass:"feedback-section"},[t("div",{staticClass:"lead",class:[e.print.alerted_at?"text-danger":"text-success"]},[e._v(" "+e._s(e.print.alerted_at?"Failure detected":"No failure detected")+" ")]),t("div",{staticClass:"py-2"},[e._v(" Did we get it right? "),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedUp?"primary":"outline"},on:{click:e.onThumbUpClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-up"})],1),t("b-button",{staticClass:"mx-2 btn-sm",attrs:{variant:e.thumbedDown?"primary":"outline"},on:{click:e.onThumbDownClick}},[e.inflightAlertOverwrite?t("b-spinner",{attrs:{type:"grow",small:""}}):t("i",{staticClass:"fas fa-thumbs-down"})],1)],1),t("transition",{attrs:{name:"bounce"}},[e.focusedFeedbackEligible?t("div",{staticClass:"pt-2"},[t("b-button",{attrs:{variant:"outline-primary",size:"sm",href:e.focusedFeedbackLink}},[e.focusedFeedbackCompleted?t("i",{staticClass:"fas fa-check mr-2"}):e._e(),e._v(" FOCUSED FEEDBACK ")])],1):e._e()]),t("div",{staticClass:"about-feedback"},[e.focusedFeedbackEligible?t("small",[e.focusedFeedbackCompleted?t("span",[e._v(" Thank you for completing the Focused Feedback. You have earned 2 non-expirable AI Detection Hours. You can click the button again to change your feedback. ")]):t("span",[e._v(" With Focused Feedback, you can tell us exactly where we got it wrong. This is the most effective way to help us improve. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work#you-earn-detective-hours-for-giving-focused-feedback",target:"_blank"}},[e._v(" You will earn 2 AI Detection Hours once you finish the Focused Feedback ")])])]):t("small",[e._v(" Every time you give us feedback, "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/",target:"_blank"}},[e._v(" you help us get better at detecting failures ")])])])],1)],1)]):t("div",[t("detective-working",{staticClass:"detective-placeholder"})],1)])],1),e.print.video_url?t("b-tab",{attrs:{active:!e.print.tagged_video_url,title:"Original Time-Lapse"}},[t("b-card-text",[t("div",{class:{"is-fullscreen original":!!e.fullscreenUrl&&e.fullscreenUrl===e.print.video_url}},[t("div",{staticClass:"video-wrapper"},[t("video-box",{attrs:{"video-url":e.print.video_url,"poster-url":e.print.poster_url,fluid:!1,"fullscreen-btn":null===e.fullscreenUrl,"exit-fullscreen-btn":null!==e.fullscreenUrl,"download-btn":!0},on:{timeupdate:e.onTimeUpdate,fullscreen:()=>e.enterFullscreen(e.print.video_url),exitFullscreen:e.exitFullscreen,download:()=>e.downloadFile(e.print.video_url,e.print.id+".mp4")}})],1)])])],1):e._e()],1)],1)],1):t("div",{staticClass:"card-container"},[t("p",{staticClass:"text-secondary text-center mt-3"},[e._v("Time-Lapse video unavailable")])])])])],1)],1)]},proxy:!0}])})},Pi=[],xi=(i("907a"),i("986a"),i("1d02"),i("3c5d"),i("dce5")),Ti=i.n(xi),Fi=i("aaa7"),Di=i.n(Fi),Ii=i("acff");function Oi(e,t,i,r=null){var s={};return s.printerId=e,s.wsUri=t,s.onPrinterUpdateReceived=i,s.onStatusReceived=r,s.ws=null,s.webrtc=null,s.passthruQueue=new Map,Di.a.on("blur",(function(){s.closeWebSocket()})),Di.a.on("focus",(function(){s.connect()})),s.onPassThruReceived=function(e){const t=e.ref;if(t&&s.passthruQueue.get(t)){const i=s.passthruQueue.get(t);s.passthruQueue.delete(t),i(null,e.ret)}else if("printer_event"in e){const t=e.printer_event;n["default"].swal.Toast.fire({icon:t.event_class.toLowerCase(),title:t.event_title,html:t.event_text}).then(e=>{e.isDismissed&&"close"===e.dismiss&&(window.location.href="/printer_events/")})}},s.connect=function(e=null){s.ws=new WebSocket(window.location.protocol.replace("http","ws")+"//"+window.location.host+s.wsUri),s.ws.onmessage=function(e){let t={};try{t=JSON.parse(e.data)}catch(n){throw console.log(e.data),n}"passthru"in t?s.onPassThruReceived(t.passthru):i(t)},e&&(s.ws.onopen=e),s.ensureWebsocketClosed(),setTimeout((function(){s.heartbeat()}),3e4)},s.setWebRTC=function(e){function t(e){let t={};try{t=JSON.parse(e)}catch(i){return}t&&"ref"in t&&"ret"in t?s.onPassThruReceived(t):s.onStatusReceived&&s.onStatusReceived(t)}s.webrtc=e,s.webrtc.setCallbacks({onData:e=>{"string"===typeof e||e instanceof String?t(e):Object(Xt["f"])(e,e=>{t(Ii["a"].ungzip(new Uint8Array(e),{to:"string"}))})}})},s.passThruToPrinter=function(e,t){if(s.canSend()){var i=Math.random().toString();Ti()(e,{ref:i}),t&&(s.passthruQueue.set(i,t),setTimeout((function(){s.passthruQueue.has(i)&&n["default"].swal.Toast.fire({icon:"error",title:"Failed to contact OctoPrint, or the Obico plugin version is older than 1.2.0."})}),1e4)),s.webrtc&&s.webrtc.sendData(JSON.stringify(e)),s.ws.send(JSON.stringify({passthru:e}))}else t&&t("Message not passed through. No suitable WebSocket.")},s.ensureWebsocketClosed=function(){s.ws.onclose=function(e){s.ws===e.target&&(s.ws=null)},s.ws.onerror=function(){s.ws&&s.ws.close()}},s.closeWebSocket=function(){s.ws&&s.ws.close()},s.heartbeat=function(){s.canSend()&&(s.ws.send(JSON.stringify({})),setTimeout((function(){s.heartbeat()}),3e4))},s.canSend=function(){return s.ws&&1===s.ws.readyState},s}const Ai=e=>{const{printerId:t,gcode:i,isCloud:n,Swal:r,onCommandSent:s,onPrinterStatusChanged:a}=e,o=Oi(t,q["a"].printerWebSocket(t),e=>{},e=>{});o.connect(()=>{let e;e=n?{func:"download",target:"file_downloader",args:[i]}:{func:"select_file",target:"_printer",args:[""+i.path,null],kwargs:{printAfterSelect:"true"}},o.passThruToPrinter(e,(e,i)=>{if(e||null!==i&&void 0!==i&&i.error)return void r.Toast.fire({icon:"error",title:e||i.error});s&&s(),r.Prompt.fire({html:'\n            <div class="text-center">\n              <i class="fas fa-spinner fa-spin fa-lg py-3"></i>\n              <h5 class="pt-3">\n                Starting the print...\n              </h5>\n            </div>\n          ',showConfirmButton:!1});const n=async()=>{let e;try{e=await z.a.get(q["a"].printer(t)),e=e.data}catch(i){return void console.error(i)}"Operational"===H()(e,"status.state.text")?setTimeout(n,1e3):(r.close(),a&&a())};n()})})},Ei=3e3,Mi=(e,t)=>{let i;e.Prompt.fire({html:`\n      <div class="text-center">\n        <h5 class="py-3">\n          You'll be redirected to printers page in <strong>${Math.round(Ei/1e3)}</strong> seconds\n        </h5>\n      </div>\n    `,timer:Ei,showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Redirect now",onOpen:()=>{i=setInterval(()=>{e.getHtmlContainer().querySelector("strong").textContent=(e.getTimerLeft()/1e3).toFixed(0)},1e3)},onClose:()=>{clearInterval(i),i=null}}).then(e=>{e.isConfirmed||"timer"===e.dismiss?window.location.assign("/printers/"):t&&t()})};var Ni={name:"PrintPage",components:{PageLayout:Xe,VideoBox:lt,DetectiveWorking:ft,FailureDetectionGauge:oi},props:{printId:{type:Number,required:!0}},data:function(){return{PrintStatus:X,absoluteDateFormat:"MMM M, YYYY H:mm A",print:null,printer:null,loading:!0,isSending:!1,predictions:[],currentPosition:0,inflightAlertOverwrite:null,fullscreenUrl:null}},computed:{focusedFeedbackEligible(){return this.print.printshotfeedback_set.length>0&&this.print.alert_overwrite},focusedFeedbackCompleted(){return this.print.printshotfeedback_set.length>0&&!this.print.focusedFeedbackNeeded},normalizedP(){return Object(Xt["c"])(this.predictions,this.currentPosition,!1)},canShowDetectiveView(){return null!==this.print.prediction_json_url&&null!==this.print.tagged_video_url||!!(this.print.uploaded_at&&W()().diff(this.print.uploaded_at,"hours")<24)},thumbedUp(){return!!this.print.alert_overwrite&&this.print.has_alerts^"NOT_FAILED"===this.print.alert_overwrite},thumbedDown(){return!!this.print.alert_overwrite&&this.print.has_alerts^"FAILED"===this.print.alert_overwrite}},created(){this.fetchData()},mounted(){const e=this.exitFullscreen;document.addEventListener("keydown",t=>{"Escape"===t.key&&e()})},methods:{downloadFile:Xt["a"],fetchData(e=!0){e&&(this.loading=!0),z.a.get(q["a"].print(this.printId)).then(e=>(this.print=ee(e.data),z.a.get(q["a"].printer(this.print.printer.id)))).then(e=>(this.printer=ne(e.data),z.a.get(this.print.prediction_json_url))).then(t=>{this.predictions=t.data,e&&(this.loading=!1)}).catch(e=>{this.$swal.Reject.fire({title:"Error",text:e.message})})},onTimeUpdate(e){this.currentPosition=e},onThumbUpClick(){this.inflightAlertOverwrite=this.print.has_alerts?"FAILED":"NOT_FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},onThumbDownClick(){this.inflightAlertOverwrite=this.print.has_alerts?"NOT_FAILED":"FAILED",this.alertOverwrite(this.inflightAlertOverwrite)},alertOverwrite(e){z.a.patch(q["a"].print(this.print.id),{alert_overwrite:e}).then(e=>{this.inflightAlertOverwrite=null,this.fetchData(!1)})},onRepeatPrintClicked(){this.isSending=!0,Ai({printerId:this.printer.id,gcode:this.print.g_code_file,isCloud:!0,Swal:this.$swal,onPrinterStatusChanged:()=>{this.isSending=!1,Mi(this.$swal,()=>this.fetchData())}})},enterFullscreen(e){this.fullscreenUrl=e},exitFullscreen(){this.fullscreenUrl=null}}},Ri=Ni,Li=(i("c25c"),Object(be["a"])(Ri,Si,Pi,!1,null,"0c7aaebe",null)),ji=Li.exports,Bi=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{staticClass:"text-center",attrs:{lg:"8"}},[t("h1",{staticClass:"pb-2"},[e._v("Upload Time-lapse")]),t("p",{staticClass:"pb-2"},[e._v("Upload time-lapse videos to test Obico's AI failure detection.")]),t("vue-dropzone",{staticClass:"upload-box",attrs:{id:"dropzone",options:e.dropzoneOptions,"use-custom-slot":!0},on:{"vdropzone-success":e.printUploadSuccess}},[t("div",{staticClass:"dz-message needsclick"},[t("i",{staticClass:"fas fa-upload fa-2x"}),e._v(" "),t("br"),e._v(" Drop files here or click to upload."),t("br"),e._v(" *.mp4 or *.mpg files only. Up to 100MB each. ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.uploaded,expression:"uploaded"}],staticClass:"pt-5"},[t("div",{attrs:{id:"tl-uploaded"}},[t("img",{staticClass:"detective-working",attrs:{src:i("0469")}}),t("div",{staticClass:"py-2 text-center"},[t("div",{staticClass:"py-2"},[e._v(" The Obico Server is running failure detection on the time-lapse video(s) you uploaded. ")]),t("div",[e._v("We will send you email when it is done.")]),t("a",{attrs:{href:"/prints/"}},[e._v("Check status now >>>")])])])])],1)],1)],1)]},proxy:!0}])})},$i=[],Ui=i("92c3"),zi=i.n(Ui),Vi=(i("1e3f"),{name:"UploadPrintPage",components:{vueDropzone:zi.a,PageLayout:Xe},props:{csrf:{type:String,required:!0}},data(){return{dropzoneOptions:{withCredentials:!0,maxFilesize:100,timeout:36e5,acceptedFiles:"video/mp4, video/mpeg",url:"?",headers:{"X-CSRFToken":this.csrf}},uploaded:!1}},methods:{printUploadSuccess(e){console.log(e),this.uploaded=!0}}}),Wi=Vi,qi=(i("5a0b"),Object(be["a"])(Wi,Bi,$i,!1,null,"7c2ff1dc",null)),Gi=qi.exports,Hi=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("div",[e.isEnt?t("a",{staticClass:"btn shadow-none hours-btn d-none d-md-inline",attrs:{href:"/user_preferences/dh/",title:e.dhBadgeNum+" AI Detection Hours"}},[t("svg",[t("use",{attrs:{href:"#svg-detective-hours"}})]),t("span",{staticClass:"badge badge-light",attrs:{id:"user-credits"}},[e._v(e._s(e.dhBadgeNum))]),t("span",{staticClass:"sr-only"},[e._v("AI Detection Hours")])]):e._e(),t("a",{staticClass:"btn shadow-none icon-btn d-none d-md-inline",attrs:{href:"/printers/wizard/",title:"Link New Printer"}},[t("i",{staticClass:"fas fa-plus"})]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[e.isEnt?t("b-dropdown-item",{staticClass:"d-md-none",attrs:{href:"/user_preferences/dh/"}},[t("i",{staticClass:"fas fa-hourglass-half"}),e._v(e._s(e.dhBadgeNum)+" AI Detection Hours ")]):e._e(),t("b-dropdown-item",{staticClass:"d-md-none",attrs:{href:"/printers/wizard/"}},[t("i",{staticClass:"fas fa-plus"}),e._v("Link New Printer ")]),t("b-dropdown-divider",{staticClass:"d-md-none"}),t("cascaded-dropdown",{attrs:{"menu-options":e.menuOptions,"menu-selections":e.menuSelections},on:{menuSelectionChanged:e.menuSelectionChanged}})],1)],1)]},proxy:!0},{key:"content",fn:function(){return[e.shouldShowFilterWarning?t("div",{staticClass:"active-filter-notice",on:{click:e.onShowAllClicked}},[t("div",{staticClass:"filter"},[t("i",{staticClass:"fas fa-filter mr-2"}),e._v(" "+e._s(e.activeFiltering)+" ")]),t("a",[e._v("SHOW ALL")])]):e._e(),t("b-container",{staticClass:"printer-list-page"},[e.loading?t("b-row",[t("b-col",{staticClass:"text-center"},[t("b-spinner",{staticClass:"my-5",attrs:{label:"Loading..."}})],1)],1):e._e(),e.visiblePrinters.length?t("b-row",{staticClass:"printer-cards justify-content-center"},e._l(e.visiblePrinters,(function(i){return t("printer-card",{key:i.id,staticClass:"printer-card-wrapper",attrs:{printer:i,"is-pro-account":e.user.is_pro},on:{PrinterUpdated:e.onPrinterUpdated,printModalOpened:()=>e.targetPrinter=i}})})),1):e._e(),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-6",attrs:{id:"new-printer"}},[t("div",{staticClass:"new-printer-container"},[t("a",{attrs:{href:"/printers/wizard/"}},[t("i",{staticClass:"fa fa-plus fa-2x"}),t("div",[e._v("Link New Printer")])])])])]),t("b-row",{directives:[{name:"show",rawName:"v-show",value:e.shouldShowArchiveWarning,expression:"shouldShowArchiveWarning"}],staticClass:"bottom-messages"},[t("b-col",[t("div",{staticClass:"alert alert-warning alert-dismissible fade show mb-3",attrs:{role:"alert"}},[t("div",{staticClass:"warning"},[t("div",[e._v(" "+e._s(e.archivedPrinterNum)+" "+e._s(e._f("pluralize")("printer",e.archivedPrinterNum))+" have been archived. ")]),t("a",{staticClass:"warning-action",attrs:{href:"/ent/printers/archived/"}},[e._v("Show Archived Printers")])]),t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])])],1)],1),t("b-modal",{attrs:{id:"b-modal-gcodes",size:"lg"},on:{hidden:e.resetGcodesModal}},[e.selectedGcodeId?t("g-code-file-page",{attrs:{"is-popup":!0,"target-printer-id":e.targetPrinter.id,"route-params":{fileId:e.selectedGcodeId,printerId:e.selectedPrinterId},"on-close":()=>e.$bvModal.hide("b-modal-gcodes")},on:{goBack:()=>{e.selectedGcodeId=null,e.scrollToTop()}}}):t("g-code-folders-page",{attrs:{"is-popup":!0,"target-printer":e.targetPrinter,"route-params":{printerId:e.selectedPrinterId,parentFolder:null},"on-close":()=>e.$bvModal.hide("b-modal-gcodes"),"saved-path":e.savedPath,"scroll-container-id":"b-modal-gcodes"},on:{openFile:(t,i,n)=>{e.selectedGcodeId=t,e.selectedPrinterId=i,e.savedPath=n,e.scrollToTop()}}})],1)]},proxy:!0}])})},Ji=[],Yi=i("5128"),Ki=i.n(Yi),Qi=function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-sm-12 col-lg-6 printer-card",attrs:{id:e.printer.id}},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-header"},[t("div",{staticClass:"title-box"},[e.hasCurrentPrintFilename?t("div",{staticClass:"primary-title print-filename"},[e._v(" "+e._s(e.printer.current_print.filename)+" ")]):e._e(),t("div",{staticClass:"printer-name",class:{"secondary-title":e.hasCurrentPrintFilename}},[e._v(" "+e._s(e.printer.name)+"   ("),t("a",{class:e.statusClass,attrs:{href:"#printer-actions-"+e.printer.id}},[e._v(e._s(e.statusText))]),e._v(") ")])]),t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}])},[t("b-dropdown-item",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.onSharePrinter()}}},[t("i",{staticClass:"fas fa-share-alt fa-lg"}),e._v("Share ")]),e.printer.isAgentMoonraker()?e._e():t("b-dropdown-item",{attrs:{href:e.octoPrintTunnelUrl()}},[t("svg",{staticClass:"menu-icon"},[t("use",{attrs:{href:"#svg-octoprint-tunneling"}})]),e._v(" Tunneling ")]),t("div",{staticClass:"dropdown-divider"}),t("b-dropdown-item",{attrs:{href:e.settingsUrl()}},[t("i",{staticClass:"fas fa-wrench fa-lg"}),e._v("Configure ")])],1)],1),t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:e.isProAccount}}),e.printer.alertUnacknowledged()?t("div",{staticClass:"failure-alert card-body bg-warning px-2 py-1"},[t("i",{staticClass:"fas fa-exclamation-triangle align-middle"}),t("span",{staticClass:"align-middle"},[e._v("Failure Detected!")]),t("button",{staticClass:"btn btn-outline-primary btn-sm float-right",attrs:{id:"not-a-failure",type:"button"},on:{click:function(t){return e.onNotAFailureClicked(t,!1)}}},[e._v(" Not a failure? ")])]):e._e(),t("div",{staticClass:"card-body gauge-container",class:{overlay:!e.isWatching}},[e.isWatching?e._e():t("div",{staticClass:"overlay-top text-center",staticStyle:{left:"0",width:"100%",top:"50%","margin-top":"-55px"}},[t("H1",[t("i",{staticClass:"far fa-eye-slash"})]),t("h5",{staticClass:"text-warning"},[e._v("Failure Detection is Off")]),e.printer.not_watching_reason?t("small",[e._v(e._s(e.printer.not_watching_reason)+". "),e._m(0)]):e._e(),t("div")],1),t("failure-detection-gauge",{attrs:{"normalized-p":e.printer.normalized_p,"is-watching":e.isWatching}}),t("hr")],1),t("printer-actions",e._b({staticClass:"container",attrs:{id:"printer-actions-"+e.printer.id},on:{PrinterActionPauseClicked:e.onPrinterActionPauseClicked,PrinterActionResumeClicked:function(t){return e.onPrinterActionResumeClicked(t)},PrinterActionCancelClicked:e.onPrinterActionCancelClicked,PrinterActionConnectClicked:e.onPrinterActionConnectClicked,PrinterActionStartClicked:e.onPrinterActionStartClicked,PrinterActionControlClicked:e.onPrinterActionControlClicked}},"printer-actions",e.actionsProps,!1)),t("div",{staticClass:"info-section settings"},[t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.settings},attrs:{type:"button"},on:{click:function(t){return e.onSettingsToggleClicked()}}},[t("i",{staticClass:"fas fa-cog fa-lg"})]),t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.time},attrs:{type:"button"},on:{click:function(t){return e.onTimeToggleClicked()}}},[t("i",{staticClass:"fas fa-clock fa-lg"})]),t("button",{staticClass:"info-section-toggle btn btn-sm no-corner mx-2",class:{pressed:e.section_toggles.statusTemp},attrs:{type:"button"},on:{click:function(t){return e.onStatusTempToggleClicked()}}},[t("i",{staticClass:"fas fa-thermometer-half fa-lg"})])]),t("div",{staticClass:"info-section",staticStyle:{height:"0.3rem"}}),t("div",[t("div",{staticClass:"info-section container"},[e.section_toggles.settings?t("div",{attrs:{id:"panel-settings"}},[t("div",{staticClass:"pt-2 pb-3"},[t("div",{staticClass:"row justify-content-center px-3"},[t("div",{staticClass:"col-12 setting-item"},[t("label",{staticClass:"toggle-label",attrs:{for:"watching_enabled-toggle-"+e.printer.id}},[e._v("Enable AI failure detection "),e.watchForFailures?e._e():t("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v(" AI failure detection is disabled. You are on your own. ")])]),t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"watching_enabled-toggle-"+e.printer.id,type:"checkbox",name:"watching_enabled"},domProps:{checked:e.watchForFailures},on:{click:e.onWatchForFailuresToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"watching_enabled-toggle-"+e.printer.id}})])])]),t("div",{staticClass:"row justify-content-center px-3"},[t("div",{staticClass:"col-12 setting-item"},[t("label",{staticClass:"toggle-label",attrs:{for:"pause-toggle-"+e.printer.id}},[e._v("Pause on detected failures "),e.pauseOnFailure?e._e():t("div",{staticClass:"text-muted font-weight-light font-size-sm"},[e._v(" You will still be alerted via notifications ")])]),t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"pause-toggle-"+e.printer.id,type:"checkbox",name:"pause_on_failure"},domProps:{checked:e.pauseOnFailure},on:{click:e.onPauseOnFailureToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"pause-toggle-"+e.printer.id}})])])])])]):e._e(),e.section_toggles.time?t("div",{attrs:{id:"print-time"}},[t("div",{staticClass:"py-2"},[e._m(1),t("div",{staticClass:"row"},[e._m(2),t("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-remaining"}},"duration-block",e.timeRemaining,!1)),t("duration-block",e._b({staticClass:"col-5 numbers",attrs:{id:"print-time-total"}},"duration-block",e.timeTotal,!1)),t("div",{staticClass:"col-12"},[t("div",{staticClass:"progress",staticStyle:{height:"2px"}},[t("div",{staticClass:"progress-bar",class:{"progress-bar-striped":e.progressPct<100,"progress-bar-animated":e.progressPct<100},style:`width: ${e.progressPct}%;`,attrs:{id:"print-progress",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})])])],1)])]):e._e(),e.section_toggles.statusTemp&&e.tempProps.show?t("status-temp",e._b({attrs:{id:"status_temp_block"},on:{TempEditClicked:e.onTempEditClicked}},"status-temp",e.tempProps,!1)):e._e()],1)])],1)])},Zi=[function(){var e=this,t=e._self._c;return t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/detective-not-watching/",target:"_blank"}},[e._v("Learn more. "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"row text-muted"},[t("small",{staticClass:"col-5 offset-2"},[e._v(" Remaining ")]),t("small",{staticClass:"col-5"},[e._v(" Total ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-2 text-muted"},[t("i",{staticClass:"fas fa-clock"})])}],Xi=i("2769"),en=i.n(Xi),tn=(i("d9e2"),i("d093"));rn.sessions={},rn.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||rn.extension.isInstalled()}return!0};var nn={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var i=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",i(n)}else i(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function rn(e){if(e=e||{},e.success="function"==typeof e.success?e.success:rn.noop,e.error="function"==typeof e.error?e.error:rn.noop,e.wsopened="function"==typeof e.wsopened?e.wsopened:rn.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:rn.noop,!rn.initDone)return e.error("Library not initialized"),{};if(!rn.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(rn.log("Library initialized: "+rn.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,i=null,n={},r=null,s=null,a=0,o=e.server;rn.isArray(o)?(rn.log("Multiple servers provided ("+o.length+"), will use the first that works"),o=null,s=e.server,rn.debug(s)):0===o.indexOf("ws")?(t=!0,rn.log("Using WebSockets to contact Janus: "+o)):(t=!1,rn.log("Using REST API to contact Janus: "+o));var l=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,d=e.bundlePolicy,u=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var h=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(h=e.max_poll_events),h<1&&(h=1);var f=null;void 0!==e.token&&null!==e.token&&(f=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var v=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(v=e.keepAlivePeriod),isNaN(v)&&(v=25e3);var g=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var _=!1,w=null,y={},C=this,k=0,S={};function P(){if(null!=w)if(rn.debug("Long poll..."),_){var t=o+"/"+w+"?rid="+(new Date).getTime();h&&(t=t+"&maxev="+h),f&&(t=t+"&token="+encodeURIComponent(f)),m&&(t=t+"&apisecret="+encodeURIComponent(m)),rn.httpAPICall(t,{verb:"GET",withCredentials:p,success:x,timeout:g,error:function(t,i){if(rn.error(t+":",i),k++,k>3)return _=!1,void e.error("Lost connection to the server (is it down?)");P()}})}else rn.warn("Is the server down? (connected=false)")}function x(e,n){if(k=0,t||void 0===w||null===w||!0===n||P(),t||!rn.isArray(e)){if(!e.session_id||e.session_id===w)if("keepalive"!==e["janus"])if("server_info"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var r=e["sender"];if(!r)return void rn.warn("Missing sender...");var s=y[r];if(!s)return void rn.debug("This handle is not attached to this session");var a=e["candidate"];rn.debug("Got a trickled candidate on session "+w),rn.debug(a);var o=s.webrtcStuff;o.pc&&o.remoteSdp?(rn.debug("Adding remote candidate:",a),a&&!0!==a.completed?o.pc.addIceCandidate(a):o.pc.addIceCandidate(rn.endOfCandidates)):(rn.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(a),rn.debug(o.candidates))}else{if("webrtcup"===e["janus"]){rn.debug("Got a webrtcup event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");s=y[r];return s?void s.webrtcState(!0):void rn.debug("This handle is not attached to this session")}if("hangup"===e["janus"]){rn.debug("Got a hangup event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");s=y[r];if(!s)return void rn.debug("This handle is not attached to this session");s.webrtcState(!1,e["reason"]),s.hangup()}else if("detached"===e["janus"]){rn.debug("Got a detached event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");s=y[r];if(!s)return;s.detached=!0,s.ondetached(),s.detach()}else if("media"===e["janus"]){rn.debug("Got a media event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");s=y[r];if(!s)return void rn.debug("This handle is not attached to this session");s.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){rn.debug("Got a slowlink event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");s=y[r];if(!s)return void rn.debug("This handle is not attached to this session");s.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){rn.error("Ooops: "+e["error"].code+" "+e["error"].reason),rn.debug(e);p=e["transaction"];if(p){h=S[p];h&&h(e),delete S[p]}return void(458===e.error.code&&t&&i.close(3505,"No such session"))}if("event"===e["janus"]){rn.debug("Got a plugin event on session "+w),rn.debug(e);r=e["sender"];if(!r)return void rn.warn("Missing sender...");var l=e["plugindata"];if(!l)return void rn.warn("Missing plugindata...");rn.debug("  -- Event is coming from "+r+" ("+l["plugin"]+")");var c=l["data"];rn.debug(c);s=y[r];if(!s)return void rn.warn("This handle is not attached to this session");var d=e["jsep"];d&&(rn.debug("Handling SDP as well..."),rn.debug(d));var u=s.onmessage;u?(rn.debug("Notifying application..."),u(c,d)):rn.debug("No provided notification callback")}else{if("timeout"===e["janus"])return rn.error("Timeout on session "+w),rn.debug(e),void(t&&i.close(3504,"Gateway timeout"));rn.warn("Unknown message/event  '"+e["janus"]+"' on session "+w),rn.debug(e)}}}else{rn.debug("Got a success on session "+w),rn.debug(e);p=e["transaction"];if(p){h=S[p];h&&h(e),delete S[p]}}else{rn.debug("Got an ack on session "+w),rn.debug(e);var p=e["transaction"];if(p){var h=S[p];h&&h(e),delete S[p]}}else{rn.debug("Got info on the Janus instance"),rn.debug(e);var p=e["transaction"];if(p){var h=S[p];h&&h(e),delete S[p]}}else rn.vdebug("Got a keepalive on session "+w)}else for(var f=0;f<e.length;f++)x(e[f],!0)}function T(){if(o&&t&&_){r=setTimeout(T,v);var e={janus:"keepalive",session_id:w,transaction:rn.randomString(12)};f&&(e["token"]=f),m&&(e["apisecret"]=m),i.send(JSON.stringify(e))}}function F(l){var c=rn.randomString(12),d={janus:"create",transaction:c};if(l["reconnect"]&&(_=!1,d["janus"]="claim",d["session_id"]=w,i&&(i.onopen=null,i.onerror=null,i.onclose=null,r&&(clearTimeout(r),r=null))),f&&(d["token"]=f),m&&(d["apisecret"]=m),!o&&rn.isArray(s)&&(o=s[a],0===o.indexOf("ws")?(t=!0,rn.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+o+")")):(t=!1,rn.log("Server #"+(a+1)+": trying REST API to contact Janus ("+o+")"))),t)for(var u in i=rn.newWebSocket(o,"janus-protocol"),n={error:function(){if(rn.error("Error connecting to the Janus WebSockets server... "+o),rn.isArray(s)&&!l["reconnect"])return a++,a===s.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(o=null,void setTimeout((function(){F(l)}),200));l.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){l.wsopened(),S[c]=function(e){if(rn.debug(e),"success"!==e["janus"])return rn.error("Ooops: "+e["error"].code+" "+e["error"].reason),void l.error(e["error"].reason);r=setTimeout(T,v),_=!0,w=e["session_id"]?e["session_id"]:e.data["id"],l["reconnect"]?rn.log("Claimed session: "+w):rn.log("Created session: "+w),rn.sessions[w]=C,l.success()},i.send(JSON.stringify(d))},message:function(e){x(JSON.parse(e.data))},close:function(){o&&_&&(_=!1,e.error("Lost connection to the server (is it down?)"))}},n)i.addEventListener(u,n[u]);else rn.httpAPICall(o,{verb:"POST",withCredentials:p,body:d,success:function(e){if(rn.debug(e),"success"!==e["janus"])return rn.error("Ooops: "+e["error"].code+" "+e["error"].reason),void l.error(e["error"].reason);_=!0,w=e["session_id"]?e["session_id"]:e.data["id"],l["reconnect"]?rn.log("Claimed session: "+w):rn.log("Created session: "+w),rn.sessions[w]=C,P(),l.success()},error:function(e,t){if(rn.error(e+":",t),rn.isArray(s)&&!l["reconnect"])return a++,a===s.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(o=null,void setTimeout((function(){F(l)}),200));""===t?l.error(e+": Is the server down?"):l.error(e+": "+t)}})}function D(e){if(e=e||{},e.success="function"==typeof e.success?e.success:rn.noop,e.error="function"==typeof e.error?e.error:rn.noop,rn.log("Getting info on Janus instance"),!_)return rn.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=rn.randomString(12),r={janus:"info",transaction:n};if(f&&(r["token"]=f),m&&(r["apisecret"]=m),t)return S[n]=function(t){rn.log("Server info:"),rn.debug(t),"server_info"!==t["janus"]&&rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},void i.send(JSON.stringify(r));rn.httpAPICall(o,{verb:"POST",withCredentials:p,body:r,success:function(t){rn.log("Server info:"),rn.debug(t),"server_info"!==t["janus"]&&rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},error:function(t,i){rn.error(t+":",i),""===i?e.error(t+": Is the server down?"):e.error(t+": "+i)}})}function I(s){s=s||{},s.success="function"==typeof s.success?s.success:rn.noop,s.error="function"==typeof s.error?s.error:rn.noop;var a=!0===s.unload,l=!0;void 0!==s.notifyDestroyed&&null!==s.notifyDestroyed&&(l=!0===s.notifyDestroyed);var c=!0===s.cleanupHandles;if(rn.log("Destroying session "+w+" (unload="+a+")"),!w)return rn.warn("No session to destroy"),s.success(),void(l&&e.destroyed());if(c)for(var d in y)L(d,{noRequest:!0});if(!_)return rn.warn("Is the server down? (connected=false)"),w=null,void s.success();var u={janus:"destroy",transaction:rn.randomString(12)};if(f&&(u["token"]=f),m&&(u["apisecret"]=m),a)return t?(i.onclose=null,i.close(),i=null):navigator.sendBeacon(o+"/"+w,JSON.stringify(u)),rn.log("Destroyed session:"),w=null,_=!1,s.success(),void(l&&e.destroyed());if(t){u["session_id"]=w;var h=function(){for(var e in n)i.removeEventListener(e,n[e]);i.removeEventListener("message",v),i.removeEventListener("error",g),r&&clearTimeout(r),i.close()},v=function(t){var i=JSON.parse(t.data);i.session_id==u.session_id&&i.transaction==u.transaction&&(h(),s.success(),l&&e.destroyed())},g=function(t){h(),s.error("Failed to destroy the server: Is the server down?"),l&&e.destroyed()};return i.addEventListener("message",v),i.addEventListener("error",g),void(1===i.readyState?i.send(JSON.stringify(u)):g())}rn.httpAPICall(o+"/"+w,{verb:"POST",withCredentials:p,body:u,success:function(t){rn.log("Destroyed session:"),rn.debug(t),w=null,_=!1,"success"!==t["janus"]&&rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),s.success(),l&&e.destroyed()},error:function(t,i){rn.error(t+":",i),w=null,_=!1,s.success(),l&&e.destroyed()}})}function O(e){if(e=e||{},e.success="function"==typeof e.success?e.success:rn.noop,e.error="function"==typeof e.error?e.error:rn.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:rn.noop,e.iceState="function"==typeof e.iceState?e.iceState:rn.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:rn.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:rn.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:rn.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:rn.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:rn.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:rn.noop,e.ondata="function"==typeof e.ondata?e.ondata:rn.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:rn.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:rn.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:rn.noop,!_)return rn.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return rn.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,s=e.token?e.token:f,a=rn.randomString(12),l={janus:"attach",plugin:n,opaque_id:r,transaction:a};if(s&&(l["token"]=s),m&&(l["apisecret"]=m),t)return S[a]=function(t){if(rn.debug(t),"success"!==t["janus"])return rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var i=t.data["id"];rn.log("Created handle: "+i);var r={session:C,plugin:n,id:i,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return i},getPlugin:function(){return n},getVolume:function(){return W(i,!0)},getRemoteVolume:function(){return W(i,!0)},getLocalVolume:function(){return W(i,!1)},isAudioMuted:function(){return q(i,!1)},muteAudio:function(){return G(i,!1,!0)},unmuteAudio:function(){return G(i,!1,!1)},isVideoMuted:function(){return q(i,!0)},muteVideo:function(){return G(i,!0,!0)},unmuteVideo:function(){return G(i,!0,!1)},getBitrate:function(){return H(i)},send:function(e){A(i,e)},data:function(e){N(i,e)},dtmf:function(e){R(i,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(i,!0,e)},createAnswer:function(e){B(i,!1,e)},handleRemoteJsep:function(e){$(i,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(i,!0===e)},detach:function(e){L(i,e)}};y[i]=r,e.success(r)},l["session_id"]=w,void i.send(JSON.stringify(l));rn.httpAPICall(o+"/"+w,{verb:"POST",withCredentials:p,body:l,success:function(t){if(rn.debug(t),"success"!==t["janus"])return rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var i=t.data["id"];rn.log("Created handle: "+i);var r={session:C,plugin:n,id:i,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return i},getPlugin:function(){return n},getVolume:function(){return W(i,!0)},getRemoteVolume:function(){return W(i,!0)},getLocalVolume:function(){return W(i,!1)},isAudioMuted:function(){return q(i,!1)},muteAudio:function(){return G(i,!1,!0)},unmuteAudio:function(){return G(i,!1,!1)},isVideoMuted:function(){return q(i,!0)},muteVideo:function(){return G(i,!0,!0)},unmuteVideo:function(){return G(i,!0,!1)},getBitrate:function(){return H(i)},send:function(e){A(i,e)},data:function(e){N(i,e)},dtmf:function(e){R(i,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(i,!0,e)},createAnswer:function(e){B(i,!1,e)},handleRemoteJsep:function(e){$(i,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ontrackmuted:e.ontrackmuted,ontrackunmuted:e.ontrackunmuted,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Y(i,!0===e)},detach:function(e){L(i,e)}};y[i]=r,e.success(r)},error:function(t,i){rn.error(t+":",i),""===i?e.error(t+": Is the server down?"):e.error(t+": "+i)}})}function A(e,n){if(n=n||{},n.success="function"==typeof n.success?n.success:rn.noop,n.error="function"==typeof n.error?n.error:rn.noop,!_)return rn.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var r=y[e];if(!r||!r.webrtcStuff)return rn.warn("Invalid handle"),void n.error("Invalid handle");var s=n.message,a=n.jsep,l=rn.randomString(12),c={janus:"message",body:s,transaction:l};if(r.token&&(c["token"]=r.token),m&&(c["apisecret"]=m),a&&(c.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(c.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(c.jsep.rid_order=a.rid_order)),rn.debug("Sending message to plugin (handle="+e+"):"),rn.debug(c),t)return c["session_id"]=w,c["handle_id"]=e,S[l]=function(e){if(rn.debug("Message sent!"),rn.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return rn.warn("Request succeeded, but missing plugindata..."),void n.success();rn.log("Synchronous transaction successful ("+t["plugin"]+")");var i=t["data"];return rn.debug(i),void n.success(i)}"ack"===e["janus"]?n.success():e["error"]?(rn.error("Ooops: "+e["error"].code+" "+e["error"].reason),n.error(e["error"].code+" "+e["error"].reason)):(rn.error("Unknown error"),n.error("Unknown error"))},void i.send(JSON.stringify(c));rn.httpAPICall(o+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:c,success:function(e){if(rn.debug("Message sent!"),rn.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return rn.warn("Request succeeded, but missing plugindata..."),void n.success();rn.log("Synchronous transaction successful ("+t["plugin"]+")");var i=t["data"];return rn.debug(i),void n.success(i)}"ack"===e["janus"]?n.success():e["error"]?(rn.error("Ooops: "+e["error"].code+" "+e["error"].reason),n.error(e["error"].code+" "+e["error"].reason)):(rn.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){rn.error(e+":",t),n.error(e+": "+t)}})}function E(e,n){if(_){var r=y[e];if(r&&r.webrtcStuff){var s={janus:"trickle",candidate:n,transaction:rn.randomString(12)};if(r.token&&(s["token"]=r.token),m&&(s["apisecret"]=m),rn.vdebug("Sending trickle candidate (handle="+e+"):"),rn.vdebug(s),t)return s["session_id"]=w,s["handle_id"]=e,void i.send(JSON.stringify(s));rn.httpAPICall(o+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:s,success:function(e){rn.vdebug("Candidate sent!"),rn.vdebug(e),"ack"===e["janus"]||rn.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,t){rn.error(e+":",t)}})}else rn.warn("Invalid handle")}else rn.warn("Is the server down? (connected=false)")}function M(e,t,i,n,r){var s=y[e];if(s&&s.webrtcStuff){var a=s.webrtcStuff;if(a.pc){var o=function(e){var t=e.target.label;s.ondata(e.data,t)},l=function(e){rn.log("Received state change on data channel:",e);var t=e.target.label,i=e.target.protocol,n=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(rn.log("State change on <"+t+"> data channel: "+n),"open"===n){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){for(var r of(rn.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length),a.dataChannel[t].pending))rn.log("Sending data on data channel <"+t+">"),rn.debug(r),a.dataChannel[t].send(r);a.dataChannel[t].pending=[]}s.ondataopen(t,i)}},c=function(e){rn.error("Got error on data channel:",e)};if(n)a.dataChannel[t]=n;else{var d={ordered:!0};i&&(d.protocol=i),a.dataChannel[t]=a.pc.createDataChannel(t,d)}a.dataChannel[t].onmessage=o,a.dataChannel[t].onopen=l,a.dataChannel[t].onclose=l,a.dataChannel[t].onerror=c,a.dataChannel[t].pending=[],r&&a.dataChannel[t].pending.push(r)}else rn.warn("Invalid PeerConnection")}else rn.warn("Invalid handle")}function N(e,t){t=t||{},t.success="function"==typeof t.success?t.success:rn.noop,t.error="function"==typeof t.error?t.error:rn.noop;var i=y[e];if(!i||!i.webrtcStuff)return rn.warn("Invalid handle"),void t.error("Invalid handle");var n=i.webrtcStuff,r=t.text||t.data;if(!r)return rn.warn("Invalid data"),void t.error("Invalid data");var s=t.label?t.label:rn.dataChanDefaultLabel;return n.dataChannel[s]?"open"!==n.dataChannel[s].readyState?(n.dataChannel[s].pending.push(r),void t.success()):(rn.log("Sending data on data channel <"+s+">"),rn.debug(r),n.dataChannel[s].send(r),void t.success()):(M(e,s,t.protocol,!1,r,t.protocol),void t.success())}function R(e,t){t=t||{},t.success="function"==typeof t.success?t.success:rn.noop,t.error="function"==typeof t.error?t.error:rn.noop;var i=y[e];if(!i||!i.webrtcStuff)return rn.warn("Invalid handle"),void t.error("Invalid handle");var n=i.webrtcStuff;if(!n.dtmfSender){if(n.pc){var r=n.pc.getSenders(),s=r.find((function(e){return e.track&&"audio"===e.track.kind}));if(!s)return rn.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=s.dtmf,n.dtmfSender&&(rn.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){rn.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return rn.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var a=t.dtmf;if(!a)return rn.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var o=a.tones;if(!o)return rn.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var l="number"===typeof a.duration?a.duration:500,c="number"===typeof a.gap?a.gap:50;rn.debug("Sending DTMF string "+o+" (duration "+l+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(o,l,c),t.success()}function L(e,n){n=n||{},n.success="function"==typeof n.success?n.success:rn.noop,n.error="function"==typeof n.error?n.error:rn.noop;var r=!0===n.noRequest;rn.log("Destroying handle "+e+" (only-locally="+r+")"),Y(e);var s=y[e];if(!s||s.detached)return delete y[e],void n.success();if(s.detached=!0,r)return delete y[e],void n.success();if(!_)return rn.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:rn.randomString(12)};if(s.token&&(a["token"]=s.token),m&&(a["apisecret"]=m),t)return a["session_id"]=w,a["handle_id"]=e,i.send(JSON.stringify(a)),delete y[e],void n.success();rn.httpAPICall(o+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:a,success:function(t){rn.log("Destroyed handle:"),rn.debug(t),"success"!==t["janus"]&&rn.error("Ooops: "+t["error"].code+" "+t["error"].reason),delete y[e],n.success()},error:function(t,i){rn.error(t+":",i),delete y[e],n.success()}})}function j(e,t,i,n,r){var s=y[e];if(!s||!s.webrtcStuff)return rn.warn("Invalid handle"),n.stream||rn.stopAllTracks(r),void n.error("Invalid handle");var a=s.webrtcStuff;rn.debug("streamsDone:",r),r&&(rn.debug("  -- Audio tracks:",r.getAudioTracks()),rn.debug("  -- Video tracks:",r.getVideoTracks()));var o=!1;if(a.myStream&&i.update&&(!a.streamExternal||i.replaceAudio||i.replaceVideo)){if((!i.update&&Q(i)||i.update&&(i.addAudio||i.replaceAudio))&&r.getAudioTracks()&&r.getAudioTracks().length)if(a.myStream.addTrack(r.getAudioTracks()[0]),rn.unifiedPlan){rn.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]);var p=null,h=a.pc.getTransceivers();if(h&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind){p=f;break}p&&p.sender?p.sender.replaceTrack(r.getAudioTracks()[0]):a.pc.addTrack(r.getAudioTracks()[0],r)}else rn.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]),a.pc.addTrack(r.getAudioTracks()[0],r);if((!i.update&&ee(i)||i.update&&(i.addVideo||i.replaceVideo))&&r.getVideoTracks()&&r.getVideoTracks().length)if(a.myStream.addTrack(r.getVideoTracks()[0]),rn.unifiedPlan){rn.log((i.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]);var m=null;h=a.pc.getTransceivers();if(h&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind){m=f;break}m&&m.sender?m.sender.replaceTrack(r.getVideoTracks()[0]):a.pc.addTrack(r.getVideoTracks()[0],r)}else rn.log((i.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]),a.pc.addTrack(r.getVideoTracks()[0],r)}else a.myStream=r,o=!0;if(!a.pc){var v={iceServers:l,iceTransportPolicy:c,bundlePolicy:d};"chrome"===rn.webRTCAdapter.browserDetails.browser&&(v["sdpSemantics"]=rn.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var g={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&g.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"===typeof n.rtcConstraints)for(var _ in rn.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)g.optional.push(n.rtcConstraints[_]);"edge"===rn.webRTCAdapter.browserDetails.browser&&(v.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(n.senderTransforms||n.receiverTransforms)&&(a.senderTransforms=n.senderTransforms,a.receiverTransforms=n.receiverTransforms,v["forceEncodedAudioInsertableStreams"]=!0,v["forceEncodedVideoInsertableStreams"]=!0,v["encodedInsertableStreams"]=!0),rn.log("Creating PeerConnection"),rn.debug(g),a.pc=new RTCPeerConnection(v,g),rn.debug(a.pc),a.pc.getStats&&(a.volume={}),rn.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&s.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(t){if(!t.candidate||"edge"===rn.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)rn.log("End of candidates."),a.iceDone=!0,!0===a.trickle?E(e,{completed:!0}):V(e,n);else{var i={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===a.trickle&&E(e,i)}},a.pc.ontrack=function(e){if(rn.log("Handling Remote Track"),rn.debug(e),e.streams&&(a.remoteStream=e.streams[0],s.onremotestream(a.remoteStream),!e.track.onended)){if(a.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms["audio"]?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms["video"]&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var i=null;rn.log("Adding onended callback to track:",e.track),e.track.onended=function(e){rn.log("Remote track removed:",e),a.remoteStream&&(clearTimeout(i),a.remoteStream.removeTrack(e.target),s.onremotestream(a.remoteStream))},e.track.onmute=function(e){rn.log("Remote track muted:",e),a.remoteStream&&null==i&&(i=setTimeout((function(){rn.log("Removing remote track"),a.remoteStream&&(a.remoteStream.removeTrack(e.target),s.onremotestream(a.remoteStream),s.ontrackmuted()),i=null}),2520))},e.track.onunmute=function(e){if(rn.log("Remote track flowing again:",e),null!=i)clearTimeout(i),i=null;else try{a.remoteStream.addTrack(e.target),s.onremotestream(a.remoteStream),s.ontrackunmuted()}catch(t){rn.error(t)}}}}}if(o&&r){rn.log("Adding local stream");var w=!0===n.simulcast2;r.getTracks().forEach((function(e){rn.log("Adding local track:",e);var t=null;if(w&&"audio"!==e.kind){rn.log("Enabling rid-based simulcasting:",e);var i=b(n.simulcastMaxBitrates),s=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[r],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:i.high},{rid:"m",active:!0,maxBitrate:i.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:i.low,scaleResolutionDownBy:4}]});s&&(t=s.sender)}else t=a.pc.addTrack(e,r);if(t&&a.senderTransforms){var o=null;RTCRtpSender.prototype.createEncodedStreams?o=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&a.senderTransforms["audio"]?o=t.createEncodedAudioStreams():"video"===t.track.kind&&a.senderTransforms["video"]&&(o=t.createEncodedVideoStreams())),o&&(console.log(o),o.readableStream&&o.writableStream?o.readableStream.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(o.writableStream):o.readable&&o.writable&&o.readable.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(o.writable))}}))}if(re(i)&&!a.dataChannel[rn.dataChanDefaultLabel]&&(rn.log("Creating default data channel"),M(e,rn.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(t){rn.log("Data channel created by Janus:",t),M(e,t.channel.label,t.channel.protocol,t.channel)}),a.myStream&&s.onlocalstream(a.myStream),t){var C=t["sdp"],k=/420029/gi,S=C.replace(k,"42e01f");rn.log(S),t["sdp"]=S,a.pc.setRemoteDescription(t).then((function(){if(rn.log("Remote description accepted!"),a.remoteSdp=t.sdp,a.candidates&&a.candidates.length>0){for(var r=0;r<a.candidates.length;r++){var s=a.candidates[r];rn.debug("Adding remote candidate:",s),s&&!0!==s.completed?a.pc.addIceCandidate(s):a.pc.addIceCandidate(rn.endOfCandidates)}a.candidates=[]}z(e,i,n)}),n.error)}else U(e,i,n)}function B(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:rn.noop,i.error="function"==typeof i.error?i.error:J;var n=i.jsep;if(t&&n)return rn.error("Provided a JSEP to a createOffer"),void i.error("Provided a JSEP to a createOffer");if(!t&&(!n||!n.type||!n.sdp))return rn.error("A valid JSEP is required for createAnswer"),void i.error("A valid JSEP is required for createAnswer");i.media="object"===typeof i.media&&i.media?i.media:{audio:!0,video:!0};var r=i.media,s=y[e];if(!s||!s.webrtcStuff)return rn.warn("Invalid handle"),void i.error("Invalid handle");var a=s.webrtcStuff;if(a.trickle=se(i.trickle),a.pc){if(rn.log("Updating existing media session"),r.update=!0,i.stream)i.stream!==a.myStream&&rn.log("Renegotiation involves a new external stream");else{if(r.addAudio){if(r.keepAudio=!1,r.replaceAudio=!1,r.removeAudio=!1,r.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return rn.error("Can't add audio stream, there already is one"),void i.error("Can't add audio stream, there already is one")}else r.removeAudio?(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!1,r.audioSend=!1):r.replaceAudio&&(r.keepAudio=!1,r.addAudio=!1,r.removeAudio=!1,r.audioSend=!0);if(a.myStream&&a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!Q(r)||r.removeAudio||r.replaceAudio||(r.keepAudio=!0):(r.replaceAudio&&(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!0,r.audioSend=!0),Q(r)&&(r.keepAudio=!1,r.addAudio=!0)),r.addVideo){if(r.keepVideo=!1,r.replaceVideo=!1,r.removeVideo=!1,r.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return rn.error("Can't add video stream, there already is one"),void i.error("Can't add video stream, there already is one")}else r.removeVideo?(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!1,r.videoSend=!1):r.replaceVideo&&(r.keepVideo=!1,r.addVideo=!1,r.removeVideo=!1,r.videoSend=!0);a.myStream&&a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!ee(r)||r.removeVideo||r.replaceVideo||(r.keepVideo=!0):(r.replaceVideo&&(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!0,r.videoSend=!0),ee(r)&&(r.keepVideo=!1,r.addVideo=!0)),r.addData&&(r.data=!0)}if(Q(r)&&r.keepAudio&&ee(r)&&r.keepVideo)return s.consentDialog(!1),void j(e,n,r,i,a.myStream)}else r.update=!1,r.keepAudio=!1,r.keepVideo=!1;if(r.update&&(!a.streamExternal||a.streamExternal&&(r.replaceAudio||r.replaceVideo))){if(r.removeAudio||r.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var o=a.myStream.getAudioTracks()[0];rn.log("Removing audio track:",o),a.myStream.removeTrack(o);try{o.stop()}catch(T){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(r.replaceAudio&&rn.unifiedPlan&&(l=!1),l)for(var c of a.pc.getSenders())c&&c.track&&"audio"===c.track.kind&&(rn.log("Removing audio sender:",c),a.pc.removeTrack(c))}}if(r.removeVideo||r.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){var d=a.myStream.getVideoTracks()[0];rn.log("Removing video track:",d),a.myStream.removeTrack(d);try{d.stop()}catch(T){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var u=!0;if(r.replaceVideo&&rn.unifiedPlan&&(u=!1),u)for(var p of a.pc.getSenders())p&&p.track&&"video"===p.track.kind&&(rn.log("Removing video sender:",p),a.pc.removeTrack(p))}}}if(i.stream){var h=i.stream;return rn.log("MediaStream provided by the application"),rn.debug(h),!r.update||!a.myStream||a.myStream===i.stream||a.streamExternal||r.replaceAudio||r.replaceVideo||(rn.stopAllTracks(a.myStream),a.myStream=null),a.streamExternal=!0,s.consentDialog(!1),void j(e,n,r,i,h)}if(Q(r)||ee(r)){if(!rn.isGetUserMediaAvailable())return void i.error("getUserMedia not available");var f={mandatory:{},optional:[]};s.consentDialog(!0);var m=Q(r);m&&r&&"object"===typeof r.audio&&(m=r.audio);var v=ee(r);if(v&&r){var g=!0===i.simulcast,b=!0===i.simulcast2;if(!g&&!b||n||r.video||(r.video="hires"),r.video&&"screen"!=r.video&&"window"!=r.video)if("object"===typeof r.video)v=r.video;else{var _=0,w=0;"lowres"===r.video?(w=240,240,_=320):"lowres-16:9"===r.video?(w=180,180,_=320):"hires"===r.video||"hires-16:9"===r.video||"hdres"===r.video?(w=720,720,_=1280):"fhdres"===r.video?(w=1080,1080,_=1920):"4kres"===r.video?(w=2160,2160,_=3840):"stdres"===r.video?(w=480,480,_=640):"stdres-16:9"===r.video?(w=360,360,_=640):(rn.log("Default video setting is stdres 4:3"),w=480,480,_=640),rn.log("Adding media constraint:",r.video),v={height:{ideal:w},width:{ideal:_}},rn.log("Adding video constraint:",v)}else if("screen"===r.video||"window"===r.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return f.video={},r.screenshareFrameRate&&(f.video.frameRate=r.screenshareFrameRate),r.screenshareHeight&&(f.video.height=r.screenshareHeight),r.screenshareWidth&&(f.video.width=r.screenshareWidth),f.audio=r.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(f).then((function(t){s.consentDialog(!1),Q(r)&&!r.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(s){t.addTrack(s.getAudioTracks()[0]),j(e,n,r,i,t)})):j(e,n,r,i,t)}),(function(e){s.consentDialog(!1),i.error(e)}));function C(t,a){s.consentDialog(!1),t?i.error(t):j(e,n,r,i,a)}function k(e,t,i){rn.log("Adding media constraint (screen capture)"),rn.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){i?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){e.addTrack(i.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){s.consentDialog(!1),t(e)}))}if("chrome"===rn.webRTCAdapter.browserDetails.browser){var S=rn.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),S>=26&&S<=P?(f={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate,chromeMediaSource:"screen"}},audio:Q(r)&&!r.keepAudio},k(f,C)):rn.extension.getScreen((function(e,t){if(e)return s.consentDialog(!1),i.error(e);f={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},f.video.mandatory.chromeMediaSourceId=t,k(f,C,Q(r)&&!r.keepAudio)}))}else if("firefox"===rn.webRTCAdapter.browserDetails.browser){if(!(rn.webRTCAdapter.browserDetails.version>=33)){var x=new Error("NavigatorUserMediaError");return x.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",s.consentDialog(!1),void i.error(x)}f={video:{mozMediaSource:r.video,mediaSource:r.video},audio:Q(r)&&!r.keepAudio},k(f,(function(e,t){if(C(e,t),!e)var i=t.currentTime,n=window.setInterval((function(){t||window.clearInterval(n),t.currentTime==i&&(window.clearInterval(n),t.onended&&t.onended()),i=t.currentTime}),500)}))}return}}r&&"screen"===r.video||navigator.mediaDevices.enumerateDevices().then((function(t){var a=t.some((function(e){return"audioinput"===e.kind})),o=ne(r)||t.some((function(e){return"videoinput"===e.kind})),l=Q(r),c=ee(r),d=Z(r),u=te(r);if(l||c||d||u){var p=!!l&&a,f=!!c&&o;if(!p&&!f)return s.consentDialog(!1),i.error("No capture device found"),!1;if(!p&&d)return s.consentDialog(!1),i.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return s.consentDialog(!1),i.error("Video capture is required, but no capture device found"),!1}var g={audio:!(!a||r.keepAudio)&&m,video:!(!o||r.keepVideo)&&v};rn.debug("getUserMedia constraints",g),g.audio||g.video?navigator.mediaDevices.getUserMedia(g).then((function(t){s.consentDialog(!1),j(e,n,r,i,t)})).catch((function(e){s.consentDialog(!1),i.error({code:e.code,name:e.name,message:e.message})})):(s.consentDialog(!1),j(e,n,r,i,h))})).catch((function(e){s.consentDialog(!1),i.error(e)}))}else j(e,n,r,i)}function $(e,t){t=t||{},t.success="function"==typeof t.success?t.success:rn.noop,t.error="function"==typeof t.error?t.error:J,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:rn.noop;var i=t.jsep,n=y[e];if(!n||!n.webrtcStuff)return rn.warn("Invalid handle"),void t.error("Invalid handle");var r=n.webrtcStuff;if(i){if(!r.pc)return rn.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(i),r.pc.setRemoteDescription(i).then((function(){if(rn.log("Remote description accepted!"),r.remoteSdp=i.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var n=r.candidates[e];rn.debug("Adding remote candidate:",n),n&&!0!==n.completed?r.pc.addIceCandidate(n):r.pc.addIceCandidate(rn.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function U(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:rn.noop,i.error="function"==typeof i.error?i.error:rn.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:rn.noop;var n=y[e];if(!n||!n.webrtcStuff)return rn.warn("Invalid handle"),void i.error("Invalid handle");var r=n.webrtcStuff,s=!0===i.simulcast;s?rn.log("Creating offer (iceDone="+r.iceDone+", simulcast="+s+")"):rn.log("Creating offer (iceDone="+r.iceDone+")");var a={};if(rn.unifiedPlan){var o=null,l=null,c=r.pc.getTransceivers();if(c&&c.length>0)for(var d of c)d.sender&&d.sender.track&&"audio"===d.sender.track.kind||d.receiver&&d.receiver.track&&"audio"===d.receiver.track.kind?o||(o=d):(d.sender&&d.sender.track&&"video"===d.sender.track.kind||d.receiver&&d.receiver.track&&"video"===d.receiver.track.kind)&&(l||(l=d));var u=Q(t),p=X(t);u||p?u&&p?o&&(o.setDirection?o.setDirection("sendrecv"):o.direction="sendrecv",rn.log("Setting audio transceiver to sendrecv:",o)):u&&!p?o&&(o.setDirection?o.setDirection("sendonly"):o.direction="sendonly",rn.log("Setting audio transceiver to sendonly:",o)):!u&&p&&(o?(o.setDirection?o.setDirection("recvonly"):o.direction="recvonly",rn.log("Setting audio transceiver to recvonly:",o)):(o=r.pc.addTransceiver("audio",{direction:"recvonly"}),rn.log("Adding recvonly audio transceiver:",o))):t.removeAudio&&o&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive",rn.log("Setting audio transceiver to inactive:",o));var h=ee(t),f=ie(t);h||f?h&&f?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",rn.log("Setting video transceiver to sendrecv:",l)):h&&!f?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",rn.log("Setting video transceiver to sendonly:",l)):!h&&f&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",rn.log("Setting video transceiver to recvonly:",l)):(l=r.pc.addTransceiver("video",{direction:"recvonly"}),rn.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",rn.log("Setting video transceiver to inactive:",l))}else a["offerToReceiveAudio"]=X(t),a["offerToReceiveVideo"]=ie(t);var m=!0===i.iceRestart;m&&(a["iceRestart"]=!0),rn.debug(a);var v=ee(t);if(v&&s&&"firefox"===rn.webRTCAdapter.browserDetails.browser){rn.log("Enabling Simulcasting for Firefox (RID)");var g=r.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(g){var _=g.getParameters();_||(_={});var w=b(i.simulcastMaxBitrates);_.encodings=i.sendEncodings||[{rid:"h",active:!0,maxBitrate:w.high},{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:w.low,scaleResolutionDownBy:4}],g.setParameters(_)}}r.pc.createOffer(a).then((function(e){rn.debug(e);var t={type:e.type,sdp:e.sdp};i.customizeSdp(t),e.sdp=t.sdp,rn.log("Setting local description"),v&&s&&("chrome"===rn.webRTCAdapter.browserDetails.browser||"safari"===rn.webRTCAdapter.browserDetails.browser?(rn.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=K(e.sdp)):"firefox"!==rn.webRTCAdapter.browserDetails.browser&&rn.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp={type:"offer",sdp:e.sdp},r.pc.setLocalDescription(e).catch(i.error),r.mediaConstraints=a,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e["e2ee"]=!0),i.success(e)):rn.log("Waiting for all candidates...")}),i.error)}function z(e,t,i){i=i||{},i.success="function"==typeof i.success?i.success:rn.noop,i.error="function"==typeof i.error?i.error:rn.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:rn.noop;var n=y[e];if(!n||!n.webrtcStuff)return rn.warn("Invalid handle"),void i.error("Invalid handle");var r=n.webrtcStuff,s=!0===i.simulcast;s?rn.log("Creating answer (iceDone="+r.iceDone+", simulcast="+s+")"):rn.log("Creating answer (iceDone="+r.iceDone+")");var a=null;if(rn.unifiedPlan){a={};var o=null,l=null,c=r.pc.getTransceivers();if(c&&c.length>0)for(var d of c)d.sender&&d.sender.track&&"audio"===d.sender.track.kind||d.receiver&&d.receiver.track&&"audio"===d.receiver.track.kind?o||(o=d):(d.sender&&d.sender.track&&"video"===d.sender.track.kind||d.receiver&&d.receiver.track&&"video"===d.receiver.track.kind)&&(l||(l=d));var u=Q(t),p=X(t);if(u||p){if(u&&p){if(o)try{o.setDirection?o.setDirection("sendrecv"):o.direction="sendrecv",rn.log("Setting audio transceiver to sendrecv:",o)}catch(w){rn.error(w)}}else if(u&&!p)try{o&&(o.setDirection?o.setDirection("sendonly"):o.direction="sendonly",rn.log("Setting audio transceiver to sendonly:",o))}catch(w){rn.error(w)}else if(!u&&p)if(o)try{o.setDirection?o.setDirection("recvonly"):o.direction="recvonly",rn.log("Setting audio transceiver to recvonly:",o)}catch(w){rn.error(w)}else o=r.pc.addTransceiver("audio",{direction:"recvonly"}),rn.log("Adding recvonly audio transceiver:",o)}else if(t.removeAudio&&o)try{o.setDirection?o.setDirection("inactive"):o.direction="inactive",rn.log("Setting audio transceiver to inactive:",o)}catch(w){rn.error(w)}var h=ee(t),f=ie(t);if(h||f){if(h&&f){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",rn.log("Setting video transceiver to sendrecv:",l)}catch(w){rn.error(w)}}else if(h&&!f){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",rn.log("Setting video transceiver to sendonly:",l)}catch(w){rn.error(w)}}else if(!h&&f)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",rn.log("Setting video transceiver to recvonly:",l)}catch(w){rn.error(w)}else l=r.pc.addTransceiver("video",{direction:"recvonly"}),rn.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",rn.log("Setting video transceiver to inactive:",l)}catch(w){rn.error(w)}}else a="firefox"===rn.webRTCAdapter.browserDetails.browser||"edge"===rn.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:X(t),offerToReceiveVideo:ie(t)}:{mandatory:{OfferToReceiveAudio:X(t),OfferToReceiveVideo:ie(t)}};rn.debug(a);var m=ee(t);if(m&&s&&"firefox"===rn.webRTCAdapter.browserDetails.browser){rn.log("Enabling Simulcasting for Firefox (RID)");var v=r.pc.getSenders()[1];rn.log(v);var g=v.getParameters();rn.log(g);var _=b(i.simulcastMaxBitrates);v.setParameters({encodings:i.sendEncodings||[{rid:"h",active:!0,maxBitrate:_.high},{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:_.low,scaleResolutionDownBy:4}]})}r.pc.createAnswer(a).then((function(e){rn.debug(e);var t={type:e.type,sdp:e.sdp};i.customizeSdp(t),e.sdp=t.sdp,rn.log("Setting local description"),m&&s&&("chrome"===rn.webRTCAdapter.browserDetails.browser?rn.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==rn.webRTCAdapter.browserDetails.browser&&rn.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp={type:"answer",sdp:e.sdp},r.pc.setLocalDescription(e).catch(i.error),r.mediaConstraints=a,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e["e2ee"]=!0),i.success(e)):rn.log("Waiting for all candidates...")}),i.error)}function V(e,t){t=t||{},t.success="function"==typeof t.success?t.success:rn.noop,t.error="function"==typeof t.error?t.error:rn.noop;var i=y[e];if(i&&i.webrtcStuff){var n=i.webrtcStuff;rn.log("Sending offer/answer SDP..."),n.mySdp?(n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp["trickle"]=!1),rn.debug(t),n.sdpSent=!0,t.success(n.mySdp)):rn.warn("Local SDP instance is invalid, not sending anything...")}else rn.warn("Invalid handle, not sending anything")}function W(e,t){var i=y[e];if(!i||!i.webrtcStuff)return rn.warn("Invalid handle"),0;var n=t?"remote":"local",r=i.webrtcStuff;return r.volume[n]||(r.volume[n]={value:0}),!r.pc.getStats||"chrome"!==rn.webRTCAdapter.browserDetails.browser&&"safari"!==rn.webRTCAdapter.browserDetails.browser?(rn.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!r.remoteStream?(rn.warn("Remote stream unavailable"),0):t||r.myStream?r.volume[n].timer?r.volume[n].value:(rn.log("Starting "+n+" volume monitor"),r.volume[n].timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(r.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(rn.warn("Local stream unavailable"),0)}function q(e,t){var i=y[e];if(!i||!i.webrtcStuff)return rn.warn("Invalid handle"),!0;var n=i.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(rn.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(rn.warn("No audio track"),!0):(rn.warn("Invalid local MediaStream"),!0):(rn.warn("Invalid PeerConnection"),!0)}function G(e,t,i){var n=y[e];if(!n||!n.webrtcStuff)return rn.warn("Invalid handle"),!1;var r=n.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?(r.myStream.getVideoTracks()[0].enabled=!i,!0):(rn.warn("No video track"),!1):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?(r.myStream.getAudioTracks()[0].enabled=!i,!0):(rn.warn("No audio track"),!1):(rn.warn("Invalid local MediaStream"),!1):(rn.warn("Invalid PeerConnection"),!1)}function H(e){var t=y[e];if(!t||!t.webrtcStuff)return rn.warn("Invalid handle"),"Invalid handle";var i=t.webrtcStuff;return i.pc?i.pc.getStats?(i.bitrate.timer||(rn.log("Starting bitrate timer (via getStats)"),i.bitrate.timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(i.bitrate.fps=e.framesPerSecond,i.bitrate.bsnow=e.bytesReceived,i.bitrate.tsnow=e.timestamp,null===i.bitrate.bsbefore||null===i.bitrate.tsbefore)i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow;else{var n=i.bitrate.tsnow-i.bitrate.tsbefore;"safari"===rn.webRTCAdapter.browserDetails.browser&&(n/=1e3);var r=Math.round(8*(i.bitrate.bsnow-i.bitrate.bsbefore)/n);"safari"===rn.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),i.bitrate.value=r+" kbps",i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow}}}))}))}),1e3)),i.bitrate):(rn.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){rn.error("WebRTC error:",e)}function Y(e,n){rn.log("Cleaning WebRTC stuff");var r=y[e];if(r){var s=r.webrtcStuff;if(s){if(!0===n){var a={janus:"hangup",transaction:rn.randomString(12)};r.token&&(a["token"]=r.token),m&&(a["apisecret"]=m),rn.debug("Sending hangup request (handle="+e+"):"),rn.debug(a),t?(a["session_id"]=w,a["handle_id"]=e,i.send(JSON.stringify(a))):rn.httpAPICall(o+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:a})}s.remoteStream=null,s.volume&&(s.volume["local"]&&s.volume["local"].timer&&clearInterval(s.volume["local"].timer),s.volume["remote"]&&s.volume["remote"].timer&&clearInterval(s.volume["remote"].timer)),s.volume={},s.bitrate.timer&&clearInterval(s.bitrate.timer),s.bitrate.timer=null,s.bitrate.bsnow=null,s.bitrate.bsbefore=null,s.bitrate.tsnow=null,s.bitrate.tsbefore=null,s.bitrate.value=null,!s.streamExternal&&s.myStream&&(rn.log("Stopping local stream tracks"),rn.stopAllTracks(s.myStream)),s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(l){}s.pc=null,s.candidates=null,s.mySdp=null,s.remoteSdp=null,s.iceDone=!1,s.dataChannel={},s.dtmfSender=null,s.senderTransforms=null,s.receiverTransforms=null}r.oncleanup()}}function K(e){for(var t=e.split("\r\n"),i=!1,n=[-1],r=[-1],s=null,a=null,o=null,l=null,c=-1,d=0;d<t.length;d++){var u=t[d].match(/m=(\w+) */);if(u){var p=u[1];if("video"===p){if(!(n[0]<0)){c=d;break}i=!0}else if(n[0]>-1){c=d;break}}else if(i){var h=t[d].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/);if(h)return rn.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var f=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)n[0]=f[1],r[0]=f[2],t.splice(d,1),d--;else{if(n[0]){var m=t[d].match("a=ssrc:"+n[0]+" cname:(.+)");if(m&&(s=m[1]),m=t[d].match("a=ssrc:"+n[0]+" msid:(.+)"),m&&(a=m[1]),m=t[d].match("a=ssrc:"+n[0]+" mslabel:(.+)"),m&&(o=m[1]),m=t[d].match("a=ssrc:"+n[0]+" label:(.+)"),m&&(l=m[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+n[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(n[0]<0){c=-1,i=!1;for(d=0;d<t.length;d++){u=t[d].match(/m=(\w+) */);if(u){p=u[1];if("video"===p){if(!(n[0]<0)){c=d;break}i=!0}else if(n[0]>-1){c=d;break}}else if(i){if(n[0]<0){var v=t[d].match(/a=ssrc:(\d+)/);if(v){n[0]=v[1],t.splice(d,1),d--;continue}}else{m=t[d].match("a=ssrc:"+n[0]+" cname:(.+)");if(m&&(s=m[1]),m=t[d].match("a=ssrc:"+n[0]+" msid:(.+)"),m&&(a=m[1]),m=t[d].match("a=ssrc:"+n[0]+" mslabel:(.+)"),m&&(o=m[1]),m=t[d].match("a=ssrc:"+n[0]+" label:(.+)"),m&&(l=m[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+n[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(n[0]<0)return rn.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=t.length),n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(d=0;d<n.length;d++)s&&(t.splice(c,0,"a=ssrc:"+n[d]+" cname:"+s),c++),a&&(t.splice(c,0,"a=ssrc:"+n[d]+" msid:"+a),c++),o&&(t.splice(c,0,"a=ssrc:"+n[d]+" mslabel:"+o),c++),l&&(t.splice(c,0,"a=ssrc:"+n[d]+" label:"+l),c++),s&&(t.splice(c,0,"a=ssrc:"+r[d]+" cname:"+s),c++),a&&(t.splice(c,0,"a=ssrc:"+r[d]+" msid:"+a),c++),o&&(t.splice(c,0,"a=ssrc:"+r[d]+" mslabel:"+o),c++),l&&(t.splice(c,0,"a=ssrc:"+r[d]+" label:"+l),c++);return t.splice(c,0,"a=ssrc-group:FID "+n[2]+" "+r[2]),t.splice(c,0,"a=ssrc-group:FID "+n[1]+" "+r[1]),t.splice(c,0,"a=ssrc-group:FID "+n[0]+" "+r[0]),t.splice(c,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function Q(e){return rn.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function Z(e){return rn.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function X(e){return rn.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function ee(e){return rn.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function te(e){return rn.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function ie(e){return rn.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function ne(e){if(rn.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;return t.chromeMediaSource?"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource:t.mozMediaSource?"window"===t.mozMediaSource||"screen"===t.mozMediaSource:!!t.mediaSource&&("window"===t.mediaSource||"screen"===t.mediaSource)}function re(e){return rn.debug("isDataEnabled:",e),"edge"===rn.webRTCAdapter.browserDetails.browser?(rn.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function se(e){return rn.debug("isTrickleEnabled:",e),!1!==e}F(e),this.getServer=function(){return o},this.isConnected=function(){return _},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:rn.noop,e.error="function"==typeof e.error?e.error:rn.noop,e["reconnect"]=!0,F(e)},this.getSessionId=function(){return w},this.getInfo=function(e){D(e)},this.destroy=function(e){I(e)},this.attach=function(e){O(e)}}rn.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,i=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||nn,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||tn["a"],httpAPICall:function(e,n){var r={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(r.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(r.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(r.body=JSON.stringify(n.body));var s=t(e,r).catch((function(e){return i.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var a=new i((function(e,t){var i=setTimeout((function(){return clearTimeout(i),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));s=i.race([s,a])}return s.then((function(e){return e.ok?typeof n.success===typeof rn.noop?e.json().then((function(e){try{n.success(e)}catch(t){rn.error("Unhandled httpAPICall success callback error",t)}}),(function(t){return i.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:i.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error===typeof rn.noop&&n.error(e.message||"<< internal error >>",e)})),s}}},rn.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,i=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new i(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||nn,webRTCAdapter:e&&e.adapter||tn["a"],httpAPICall:function(e,i){var n=void 0!==i.body?{contentType:"application/json",data:JSON.stringify(i.body)}:{},r=void 0!==i.withCredentials?{xhrFields:{withCredentials:i.withCredentials}}:{};return t.ajax(t.extend(n,r,{url:e,type:i.verb,cache:!1,dataType:"json",async:i.async,timeout:i.timeout,success:function(e){typeof i.success===typeof rn.noop&&i.success(e)},error:function(e,t,n){typeof i.error===typeof rn.noop&&i.error(t,n)}}))}}},rn.noop=function(){},rn.dataChanDefaultLabel="JanusDataChannel",rn.endOfCandidates=null,rn.stopAllTracks=function(e){try{var t=e.getTracks();for(var i of t)rn.log(i),i&&i.stop()}catch(n){}},rn.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:rn.noop,rn.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),rn.trace=rn.noop,rn.debug=rn.noop,rn.vdebug=rn.noop,rn.log=rn.noop,rn.warn=rn.noop,rn.error=rn.noop,!0===e.debug||"all"===e.debug)rn.trace=console.trace.bind(console),rn.debug=console.debug.bind(console),rn.vdebug=console.debug.bind(console),rn.log=console.log.bind(console),rn.warn=console.warn.bind(console),rn.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":rn.trace=console.trace.bind(console);break;case"debug":rn.debug=console.debug.bind(console);break;case"vdebug":rn.vdebug=console.debug.bind(console);break;case"log":rn.log=console.log.bind(console);break;case"warn":rn.warn=console.warn.bind(console);break;case"error":rn.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}rn.log("Initializing library");var i=e.dependencies||rn.useDefaultDependencies();rn.isArray=i.isArray,rn.webRTCAdapter=i.webRTCAdapter,rn.httpAPICall=i.httpAPICall,rn.newWebSocket=i.newWebSocket,rn.extension=i.extension,rn.extension.init(),rn.listDevices=function(e,t){e="function"==typeof e?e:rn.noop,null==t&&(t={audio:!0,video:!0}),rn.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(i){rn.debug(i),e(i),rn.stopAllTracks(t)}))})).catch((function(t){rn.error(t),e([])})):(rn.warn("navigator.mediaDevices unavailable"),e([]))},rn.attachMediaStream=function(e,t){try{e.srcObject=t}catch(i){try{e.src=URL.createObjectURL(t)}catch(i){rn.error("Error attaching stream to element")}}},rn.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(i){try{e.src=t.src}catch(i){rn.error("Error reattaching stream to element")}}};var n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,r=n?"pagehide":"beforeunload",s=window["on"+r];if(window.addEventListener(r,(function(e){for(var t in rn.log("Closing window"),rn.sessions)rn.sessions[t]&&rn.sessions[t].destroyOnUnload&&(rn.log("Destroying session "+t),rn.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));s&&"function"==typeof s&&s()})),rn.safariVp8=!1,"safari"===rn.webRTCAdapter.browserDetails.browser&&rn.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var a of RTCRtpSender.getCapabilities("video").codecs)if(a&&a.mimeType&&"video/vp8"===a.mimeType.toLowerCase()){rn.safariVp8=!0;break}rn.safariVp8?rn.log("This version of Safari supports VP8"):rn.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var o=new RTCPeerConnection({});o.createOffer({offerToReceiveVideo:!0}).then((function(e){rn.safariVp8=-1!==e.sdp.indexOf("VP8"),rn.safariVp8?rn.log("This version of Safari supports VP8"):rn.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),o.close(),o=null}))}if(rn.unifiedPlan=!1,"firefox"===rn.webRTCAdapter.browserDetails.browser&&rn.webRTCAdapter.browserDetails.version>=59)rn.unifiedPlan=!0;else if("chrome"===rn.webRTCAdapter.browserDetails.browser&&rn.webRTCAdapter.browserDetails.version>=72)rn.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var l=new RTCPeerConnection;try{l.addTransceiver("audio"),rn.unifiedPlan=!0}catch(c){}l.close()}else rn.unifiedPlan=!1;rn.initDone=!0,e.callback()}},rn.isWebrtcSupported=function(){return!!window.RTCPeerConnection},rn.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},rn.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);i+=t.substring(r,r+1)}return i};var sn=rn;let an=e=>`/ws/janus/${e}/`,on=e=>`/ws/share_token/janus/${e}/`;function ln(e){const t=window.location.hostname.replace("app","turn");return[{urls:["stun:stun.l.google.com:19302"]},{urls:`turn:${t}:80?transport=udp`,credential:e,username:e},{urls:`turn:${t}:80?transport=tcp`,credential:e,username:e}]}function cn(){let e={callbacks:{},initialized:!1,mainWebRTCConn:un(),mjpegWebRTCConn:dn(),openForShareToken(t){e.connect(on(t),t)},openForPrinter(t,i){e.connect(an(t),i)},connect(t,i){e.initialized=!0,e.mainWebRTCConn.connect(t,i),e.mjpegWebRTCConn.connect(t,i)},stopStream(){e.mainWebRTCConn.stopStream(),e.mjpegWebRTCConn.stopStream()},sendData(t){e.mainWebRTCConn.sendData(t)},startStream(){e.mainWebRTCConn.startStream(),e.mjpegWebRTCConn.startStream()},setCallbacks(t){e.callbacks={...e.callbacks,...t},e.mainWebRTCConn.callbacks=e.callbacks,e.mjpegWebRTCConn.callbacks=e.callbacks}};return e}function dn(){let e={callbacks:{},streamId:void 0,streaming:void 0,bitrateInterval:null,connect(t,i){sn.init({debug:"all",callback:()=>{sn.isWebrtcSupported()&&e.connectJanusWebSocket(t,i)}})},connectJanusWebSocket(t,i){var n=new sn({server:window.location.protocol.replace("http","ws")+"//"+window.location.host+t,iceServers:ln(i),ipv6:!0,success:()=>{n.attach({plugin:"janus.plugin.streaming",opaqueId:"streamingtest-"+sn.randomString(12),success:function(t){sn.log("Plugin attached! ("+t.getPlugin()+", id="+t.getId()+")");const i={request:"info",id:2};sn.debug("Sending message ("+JSON.stringify(i)+")"),t.send({message:i,success:function(i){let r=H()(i,"info");r?(e.streamId=r.id,e.streaming=t,"data"===H()(r,"media[0].type")&&e.callbacks.onStreamAvailable()):n.destroy()}})},error:function(e){sn.error("  -- Error attaching plugin... ",e),n.destroy()},onmessage:function(t,i){e.onMessage(t,i)},onremotestream:function(e){},ondataopen:function(){},ondata:function(t){"onMJpegData"in e.callbacks&&e.callbacks.onMJpegData(t)},oncleanup:function(){}})},error(e){sn.error("  -- Error -- ",e),n.destroy()},destroyed(){e.streaming=void 0,e.streamId=void 0}})},onMessage(e,t){let i=this;sn.debug(" ::: Got a message :::"),sn.debug(e);let n=e["result"];if(null!==n&&void 0!==n){if(void 0!==n["status"]&&null!==n["status"]){var r=n["status"];"starting"===r?console.log("Starting"):"started"===r?console.log("Started"):"stopped"===r&&i.stopStream()}}else if(void 0!==e["error"]&&null!==e["error"])return sn.error(e),void i.stopStream();var s;void 0!==t&&null!==t&&(null===(s=i.streaming)||void 0===s||s.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var t;sn.debug("Got SDP!"),sn.debug(e);var n={request:"start"};null===(t=i.streaming)||void 0===t||t.send({message:n,jsep:e})},error:function(e){sn.error("WebRTC error:",e)}}))},channelOpen(){return!(void 0===e.streamId||void 0===e.streaming)},startStream(){var t;if(!e.channelOpen())return;const i={request:"watch",offer_video:!1,id:parseInt(e.streamId)};null===(t=e.streaming)||void 0===t||t.send({message:i})},stopStream(){var t,i;const n={request:"stop"};null===(t=e.streaming)||void 0===t||t.send({message:n}),null===(i=e.streaming)||void 0===i||i.hangup()}};return e}function un(){let e={callbacks:{},streamId:void 0,streaming:void 0,bitrateInterval:null,connect(t,i){sn.init({debug:"all",callback:()=>{sn.isWebrtcSupported()&&e.connectJanusWebSocket(t,i)}})},connectJanusWebSocket(t,i){var n=new sn({server:window.location.protocol.replace("http","ws")+"//"+window.location.host+t,iceServers:ln(i),ipv6:!0,success:()=>{n.attach({plugin:"janus.plugin.streaming",opaqueId:"streamingtest-"+sn.randomString(12),success:function(t){[0,1].forEach(i=>{const n={request:"info",id:i};sn.debug("Sending message ("+JSON.stringify(n)+")"),t.send({message:n,success:function(i){let n=H()(i,"info");if(n){e.streamId=n.id,e.streaming=t;const i=H()(n,"video")||en()(H()(n,"media",[]),{type:"video"});i&&e.callbacks.onStreamAvailable()}}})})},error:function(e){sn.error("  -- Error attaching plugin... ",e),n.destroy()},onmessage:function(t,i){e.onMessage(t,i)},onremotestream:function(t){sn.debug(" ::: Got a remote stream :::"),sn.debug(t),"onRemoteStream"in e.callbacks&&e.callbacks.onRemoteStream(t)},ontrackmuted:function(){"onTrackMuted"in e.callbacks&&e.callbacks.onTrackMuted()},ontrackunmuted:function(){"onTrackUnmuted"in e.callbacks&&e.callbacks.onTrackUnmuted()},slowLink:function(t,i){"onSlowLink"in e.callbacks&&e.callbacks.onSlowLink(i)},ondataopen:function(){},ondata:function(t){"onData"in e.callbacks&&e.callbacks.onData(t)},oncleanup:function(){"onDefaultStreamCleanup"in e.callbacks&&e.callbacks.onDefaultStreamCleanup()}})},error(e){sn.error("  -- Error -- ",e),n.destroy()},destroyed(){e.streaming=void 0,e.streamId=void 0,e.clearBitrateInterval()}})},onMessage(e,t){let i=this;sn.debug(" ::: Got a message :::"),sn.debug(e);let n=e["result"];if(null!==n&&void 0!==n){if(void 0!==n["status"]&&null!==n["status"]){var r=n["status"];"starting"===r?console.log("Starting"):"started"===r?console.log("Started"):"stopped"===r&&i.stopStream()}}else if(void 0!==e["error"]&&null!==e["error"])return sn.error(e),void i.stopStream();var s;void 0!==t&&null!==t&&(null===(s=i.streaming)||void 0===s||s.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var t;sn.debug("Got SDP!"),sn.debug(e);var n={request:"start"};null===(t=i.streaming)||void 0===t||t.send({message:n,jsep:e})},error:function(e){sn.error("WebRTC error:",e)}}))},channelOpen(){return!(void 0===e.streamId||void 0===e.streaming)},startStream(){var t;if(!e.channelOpen())return;const i={request:"watch",offer_video:!0,id:parseInt(e.streamId)};null===(t=e.streaming)||void 0===t||t.send({message:i}),e.clearBitrateInterval(),e.bitrateInterval=setInterval((function(){if(e.streaming){const t=e.streaming.getBitrate();t&&t.value?e.callbacks.onBitrateUpdated(e.streaming.getBitrate()):e.callbacks.onBitrateUpdated({value:null})}else e.callbacks.onBitrateUpdated({value:null})}),5e3)},stopStream(){var t,i;if(e.clearBitrateInterval(),!e.channelOpen())return;const n={request:"stop"};null===(t=e.streaming)||void 0===t||t.send({message:n}),null===(i=e.streaming)||void 0===i||i.hangup()},sendData(t){var i;e.channelOpen()&&(null===(i=e.streaming)||void 0===i||i.data({text:t,success:()=>{}}))},clearBitrateInterval(){e.bitrateInterval&&(clearInterval(e.bitrateInterval),e.bitrateInterval=null,e.callbacks.onBitrateUpdated({value:null}))}};return e}var pn=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-img-top webcam_container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.slowLinkLoss>50,expression:"slowLinkLoss > 50"}],ref:"slowLinkWrapper",staticClass:"slow-link-wrapper",on:{click:e.slowLinkClicked,mouseenter:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!0,e.slowLinkHiding=!1},mouseleave:function(t){e.fixSlowLinkTextWidth(),e.slowLinkShowing=!1,e.slowLinkHiding=!0}}},[e._m(0),t("div",{ref:"slowLinkText",staticClass:"text",class:{"show-and-hide":!e.slowLinkShowing&&!e.slowLinkHiding,showing:e.slowLinkShowing&&!e.slowLinkHiding,hiding:!e.slowLinkShowing&&e.slowLinkHiding}},[e._v(" Video frames dropped ")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.trackMuted,expression:"trackMuted"}],staticClass:"muted-status-wrapper"},[t("div",{staticClass:"text"},[e._v("Buffering...")]),t("a",{attrs:{href:"#"},on:{click:function(t){return e.showMutedStatusDescription(t)}}},[e._v("Why is it stuck?")])]),e.isVideoAvailable&&!e.autoplay&&(e.isBasicStreamingReadyToPlay||e.isBasicStreamingFrozen)?t("b-button",{staticClass:"centered-element p-0",attrs:{disabled:e.isBasicStreamingFrozen},on:{click:e.onPlayBtnClicked}},[e.isBasicStreamingReadyToPlay?t("i",{staticClass:"fas fa-play ml-1"}):e._e(),e.isBasicStreamingFrozen?t("span",{staticClass:"medium"},[e._v(e._s(e.remainingSecondsUntilNextCycle)+"s")]):e._e()]):e._e(),e.trackMuted||e.videoLoading?t("b-spinner",{staticClass:"centered-element",attrs:{label:"Buffering..."}}):e._e(),e.isVideoAvailable?t("div",[!e.autoplay&&e.isBasicStreamingInProgress||e.currentBitrate?t("div",{staticClass:"streaming-info overlay-info small",class:{clickable:e.isBasicStreamingInProgress},on:{click:e.onInfoClicked}},[e.isBasicStreamingInProgress?t("div",{staticClass:"text-success"},[e._v(" "+e._s(e.remainingSecondsCurrentVideoCycle)+" ")]):e._e(),e.currentBitrate?t("div",[e._v(e._s(e.currentBitrate))]):e._e()]):e._e(),e.autoplay||!e.isBasicStreamingReadyToPlay&&!e.isBasicStreamingFrozen?e._e():t("div",{staticClass:"streaming-guide overlay-info",on:{click:e.onInfoClicked}},[e.isBasicStreamingReadyToPlay?t("div",{staticClass:"message"},[e._v(" Webcam streams up to 5 FPS for Free ")]):e._e(),e.isBasicStreamingFrozen?t("div",{staticClass:"message text-warning"},[e._v(" "+e._s(e.remainingSecondsUntilNextCycle)+"s left in the cooldown period ")]):e._e(),t("a",{staticClass:"learn-more",attrs:{href:"#"}},[e._v("Learn more...")])])]):e._e(),t("div",{class:e.webcamRotateClass},[t("div",{staticClass:"webcam_fixed_ratio",class:e.webcamRatioClass},[t("div",{staticClass:"webcam_fixed_ratio_inner full"},[e.taggedSrc!==e.printerStockImgSrc?t("img",{staticClass:"tagged-jpg",class:{flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{src:e.taggedSrc,alt:e.printer.name+" current image"}}):t("svg",{staticClass:"poster-placeholder"},[t("use",{attrs:{href:e.printerStockImgSrc}})])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showMJpeg,expression:"showMJpeg"}],staticClass:"webcam_fixed_ratio_inner ontop full"},[t("img",{staticClass:"tagged-jpg",attrs:{src:e.mjpgSrc}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showVideo,expression:"showVideo"}],staticClass:"webcam_fixed_ratio_inner ontop full"},[t("video",{ref:"video",staticClass:"remote-video",class:{flipH:e.printer.settings.webcam_flipH,flipV:e.printer.settings.webcam_flipV},attrs:{width:"960",height:e.webcamVideoHeight,poster:e.taggedSrc!==e.printerStockImgSrc?e.taggedSrc:"",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0},on:{loadstart:function(t){return e.onLoadStart()},canplay:function(t){return e.onCanPlay()}}})])])])],1)},hn=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"icon bg-warning"},[t("i",{staticClass:"fas fa-exclamation"})])}];function fn(e,t){const i="tsNextVideoCycle-"+e;let n,r={countDownTimer:null};if(r.startOrResumeVideoCycle=function(){r.countDownTimer||(r.countDownTimer=setInterval(()=>r.countDown(),1e3))},r.resumeVideoCycle=function(){n<60&&!r.countDownTimer&&(r.countDownTimer=setInterval(()=>r.countDown(),1e3))},r.countDown=function(){r.updateRemainingSeconds(n-1),Object(a["a"])()&&localStorage.setItem(i,(new Date).getTime()/1e3+n),n<0&&(r.updateRemainingSeconds(60),clearInterval(this.countDownTimer),this.countDownTimer=null)},r.updateRemainingSeconds=function(e){n=e;const i=n-30,r=n>30?-1:n;t(i,r)},Object(a["a"])()){const e=parseFloat(localStorage.getItem(i)),t=(new Date).getTime()/1e3;!e||t>e?r.updateRemainingSeconds(60):r.updateRemainingSeconds(Math.round(e-t))}else r.updateRemainingSeconds(60);return r}function mn(e){const t={onFrame:e,contentLength:NaN,imageBuffer:"",bytesRead:0,originalJpgLength:0,onMJpegChunk:function(e){Object(Xt["f"])(e,e=>{const i=new TextDecoder("utf-8").decode(new Uint8Array(e));if(t.contentLength){if(t.imageBuffer+=i,t.bytesRead+=i.length,t.bytesRead>=t.contentLength){const e=t.imageBuffer,i=t.originalJpgLength;t.contentLength=NaN,t.imageBuffer="",t.bytesRead=0,t.originalJpgLength=0,t.onFrame(e,i)}}else if("\r\n"==i.slice(0,2)&&"\r\n"==i.slice(i.length-2)){const e=i.slice(2,i.length-2).split(":");t.contentLength=parseInt(e[0]),t.originalJpgLength=parseInt(e[1])}})}};return t}var vn={name:"StreamingBox",props:{printer:{type:Object,required:!0},webrtc:{type:Object,default:null},autoplay:{type:Boolean,required:!0}},data(){return{stickyStreamingSrc:null,isVideoAvailable:!1,isVideoVisible:!1,remainingSecondsCurrentVideoCycle:30,remainingSecondsUntilNextCycle:-1,currentBitrate:null,slowLinkLoss:0,slowLinkShowing:!1,slowLinkHiding:!1,trackMuted:!1,videoLoading:!1,printerStockImgSrc:"#svg-3d-printer",mjpgSrc:null}},computed:{taggedImgAvailable(){return this.taggedSrc!==this.printerStockImgSrc},showVideo(){return this.isVideoVisible&&"IMAGE"!==this.stickyStreamingSrc},showMJpeg(){return this.mjpgSrc&&"IMAGE"!==this.stickyStreamingSrc},webcamRotateClass(){switch(this.printer.settings.webcam_rotate90){case!0:return"webcam_rotated";case!1:return"webcam_unrotated";default:return"webcam_unrotated"}},webcamRatioClass(){switch(this.printer.settings.ratio169){case!0:return"ratio169";case!1:return"ratio43";default:return"ratio43"}},webcamVideoHeight(){switch(this.printer.settings.ratio169){case!0:return 540;case!1:return 720;default:return 720}},taggedSrc(){return H()(this.printer,"pic.img_url",this.printerStockImgSrc)},isBasicStreamingInProgress(){return this.remainingSecondsCurrentVideoCycle>0&&this.remainingSecondsCurrentVideoCycle<30},isBasicStreamingReadyToPlay(){return!this.isVideoVisible&&!this.trackMuted&&!this.videoLoading&&(30==this.remainingSecondsCurrentVideoCycle||0==this.remainingSecondsUntilNextCycle)},isBasicStreamingFrozen(){return this.remainingSecondsUntilNextCycle>0&&!this.isVideoVisible}},created(){this.mjpegStreamDecoder=new mn((e,t)=>{this.mjpgSrc="data:image/jpg;base64, "+e,this.onCanPlay()}),this.webrtc&&(this.webrtc.setCallbacks({onStreamAvailable:this.onStreamAvailable,onRemoteStream:this.onWebRTCRemoteStream,onDefaultStreamCleanup:()=>this.isVideoVisible=!1,onSlowLink:this.onSlowLink,onTrackMuted:()=>this.trackMuted=!0,onTrackUnmuted:()=>this.trackMuted=!1,onBitrateUpdated:e=>this.currentBitrate=e.value,onMJpegData:this.mjpegStreamDecoder.onMJpegChunk}),this.autoplay||(this.videoLimit=fn(this.printer.id,this.countDownCallback)),Di.a.on("blur",()=>{this.webrtc&&this.webrtc.stopStream()}),Di.a.on("focus",()=>{this.webrtc&&this.autoplay&&this.webrtc.startStream()}))},methods:{onCanPlay(){this.videoLoading=!1,this.autoplay||this.videoLimit.startOrResumeVideoCycle()},onLoadStart(){this.videoLoading=!0},onStreamAvailable(){if(this.autoplay)this.webrtc.startStream();else{if(!this.printer.basicStreamingInWebrtc())return;!this.autoplay&&this.isBasicStreamingInProgress&&this.webrtc.startStream(),this.videoLimit.resumeVideoCycle()}this.isVideoAvailable=!0},onWebRTCRemoteStream(e){sn.attachMediaStream(this.$refs.video,e);const t=e.getVideoTracks();null===t||void 0===t||0===t.length?this.isVideoVisible=!1:this.isVideoVisible=!0},countDownCallback(e,t){this.remainingSecondsCurrentVideoCycle>0&&e<=0&&this.webrtc.stopStream(),this.remainingSecondsCurrentVideoCycle=e,this.remainingSecondsUntilNextCycle=t},onInfoClicked(){this.autoplay||this.$swal.Prompt.fire({title:"Upgrade for Better Streaming",html:'\n          <p>Because you are now on the <a target="_blank" href="https://www.obico.io/docs/user-guides/upgrade-to-pro/?source=basic_streaming">Obico Cloud Free plan</a>:</p>\n          <ul>\n            <li>Streaming is limited to 5 FPS (frames per second).</li>\n            <li>After 30 seconds of streaming there is a 30-second cooldown before you can resume streaming.</li>\n          </ul>\n          <p>Support the Obico project by <a href="https://app.obico.io/ent_pub/pricing/?source=basic_streaming">upgrading to the Pro plan for little more than 1 Starbucks a month.</a></p> The Pro plan offers many perks, including the <a target="_blank" href="https://www.obico.io/docs/user-guides/webcam-streaming-for-human-eyes/?source=basic_streaming">Premium Streaming</a>:</p>\n          <ul>\n            <li>Smooth 25 FPS.</li>\n            <li>Unlimited streaming with no cooldowns.</li>\n          </ul>\n\n        ',showCloseButton:!0})},onPlayBtnClicked(){this.webrtc.startStream()},fixSlowLinkTextWidth(){const e=window.getComputedStyle(this.$refs.slowLinkText).width;this.$refs.slowLinkText.style.width=e},onSlowLink(e){this.slowLinkLoss+=e},slowLinkClicked(){this.slowLinkShowing=!1,this.slowLinkHiding=!1,this.slowLinkLoss=0,this.$swal.Prompt.fire({title:"Video frames dropped",html:"\n          <p>The video frames are getting dropped because there is a bandwidth bottleneck along the route it they take to travel from your Raspberry Pi to your computer. The bottleneck can be anywhere but in most cases <Text bold>it's either your computer's internet connection, or your Raspberry Pi's</Text>.</p>\n          <p>Make sure your computer is connected to the same network as your Pi. If you still see this warning, you need to trouble-shoot your computer's Wi-Fi connection, probably by moving closer to the Wi-Fi router.</p>\n          <p>If the webcam stream is smooth when your computer is on the same Wi-Fi network as your Pi, the bottleneck is likely with the upload speed of your internet connection. You need to run a speed test to make sure you have high-enough upload speed, as well as <b>low latency (ping)</b>.</p>\n          <p>Check out <a target=\"_blank\" href=\"https://www.obico.io/docs/user-guides/webcam-feed-is-laggy/\">the step-by-step trouble-shooting guide.</a></p>\n        ",showCloseButton:!0})},showMutedStatusDescription(e){e.preventDefault(),this.$swal.Prompt.fire({title:"Webcam stream buffering",html:'\n          <p>When you see the messaging about webcam stream is "buffering" occasionally, you can just reload the page. If this message repeatedly appears, it may indicate one of the problems:</p>\n          <p class="lead">1. A constricted video stream on <strong>your Raspberry Pi. The most common reasons are:</p>\n          <ul>\n            <li>Camera resolution is set too high.</li>\n            <li>Camera framerate is set too high.</li>\n            <li>The upload speed of your Raspberry Pi is too low.</li>\n          </ul>\n          <p class="lead">2. The internet connection of your computer or phone is not fast enough.</p>\n          <p class="lead">3. Your webcam is not properly connected to your Raspberry Pi.</p>\n          <br>\n          <p>Check <a target="_blank" href="https://www.obico.io/docs/user-guides/webcam-feed-is-laggy">this step-by-step troubleshooting guide</a>.</p>\n        ',showCloseButton:!0})}}},gn=vn,bn=(i("6711"),Object(be["a"])(gn,pn,hn,!1,null,"4884400f",null)),_n=bn.exports,wn=function(){var e=this,t=e._self._c;return t("div",[e.valid||e.printing?e._e():t("span",[e._v("-")]),!e.valid&&e.printing?t("b-spinner",{attrs:{small:"",type:"grow",label:"Calculating..."}}):e._e(),e.valid&&e.showHours?t("span",[e._v(" "+e._s(e.hours)),t("span",{staticClass:"text-subscript text-muted"},[e._v("h")])]):e._e(),e.valid&&e.showMinutes?t("span",[e._v(" "+e._s(e.minutes)),t("span",{staticClass:"text-subscript text-muted"},[e._v("m")])]):e._e(),e.valid&&e.showSeconds?t("span",[e._v(" "+e._s(e.seconds)),t("span",{staticClass:"text-subscript text-muted"},[e._v("s")])]):e._e()],1)},yn=[],Cn={name:"DurationBlock",props:{valid:{type:Boolean,required:!0},printing:{type:Boolean,required:!0},hours:{type:Number,default(){return 0}},showHours:{type:Boolean,default(){return!1}},minutes:{type:Number,default(){return 0}},showMinutes:{type:Boolean,default(){return!1}},seconds:{type:Number,default(){return 0}},showSeconds:{type:Boolean,default(){return!1}}}},kn=Cn,Sn=Object(be["a"])(kn,wn,yn,!1,null,null,null),Pn=Sn.exports,xn=function(){var e=this,t=e._self._c;return t("div",[!e.printer.isOffline()&&e.printer.hasError()?t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-12 bg-danger text-center"},[t("div",{staticClass:"lead"},[e._v(e._s(e.printer.agentDisplayName())+" Error")]),t("div",[e._v(e._s(e.printer.status.state.error))])])]):e._e(),e.printer.inUserInteractionRequired()?t("div",{staticClass:"row my-2"},[e._m(0)]):e._e(),e.printer.inTransientState()?t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-12 text-center my-3"},[t("b-spinner",{attrs:{label:"Processing..."}}),t("div",[e._v(e._s(e.printer.status.state.text)+" ...")])],1)]):t("div",{staticClass:"row my-2"},[e.printer.isOffline()||e.printer.isDisconnected()||!e.printer.isActive()?e._e():t("div",{staticClass:"col-sm-6"},[e.printer.isPaused()?t("button",{staticClass:"btn btn-block mt-2 btn-outline-success",attrs:{type:"button"},on:{click:function(t){return e.onPauseToggled(t)}}},[t("i",{staticClass:"fas fa-play"}),e._v(" Resume ")]):t("button",{staticClass:"btn btn-block mt-2 btn-outline-warning",attrs:{type:"button"},on:{click:function(t){return e.onPauseToggled(t)}}},[t("i",{staticClass:"fas fa-pause"}),e._v(" Pause ")])]),e.printer.isOffline()||e.printer.isDisconnected()||!e.printer.isActive()?e._e():t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-outline-danger btn-block mt-2 mb-2",attrs:{id:"print-cancel",type:"button"},on:{click:function(t){return e.$emit("PrinterActionCancelClicked",t)}}},[t("i",{staticClass:"fas fa-stop"}),e._v(" Cancel ")])]),e.printer.isOffline()||e.printer.isDisconnected()||e.printer.isActive()?e._e():t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-outline-primary btn-block mt-2",attrs:{id:"start-print",type:"button"},on:{click:function(t){return e.$emit("PrinterActionStartClicked",t)}}},[t("i",{staticClass:"fas fa-star"}),e._v("  Start Printing ")])]),e.printer.isOffline()||e.printer.isDisconnected()||e.printer.isActive()?e._e():t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-outline-secondary btn-block mt-2 mb-2",attrs:{type:"button"},on:{click:function(t){return e.$emit("PrinterActionControlClicked",t)}}},[t("i",{staticClass:"fas fa-arrows-alt"}),e._v("  Control ")])])]),!e.printer.isOffline()&&e.printer.isDisconnected()?t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-12 text-center py-2 text-warning"},[t("div",[e._v("Printer not connected at the serial port.")]),e.printer.isAgentMoonraker()?e._e():t("button",{staticClass:"btn btn-outline-primary btn-block mt-2",attrs:{id:"connect-printer",type:"button",disabled:e.connecting},on:{click:e.onConnectClicked}},[e.connecting?t("b-spinner",{attrs:{small:""}}):t("i",{staticClass:"fab fa-usb"}),e._v("   "+e._s(e.connecting?"Contacting OctoPrint":"Connect")+" ")],1)])]):e._e(),e.printer.isOffline()?t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-12 text-center py-3 text-warning"},[t("div",[e._v(" Obico for "+e._s(e.printer.isAgentMoonraker()?"Klipper":"OctoPrint")+" is Offline. "),e._m(1)])])]):e._e()])},Tn=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"col-12 bg-warning text-center"},[t("div",[e._v("Filament change or user interaction required")])])},function(){var e=this,t=e._self._c;return t("a",{attrs:{target:"_blank",href:"https://www.obico.io/docs/user-guides/troubleshoot-server-connection-issues/"}},[e._v("Why? "),t("small",[t("i",{staticClass:"fas fa-external-link-alt"})])])}],Fn={name:"PrinterActions",props:{printer:{type:Object,required:!0}},data(){return{connectBtnClicked:!1}},computed:{connecting(){return this.connectBtnClicked&&this.printer.isDisconnected()}},methods:{onPauseToggled(e){this.printer.isPaused()?this.$emit("PrinterActionResumeClicked",e):this.$emit("PrinterActionPauseClicked",e)},onConnectClicked(e){this.$emit("PrinterActionConnectClicked",e),this.connectBtnClicked=!0,setTimeout(()=>{this.connectBtnClicked=!1},1e4)}}},Dn=Fn,In=Object(be["a"])(Dn,xn,Tn,!1,null,null,null),On=In.exports,An=function(){var e=this,t=e._self._c;return t("div",{staticClass:"py-2"},[e._m(0),e._l(e.temperatures,(function(i,n){return t("div",{key:n,staticClass:"row"},[t("div",{staticClass:"col-2 numbers"},[t("span",{staticClass:"text-subscript text-muted"},[e._v(e._s(e.temperatureDisplayName(n)))])]),t("div",{staticClass:"col-5 numbers"},[e._v(" "+e._s(parseFloat(i.actual).toFixed(1))),t("span",{staticClass:"text-subscript text-muted"},[e._v("°C")])]),e.isEditable(i)?t("div",{staticClass:"col-5 numbers",on:{click:function(t){return e.onEditClicked(n,i)}}},[e._v(" "+e._s(Math.round(i.target))),t("span",{staticClass:"text-subscript text-muted"},[e._v("°C")]),e.editable?t("span",[e._v(" "),t("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"0.6em"}})]):e._e()]):t("div",{staticClass:"col-5 numbers"},[e._v("-")])])}))],2)},En=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"row text-muted"},[t("div",{staticClass:"col-2"},[t("i",{staticClass:"fas fa-thermometer-half fa-lg"})]),t("small",{staticClass:"col-5"},[e._v(" Actual ")]),t("small",{staticClass:"col-5"},[e._v(" Target ")])])}],Mn={name:"StatusTemp",props:{temperatures:{type:Object,required:!0},editable:{type:Boolean,required:!0}},methods:{onEditClicked(e,t){this.editable&&this.$emit("TempEditClicked",e,t)},isEditable(e){return null!==e.target},temperatureDisplayName:Xt["e"]}},Nn=Mn,Rn=Object(be["a"])(Nn,An,En,!1,null,null,null),Ln=Rn.exports,jn=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("div",[t("b-form-select",{attrs:{id:"connect-port"},model:{value:e.selectedPort,callback:function(t){e.selectedPort=t},expression:"selectedPort"}},e._l(e.connectionOptions.ports,(function(i){return t("b-form-select-option",{key:i,attrs:{value:i}},[e._v(" "+e._s(i)+" ")])})),1)],1),t("br"),e._m(1),t("div",[t("b-form-select",{attrs:{id:"connect-baudrate"},model:{value:e.selectedBaudrate,callback:function(t){e.selectedBaudrate=t},expression:"selectedBaudrate"}},[t("b-form-select-option",{attrs:{value:""}},[e._v(" Auto ")]),e._l(e.connectionOptions.baudrates,(function(i){return t("b-form-select-option",{key:i,attrs:{value:i}},[e._v(" "+e._s(i)+" ")])}))],2)],1)])},Bn=[function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Serial Port:")])])},function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Baudrate:")])])}],$n={name:"ConnectPrinter",props:{connectionOptions:{type:Object,required:!0}},data(){return{selectedPort:this.connectionOptions.ports[0],selectedBaudrate:""}}},Un=$n,zn=Object(be["a"])(Un,jn,Bn,!1,null,null,null),Vn=zn.exports,Wn=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"text-center"},[e.value>0?t("h1",{staticClass:"target-temp-degree"},[e._v(" "+e._s(e.value)+" "),t("span",{staticClass:"text-subscript text-muted"},[e._v("°C")])]):e._e(),e.value<1?t("h1",{staticClass:"target-temp-degree"},[e._v("OFF")]):e._e()]),t("br"),t("div",{staticClass:"mb-5"},[e._m(0),t("div",[t("b-form-select",{attrs:{id:"id_preset"},on:{change:e.onPresetChanged},model:{value:e.preset,callback:function(t){e.preset=t},expression:"preset"}},e._l(e.allPresets,(function(i){return t("b-form-select-option",{key:i.value,attrs:{value:parseInt(i.value)}},[e._v(" "+e._s(i.title)+" ")])})),1)],1),t("br"),t("h5",[e._v("Manual:")]),t("div",[t("vue-slider",{attrs:{min:0,max:e.maxTemp,step:1,tooltip:"none"},on:{change:e.onSliderChanged},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],attrs:{id:"target-temp",type:"hidden"},domProps:{value:e.value},on:{input:function(t){t.target.composing||(e.value=t.target.value)}}})],1)])])},qn=[function(){var e=this,t=e._self._c;return t("div",[t("h5",[e._v("Presets:")])])}],Gn=i("4971"),Hn=i.n(Gn),Jn={name:"TempTargetEditor",components:{VueSlider:Hn.a},props:{presets:{type:Array,required:!0},maxTemp:{type:Number,required:!0},curTarget:{type:Number,required:!0}},data(){let e=this.presets.find(e=>e.target==this.curTarget)||{target:0!=this.curTarget?-1:0};return{value:this.curTarget,preset:e.target}},computed:{allPresets(){let e=[];return e.push({value:-1,title:"Manual"}),e.push({value:0,title:"OFF"}),this.presets.forEach(t=>{t.target&&e.push({value:t.target,title:`${t.name} (${t.target}°C)`})}),e}},methods:{onPresetChanged(){this.preset>-1&&(this.value=this.preset)},onSliderChanged(){0==this.value?this.preset=0:this.preset=-1}}},Yn=Jn,Kn=Object(be["a"])(Yn,Wn,qn,!1,null,null,null),Qn=Kn.exports,Zn=function(){var e=this,t=e._self._c;return t("div",[t("h2",{staticClass:"text-center"},[e._v("Printer Feed Sharing")]),t("hr"),e.isProAccount?t("div",[t("div",{staticClass:"py-3"},[t("div",{staticClass:"custom-control custom-switch"},[t("input",{staticClass:"custom-control-input update-printer",attrs:{id:"sharing_enabled-toggle-"+e.printer.id,type:"checkbox"},domProps:{checked:e.sharedResource},on:{click:e.onSharingToggled}}),t("label",{staticClass:"custom-control-label",staticStyle:{"font-size":"1rem"},attrs:{for:"sharing_enabled-toggle-"+e.printer.id}},[e._v('Share live feed for printer "'),t("b",[e._v(e._s(e.printer.name))]),e._v('"')])]),t("div",{staticClass:"form-group"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.sharedLink,expression:"sharedLink"}]},[t("div",{staticClass:"input-group mt-4 mb-2"},[t("input",{ref:"sharedLink",staticClass:"form-control shared-link-text",attrs:{id:"secret-token-input",type:"text","aria-label":"Secret token",readonly:""},domProps:{value:e.sharedLink}}),t("div",{staticClass:"input-group-append"},[t("div",{staticClass:"copy-button",attrs:{id:"copy-link","data-clipboard-target":"#secret-token-input","aria-label":"Copy secure link to clipboard"},on:{click:e.copyToClipboard}},[t("i",{staticClass:"fas fa-clipboard"})]),t("b-tooltip",{attrs:{show:e.copyStatus,target:"copy-link",triggers:"click",placement:"bottom"},on:{"update:show":function(t){e.copyStatus=t}}},[e._v(e._s(e.copyMessage))])],1)]),t("div",{staticClass:"my-1"},[e._v(" Click the clipboard icon above to copy the secure shareable link to your clipboard. ")]),t("div",{staticClass:"my-1"},[e._v(" You can test the shareable link by right-clicking "),t("a",{attrs:{href:e.sharedLink}},[e._v("here")]),e._v(' and select "Open Link in Incognito Window". ')]),t("br"),e._m(3)])]),t("br")])]):t("div",[e._m(0),t("p",[e._v("Printer feed sharing is a Pro feature.")]),e._m(1),e._m(2)])])},Xn=[function(){var e=this,t=e._self._c;return t("h5",{staticClass:"mb-5"},[e._v(" Wait! You need to "),t("a",{attrs:{href:"/ent_pub/pricing/"}},[e._v("upgrade to the Pro plan")]),e._v(" to enable Printer feed. ")])},function(){var e=this,t=e._self._c;return t("p",[t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/upgrade-to-pro#why-cant-the-detective-just-work-for-free-people-love-free-you-know"}},[e._v("Running the Obico app incurs non-trivial amount of costs")]),e._v(". With little more than 1 Starbucks per month, you can upgrade to a Pro account and help us run the Obico app smoothly. ")])},function(){var e=this,t=e._self._c;return t("p",[t("a",{attrs:{href:"/ent_pub/pricing/"}},[e._v("Check out Pro pricing >>>")])])},function(){var e=this,t=e._self._c;return t("em",{staticClass:"text-muted"},[t("small",[t("div",[e._v("Notes:")]),t("ul",[t("li",[e._v(" Send the secure link to anyone you want to share your printer feed with. They do NOT need the Obico account to see your printer feed. ")]),t("li",[e._v(" Anyone with this shareable link will be able to see your printer feed. "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/printer-feed-sharing/"}},[e._v("Learn more about what they can see.")])])])])])}],er={props:{isProAccount:{type:Boolean,default:!1},printer:{type:Object,required:!0}},data(){return{share:!1,sharedResource:null,copyStatus:!1,copyMessage:""}},computed:{sharedLink(){if(this.sharedResource){const e=window.location;return`${e.protocol}//${e.host}/printers/share_token/${this.sharedResource.share_token}/`}return""}},created(){this.fetchSharedResources()},methods:{fetchSharedResources(){return z.a.get(q["a"].sharedResources({printer_id:this.printer.id})).then(e=>{e.data.length>0&&(this.sharedResource=e.data[0])})},postSharedResources(){return z.a.post(q["a"].sharedResources({printer_id:this.printer.id})).then(e=>{e.data.length>0&&(this.sharedResource=e.data[0])})},deleteSharedResources(){return z.a.delete(q["a"].sharedResource(this.sharedResource.id)).then(()=>{this.sharedResource=null})},onSharingToggled(){this.sharedResource?this.deleteSharedResources():this.postSharedResources()},copyToClipboard(){this.copyStatus=!0,this.$refs.sharedLink.focus(),this.$refs.sharedLink.select();try{document.execCommand("copy"),this.copyMessage="Copied!"}catch(e){console.error("Fallback: Oops, unable to copy",e),this.copyMessage="Failed!"}}}},tr=er,ir=(i("d764"),Object(be["a"])(tr,Zn,Xn,!1,null,"6f5a9b6b",null)),nr=ir.exports;const rr="/pause_print/",sr="/resume_print/",ar="/cancel_print/",or="/mute_current_print/?mute_alert=true",lr="/acknowledge_alert/?alert_overwrite=NOT_FAILED",cr=!0,dr=!1,ur={Settings:"panel-settings",Time:"print-time",StatusTemp:"status_temp_block"};var pr={name:"PrinterCard",components:{StreamingBox:_n,FailureDetectionGauge:oi,DurationBlock:Pn,PrinterActions:On,StatusTemp:Ln},props:{printer:{type:Object,required:!0},isProAccount:{type:Boolean,required:!0}},data(){return{section_toggles:{settings:o(ur.Settings+String(this.printer.id),cr),time:o(ur.Time+String(this.printer.id),dr),statusTemp:o(ur.StatusTemp+String(this.printer.id),cr)},webrtc:cn()}},computed:{isWatching(){return!this.printer.not_watching_reason},timeRemaining(){return this.toDuration(this.secondsLeft,this.printer.isActive())},timeTotal(){let e=null;return this.secondsPrinted&&this.secondsLeft&&(e=this.secondsPrinted+this.secondsLeft),this.toDuration(e,this.printer.isActive())},secondsLeft(){return H()(this.printer,"status.progress.printTimeLeft")},secondsPrinted(){return H()(this.printer,"status.progress.printTime")},watchForFailures(){return this.printer.watching_enabled},pauseOnFailure(){return"PAUSE"==this.printer.action_on_failure},hasCurrentPrintFilename(){return!(!this.printer.current_print||!this.printer.current_print.filename)},actionsProps(){return{printer:this.printer}},progressPct(){return H()(this.printer,"status.progress.completion")||0},tempProps(){let e=void 0!=H()(this.printer,"settings.temp_profiles");const t={};for(const[i,n]of Object.entries(H()(this.printer,"status.temperatures",{})))Boolean(n.actual)&&!isNaN(n.actual)&&(t[i]=n);return{temperatures:t,show:Object.keys(t).length>0,editable:e}},statusText(){return H()(this.printer,"status.state.text","Offline")},statusClass(){return this.printer.hasError()?"text-danger":this.printer.isOffline()||this.printer.isDisconnected()||this.printer.inTransientState()?"text-warning":"text-success"}},created(){this.printerComm=Oi(this.printer.id,q["a"].printerWebSocket(this.printer.id),e=>{this.$emit("PrinterUpdated",this.updatedPrinter(e))},e=>{const t=e.status||e.octoprint_data;this.$emit("PrinterUpdated",this.updatedPrinter({status:t}))}),this.printerComm.connect(),this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc)},methods:{updatedPrinter(e){return ne(e,this.printer)},settingsUrl(){return`/printers/${this.printer.id}/`},octoPrintTunnelUrl(){return`/tunnels/${this.printer.id}/`},onSettingsToggleClicked(){this.section_toggles.settings=!this.section_toggles.settings,l(ur.Settings+String(this.printer.id),this.section_toggles.settings)},onTimeToggleClicked(){this.section_toggles.time=!this.section_toggles.time,l(ur.Time+String(this.printer.id),this.section_toggles.time)},onStatusTempToggleClicked(){this.section_toggles.statusTemp=!this.section_toggles.statusTemp,l(ur.StatusTemp+String(this.printer.id),this.section_toggles.statusTemp)},onNotAFailureClicked(e,t){this.$swal.Confirm.fire({title:"Noted!",html:'<p>Do you want to keep failure detection on for this print?</p><small>If you select "No", failure detection will be turned off for this print, but will be automatically turned on for your next print.</small>',confirmButtonText:"Yes",cancelButtonText:"No"}).then(e=>{"cancel"==e.dismiss&&setTimeout(()=>{this.sendPrinterAction(this.printer.id,or,!1)},1e3),t?this.sendPrinterAction(this.printer.id,sr,!0):this.sendPrinterAction(this.printer.id,lr,!1)}),e.preventDefault()},onWatchForFailuresToggled(){this.printer.watching_enabled=!this.printer.watching_enabled,this.updatePrinter(this.printer)},onPauseOnFailureToggled(){this.printer.action_on_failure="PAUSE"==this.printer.action_on_failure?"NONE":"PAUSE",this.updatePrinter(this.printer)},onPrinterActionPauseClicked(){this.$swal.Confirm.fire({html:'If you haven\'t changed the default configuration, the heaters will be turned off, and the print head will be z-lifted. The reversed will be performed before the print is resumed. <a target="_blank" href="https://www.obico.io/docs/user-guides/detection-print-job-settings#when-print-is-paused">Learn more. <small><i class="fas fa-external-link-alt"></i></small></a>'}).then(e=>{e.value&&this.sendPrinterAction(this.printer.id,rr,!0)})},onPrinterActionResumeClicked(e){this.printer.alertUnacknowledged()?this.onNotAFailureClicked(e,!0):this.sendPrinterAction(this.printer.id,sr,!0)},onPrinterActionCancelClicked(){this.$swal.Confirm.fire({text:"Once cancelled, the print can no longer be resumed."}).then(e=>{e.value&&this.sendPrinterAction(this.printer.id,ar,!0)})},onPrinterActionConnectClicked(){this.printerComm.passThruToPrinter({func:"get_connection_options",target:"_printer"},(e,t)=>{e?this.$swal.Toast.fire({icon:"error",title:"Failed to connect!"}):t.ports.length<1?this.$swal.Toast.fire({icon:"error",title:"Uh-Oh. No printer is found on the serial port."}):this.$swal.openModalWithComponent(Vn,{connectionOptions:t},{confirmButtonText:"Connect",showCancelButton:!0,preConfirm:()=>({port:document.getElementById("connect-port").value,baudrate:document.getElementById("connect-baudrate").value})}).then(e=>{if(e.value){let t=[e.value.port,e.value.baudrate];this.printerComm.passThruToPrinter({func:"connect",target:"_printer",args:t})}})})},onPrinterActionStartClicked(){this.$emit("printModalOpened"),this.$bvModal.show("b-modal-gcodes")},onPrinterActionControlClicked(){window.location=q["a"].printerControl(this.printer.id)},onTempEditClicked(e,t){let i,n=H()(this.printer,"settings.temp_profiles",[]),r=350;e.search(/bed|chamber/)>-1&&(r=140),i=e.search(/tool/)>-1?n.map(e=>({name:e.name,target:e["extruder"]})):n.map(t=>({name:t.name,target:t[e]})),this.$swal.openModalWithComponent(Qn,{presets:i,maxTemp:r,curTarget:t.target},{title:"Set "+Object(Xt["e"])(e)+" Temperature",confirmButtonText:"Confirm",showCancelButton:!0,preConfirm:()=>({target:parseInt(document.getElementById("target-temp").value)})}).then(t=>{if(t.value){let i=t.value.target;this.printerComm.passThruToPrinter({func:"set_temperature",target:"_printer",args:[e,i]})}})},updatePrinter(e){return z.a.patch(q["a"].printer(e.id),{watching_enabled:e.watching_enabled,action_on_failure:e.action_on_failure}).then(e=>{if(!e.data.succeeded)throw e;this.$emit("PrinterUpdated",ne(e.data.printer,this.printer))}).catch(e=>{console.error(e),this.$swal.Toast.fire({icon:"error",title:"Failed to update printer!"})})},sendPrinterAction(e,t,i){z.a.post(q["a"].printerAction(e,t)).then(()=>{let e="";i&&(e+=`<h6>Successfully sent command to ${this.printer.name}!</h6><p>It may take a while to be executed.</p>`),""!=e&&this.$swal.Toast.fire({icon:"success",html:e})})},shouldVideoBeFull(e){let t=H()(e,"pic.img_url"),i=e.alertUnacknowledged()&&t;return!i},toDuration(e,t){if(null==e||0==e)return{valid:!1,printing:t};var i=W.a.duration(e,"seconds"),n=Math.floor(i.asHours()),r=i.minutes(),s=i.seconds();return{valid:!0,printing:t,hours:n,showHours:n>0,minutes:r,showMinutes:n>0||r>0,seconds:s,showSeconds:0==n&&0==r}},onSharePrinter(){this.$swal.openModalWithComponent(nr,{isProAccount:this.isProAccount,printer:this.printer},{confirmButtonText:"Close"})}}},hr=pr,fr=(i("1d3e"),Object(be["a"])(hr,Qi,Zi,!1,null,"1cf462ed",null)),mr=fr.exports,vr=function(){var e=this,t=e._self._c;return t("page-layout",{attrs:{"is-popup":e.isPopup},scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[e.isPopup&&null!==e.parentFolder?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e(),t("search-input",{staticClass:"search-input mr-3",on:{input:e.updateSearch}})]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",{staticClass:"d-flex"},[e.isCloud?t("a",{staticClass:"btn shadow-none icon-btn d-none d-md-inline",attrs:{href:"#",title:"Create folder"},on:{click:function(t){return t.preventDefault(),e.createFolder.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-folder-plus"})]):e._e(),t("b-dropdown",{staticClass:"order-md-2",attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-server"})]},proxy:!0}])},[t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("STORAGE")]),t("b-dropdown-item",{on:{click:e.switchToCloudStorage}},[t("div",{staticClass:"dropdown-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.isCloud?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v("Obico Cloud")])])])]),e._l(e.printers,(function(i){return t("b-dropdown-item",{key:i.id,on:{click:()=>e.switchToPrinterStorage(i)}},[t("div",{staticClass:"dropdown-group"},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.selectedPrinterId===i.id?"visible":"hidden"}}),t("div",{staticClass:"text"},[t("div",{staticClass:"title"},[e._v(e._s(i.name))]),t("div",{staticClass:"subtitle",class:[i.isBrowsable()?"text-success":"text-warning"]},[e._v(" "+e._s(i.browsabilityText())+" ")])])])])}))],2),e.isCloud?t("b-dropdown",{staticClass:"order-md-1",attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v d-md-none"}),t("i",{staticClass:"fas fa-sort-amount-down d-none d-md-block"})]},proxy:!0}],null,!1,3550382305)},[t("b-dropdown-item",{staticClass:"d-md-none",on:{click:e.createFolder}},[t("i",{staticClass:"fas fa-folder-plus"}),e._v("Create Folder ")]),t("b-dropdown-divider",{staticClass:"d-md-none"}),t("b-dropdown-text",{staticClass:"small text-secondary"},[e._v("ORDER")]),e._l(e.sorting.options,(function(i){return t("b-dropdown-item",{key:"s_"+i.id,on:{click:()=>e.updateSorting(i)}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.activeSorting.id===i.id?"visible":"hidden"}}),e._v(" "+e._s(i.title)+" ")])})),t("b-dropdown-divider"),e._l(e.sorting.directions,(function(i){return t("b-dropdown-item",{key:"d_"+i.id,on:{click:()=>e.updateSorting(e.activeSorting,i)}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:e.activeSortingDirection.id===i.id?"visible":"hidden"}}),e._v(" "+e._s(i.title)+" ")])}))],2):e._e(),e.onClose?t("a",{staticClass:"btn shadow-none icon-btn d-inline order-4",attrs:{href:"#",title:"Close"},on:{click:function(t){return t.preventDefault(),e.onClose.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-times text-danger"})]):e._e()],1)]},proxy:!0},{key:"content",fn:function(){return[t("b-container",[t("b-row",[t("b-col",[e.isCloud?t("vue-dropzone",{ref:"gcodesDropzone",staticClass:"upload-box",attrs:{id:"dropzone",options:e.dropzoneOptions,"use-custom-slot":!0},on:{"vdropzone-queue-complete":e.gcodeUploadSuccess,"vdropzone-error":e.gcodeUploadError,"vdropzone-sending":e.addParentFolderParam}},[t("div",{staticClass:"dz-message needsclick"},[t("i",{staticClass:"fas fa-upload fa-2x"}),e._v(" "),t("br"),t("div",[e._v("G-Code file (*.gcode, *.gco, or *.g) only.")]),t("div",[e._v("Up to "+e._s(e.maxFilesize)+" MB each file, "+e._s(e.maxTotalFilesize)+" GB total.")])])]):e._e(),t("g-code-file-structure",{attrs:{"is-cloud":e.isCloud,"search-state-is-active":e.searchStateIsActive,"search-in-progress":e.searchInProgress,folders:e.folders,files:e.files,"target-printer":e.targetPrinter,"nothing-found":e.nothingFound,loading:e.loading,"scroll-container-id":e.scrollContainerId,"no-more-folders":e.noMoreFolders,"no-more-files":e.noMoreFiles,"local-files-loading":e.localFilesLoading},on:{openFolder:e.openFolder,openFile:e.openFile,renameItem:e.renameItem,moveItem:e.moveItem,deleteItem:e.deleteItem,print:e.onPrintClicked,fetchMore:e.fetchFilesAndFolders}})],1)],1)],1),t("rename-modal",{ref:"renameModal",attrs:{item:e.activeItem,"pre-confirm":e.verifyItemRename},on:{renamed:e.onItemRenamed}}),t("move-modal",{ref:"moveModal",attrs:{item:e.activeItem,"target-printer":e.targetPrinter,"scroll-container-id":e.scrollContainerId,"active-sorting":e.activeSorting,"active-sorting-direction":e.activeSortingDirection},on:{moved:e.onItemMoved}}),t("delete-confirmation-modal",{ref:"deleteConfirmationModal",attrs:{item:e.activeItem},on:{deleted:e.onItemDeleted}}),t("new-folder-modal",{ref:"newFolderModal",attrs:{"pre-confirm":e.verifyNewFolder,"parent-folder-id":e.parentFolder},on:{created:e.onFolderCreated}})]},proxy:!0}])})},gr=[],br=(i("33d1"),i("ea98"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"search-wrapper"},[e._m(0),t("input",{staticClass:"dark",attrs:{type:"text",placeholder:"Search"},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)},focus:function(t){return e.$emit("focus")},blur:function(t){return e.$emit("blur")}}})])}),_r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"search-icon"},[t("i",{staticClass:"fas fa-search"})])}],wr={name:"SearchInput",props:{value:{type:String,default:""}}},yr=wr,Cr=(i("a21a"),Object(be["a"])(yr,br,_r,!1,null,"46c9927d",null)),kr=Cr.exports,Sr=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-new-folder",title:"Enter new folder name","ok-title":"Create",centered:""},on:{ok:e.handleOk,hidden:e.resetModal,shown:e.focusInput}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"my-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newFolderName,expression:"newFolderName"}],ref:"input",staticClass:"input-lg",attrs:{type:"text",name:"name",placeholder:"Folder name",required:"required"},domProps:{value:e.newFolderName},on:{input:function(t){t.target.composing||(e.newFolderName=t.target.value)}}}),e.errorMessage?t("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e()],1)])])},Pr=[],xr={name:"NewFolderModal",props:{preConfirm:{type:Function,default:null},parentFolderId:{type:String,default:null}},data(){return{newFolderName:"",errorMessage:"",isOpen:!1}},methods:{show(){this.isOpen=!0,this.$bvModal.show("b-modal-new-folder")},focusInput(){this.$refs.input.select()},resetModal(){this.isOpen=!1,this.newFolderName="",this.errorMessage=""},handleOk(e){e.preventDefault(),this.handleSubmit()},async handleSubmit(){if(this.newFolderName){if(this.preConfirm){const e=this.preConfirm(this.newFolderName);if(!0!==e)return void(this.errorMessage=e)}try{const e=await z.a.post(q["a"].gcodeFolders(),{name:this.newFolderName,parent_folder:this.parentFolderId});this.$emit("created",e.data.id),this.$bvModal.hide("b-modal-new-folder")}catch(e){return void console.log(e)}}}}},Tr=xr,Fr=(i("3568"),Object(be["a"])(Tr,Sr,Pr,!1,null,"2d1af6c9",null)),Dr=Fr.exports,Ir=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-rename",title:"Enter new name","ok-title":"Rename",centered:""},on:{ok:e.handleOk,hidden:e.resetModal,shown:e.focusInput}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"my-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newItemName,expression:"newItemName"}],ref:"input",staticClass:"input-lg",attrs:{type:"text",name:"name",placeholder:"New name",required:"required"},domProps:{value:e.newItemName},on:{input:function(t){t.target.composing||(e.newItemName=t.target.value)}}}),e.errorMessage?t("b-alert",{staticClass:"mt-3",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.errorMessage)+" ")]):e._e()],1)])])},Or=[],Ar={name:"RenameModal",components:{},props:{item:{type:Object,default:null},preConfirm:{type:Function,default:null}},data(){return{newItemName:"",errorMessage:"",isOpen:!1}},computed:{itemType(){return this.item.filename?"file":"folder"},fullName(){return"file"===this.itemType?`${this.newItemName}.${this.fileExt}`:this.newItemName},fileExt(){return"folder"===this.itemType?null:this.item.filename.split(".").at(-1)},nameWithoutExt(){if("folder"===this.itemType)return this.item.name;{const e=this.item.filename;return e.slice(0,e.length-this.fileExt.length-1)}},newNameWithExt(){return"folder"===this.itemType?this.newItemName:`${this.newItemName}.${this.fileExt}`}},methods:{show(){this.isOpen=!0,setTimeout(()=>{this.item?(this.newItemName=this.nameWithoutExt,this.$bvModal.show("b-modal-rename")):this.isOpen=!1},100)},focusInput(){this.$refs.input.select()},close(){this.$bvModal.hide("b-modal-rename"),this.resetModal()},resetModal(){this.isOpen=!1,this.newItemName="",this.errorMessage=""},handleOk(e){this.newNameWithExt!==(this.item.filename||this.item.name)?(e.preventDefault(),this.handleSubmit()):this.close()},async handleSubmit(){const e=this.item.id;if(this.newItemName)if(this.newNameWithExt!==(this.item.filename||this.item.name)){if(this.preConfirm){const e=this.preConfirm(this.newNameWithExt);if(!0!==e)return void(this.errorMessage=e)}try{const t="file"===this.itemType?q["a"].gcodeFile(e):q["a"].gcodeFolder(e);await z.a.patch(t,`${"file"===this.itemType?"filename":"name"}=${this.newNameWithExt}`)}catch(t){return this.errorMessage="Server error",void console.log(t)}this.$emit("renamed",this.newNameWithExt),this.close()}else this.close()}}},Er=Ar,Mr=(i("1d76"),Object(be["a"])(Er,Ir,Or,!1,null,"1e293016",null)),Nr=Mr.exports,Rr=function(){var e=this,t=e._self._c;return t("b-modal",{attrs:{id:"b-modal-move",title:"Move item","ok-title":"Place here","ok-disabled":e.isSameDir||e.patchLoading,scrollable:""},on:{ok:e.handleOk,hidden:e.resetModal},scopedSlots:e._u([{key:"modal-title",fn:function(){return[t("div",{staticClass:"title"},[null!==e.parentFolder?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e(),t("h5",{staticClass:"modal-title"},[e._v("Move item")])])]},proxy:!0}])},[t("form",{on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("g-code-file-structure",{attrs:{folders:e.folders,files:e.files,"target-printer":e.targetPrinter,loading:e.loading,"scroll-container-id":"b-modal-move___BV_modal_body_","no-more-folders":e.noMoreFolders,"no-more-files":e.noMoreFiles,"is-move-modal":!0,"disabled-item":e.item},on:{openFolder:e.openFolder,fetchMore:e.fetchFilesAndFolders}})],1)])},Lr=[],jr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gcodes-wrapper",class:{"is-move-modal":e.isMoveModal}},[e.isMoveModal?e._e():t("div",{staticClass:"header-panel",class:{"without-action-buttons":!e.isCloud&&!e.targetPrinter}},[t("div",{staticClass:"text"},[e._v("Name")]),t("div",{staticClass:"text"},[e._v("Size")]),t("div",{staticClass:"text"},[e._v("Created")]),e.isCloud?t("div",{staticClass:"text"},[e._v("Last printed")]):e._e()]),t("div",{staticClass:"gcode-items-wrapper"},[t("div",e._l([...e.folders,...e.files],(function(i,n){return t("file-structure-item",{directives:[{name:"show",rawName:"v-show",value:e.isFolder(i)&&!e.searchStateIsActive||!e.isFolder(i)&&!e.searchInProgress,expression:"\n          (isFolder(item) && !searchStateIsActive) || (!isFolder(item) && !searchInProgress)\n        "}],key:`${e.isFolder(i)?"folder":"file"}_${n}`,attrs:{item:i,"is-cloud":e.isCloud,"target-printer":e.targetPrinter,"is-move-modal":e.isMoveModal,disabled:e.disabledItem&&e.disabledItem.id===i.id},on:{click:function(t){e.isFolder(i)?e.$emit("openFolder",i):e.$emit("openFile",i)},renameItem:function(t){return e.$emit("renameItem",i)},moveItem:function(t){return e.$emit("moveItem",i)},deleteItem:function(t){return e.$emit("deleteItem",i)},print:function(t){return e.$emit("print",i)}}})})),1),e.isCloud?t("mugen-scroll",{staticClass:"text-center",attrs:{"v-show":!e.isFolderEmpty,handler:()=>e.$emit("fetchMore"),"should-handle":!e.loading,"scroll-container":e.scrollContainerId}},[e.noMoreFolders&&e.noMoreFiles&&!e.searchInProgress?e._e():t("div",{staticClass:"py-5"},[t("b-spinner",{attrs:{label:"Loading..."}})],1)]):e._e(),e.isCloud||!e.localFilesLoading&&!e.searchInProgress?t("div",[e.isFolderEmpty?t("div",{staticClass:"placeholder text-secondary"},[t("span",[e._v("Nothing here yet")])]):e.nothingFound?t("div",{staticClass:"placeholder text-secondary"},[t("span",[e._v("Nothing found")])]):e._e()]):t("div",{staticClass:"text-center py-5"},[t("b-spinner",{attrs:{label:"Loading..."}})],1)],1)])},Br=[],$r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"item",class:{disabled:e.isDisabled,"move-modal":e.isMoveModal},on:{click:()=>!e.isDisabled&&e.$emit("click")}},[t("div",{staticClass:"item-info"},[t("div",{staticClass:"filename"},[e.isFolder?e.isFolder?t("span",[t("i",{staticClass:"fas fa-folder mr-1"}),e._v(" "+e._s(e.item.name)+" ")]):e._e():t("span",[t("i",{staticClass:"fas fa-file-code mr-1"}),e._v(" "+e._s(e.item.filename)+" ")])]),t("div",{staticClass:"size"},[e.isFolder?e._e():t("span",[e._v(e._s(e.item.filesize))]),e.isFolder?t("span",[e._v(e._s(e.item.numItems)+" item(s)")]):e._e()]),e.isMoveModal?e._e():t("div",{staticClass:"created"},[e._v(" "+e._s(e.item.created_at?e.item.created_at.fromNow():"-")+" ")]),e.isMoveModal?e._e():[!e.isFolder&&e.isCloud?t("div",{staticClass:"last-printed"},[e.item.print_set?e.item.print_set.length?e.item.last_print?t("span",[e._v(e._s(e.item.last_print.ended_at?e.item.last_print.ended_at.fromNow():"Printing..."))]):e._e():t("span",[e._v("No prints yet")]):t("span",[e._v("-")]),e.item.last_print&&e.item.last_print.ended_at?t("div",{staticClass:"circle-indicator",class:{cancelled:e.item.last_print.cancelled_at,finished:e.item.last_print.finished_at}}):e._e()]):e._e(),e.isFolder&&e.isCloud?t("div",{staticClass:"d-none d-md-block"}):e._e()]],2),!e.isMoveModal&&(!e.isFolder&&(e.isCloud||e.targetPrinter)||e.isFolder&&e.isCloud)?t("div",[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn py-0"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}],null,!1,3452768261)},[!e.isFolder&&e.targetPrinter?t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("print",e.item)}}},[t("span",{staticClass:"text-primary"},[t("i",{staticClass:"fas fa-play-circle"}),e._v("Print on "+e._s(e.targetPrinter.name)+" ")])]):e._e(),t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("renameItem",e.item)}}},[t("i",{staticClass:"fas fa-edit"}),e._v("Rename ")]),t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("moveItem",e.item)}}},[t("i",{staticClass:"fas fa-arrows-alt"}),e._v("Move ")]),t("b-dropdown-item",{on:{click:function(t){return t.stopPropagation(),e.$emit("deleteItem",e.item)}}},[t("span",{staticClass:"text-danger"},[t("i",{staticClass:"fas fa-trash-alt"}),e._v("Delete ")])])],1)],1):e._e()])},Ur=[],zr={name:"FileStructureItem",props:{item:{type:Object,required:!0},isCloud:{type:Boolean,default:!0},targetPrinter:{type:Object,default:null},isMoveModal:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},computed:{isFolder(){return!this.item.filename},isDisabled(){return this.isMoveModal&&!this.isFolder||this.disabled}}},Vr=zr,Wr=(i("ac93"),Object(be["a"])(Vr,$r,Ur,!1,null,"43baaaa2",null)),qr=Wr.exports,Gr={name:"GCodeFileStructure",components:{MugenScroll:xt.a,FileStructureItem:qr},props:{folders:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},noMoreFolders:{type:Boolean,default:!1},noMoreFiles:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},localFilesLoading:{type:Boolean,default:!1},isCloud:{type:Boolean,default:!0},searchStateIsActive:{type:Boolean,default:!1},searchInProgress:{type:Boolean,default:!1},nothingFound:{type:Boolean,default:!1},targetPrinter:{type:Object,default:null},scrollContainerId:{type:String,default:null},isMoveModal:{type:Boolean,default:!1},disabledItem:{type:Object,default:null}},computed:{isFolderEmpty(){return!this.searchStateIsActive&&!this.loading&&!this.files.length&&!this.folders.length}},methods:{isFolder(e){return!e.filename}}},Hr=Gr,Jr=(i("a31e"),Object(be["a"])(Hr,jr,Br,!1,null,"46d7264c",null)),Yr=Jr.exports;const Kr=24;var Qr={name:"MoveModal",components:{GCodeFileStructure:Yr},props:{item:{type:Object,default:null},targetPrinter:{type:Object,default:null},scrollContainerId:{type:String,default:null},activeSorting:{type:Object,required:!0},activeSortingDirection:{type:Object,required:!0}},data(){return{path:[],isOpen:!1,loading:!1,patchLoading:!1,folders:[],files:[],noMoreFolders:!1,noMoreFiles:!1,currentFoldersPage:1,currentFilesPage:1}},computed:{itemType(){return this.item.filename?"file":"folder"},parentFolder(){return this.path&&this.path.length>0?this.path.at(-1):null},isSameDir(){var e,t,i;return!(null!==this.parentFolder||null!==(e=this.item)&&void 0!==e&&e.parent_folder)||!(null===(t=this.item)||void 0===t||!t.parent_folder||(null===(i=this.item)||void 0===i?void 0:i.parent_folder.id)!==this.parentFolder)}},methods:{goBack(){this.path.pop(),this.fetchFilesAndFolders(!0)},openFolder(e){this.path.push(e.id),this.fetchFilesAndFolders(!0)},resetFiles(){this.folders=[],this.files=[],this.noMoreFolders=!1,this.noMoreFiles=!1,this.currentFoldersPage=1,this.currentFilesPage=1},async fetchFilesAndFolders(e=!1){if(this.loading)return;if(e&&this.resetFiles(),this.noMoreFolders&&this.noMoreFiles)return;this.loading=!0;let t=[],i=[];if(!this.noMoreFolders){try{var n,r;let e=await z.a.get(q["a"].gcodeFolders(),{params:{parent_folder:this.parentFolder||"null",page:this.currentFoldersPage,page_size:Kr,sorting:`${this.activeSorting.folder_query}_${this.activeSortingDirection.query}`}});e=e.data,this.noMoreFolders=null===(null===(n=e)||void 0===n?void 0:n.next),t=(null===(r=e)||void 0===r?void 0:r.results)||[]}catch(o){this.loading=!1,this.$swal.Reject.fire({title:"Error",text:o.message}),console.error(o)}this.folders.push(...t.map(e=>ie(e))),this.currentFoldersPage+=1}if(!this.noMoreFiles&&t.length<Kr){try{var s,a;let e=await z.a.get(q["a"].gcodeFiles(),{params:{parent_folder:this.parentFolder||"null",page:this.currentFilesPage,page_size:Kr,sorting:`${this.activeSorting.file_query}_${this.activeSortingDirection.query}`}});e=e.data,this.noMoreFiles=null===(null===(s=e)||void 0===s?void 0:s.next),i=(null===(a=e)||void 0===a?void 0:a.results)||[]}catch(o){this.loading=!1,this.$swal.Reject.fire({title:"Error",text:o.message}),console.error(o)}this.files.push(...i.map(e=>te(e))),this.currentFilesPage+=1}this.loading=!1},show(){this.isOpen=!0,this.fetchFilesAndFolders(),setTimeout(()=>{this.item?this.$bvModal.show("b-modal-move"):this.isOpen=!1},100)},close(){this.$bvModal.hide("b-modal-move"),this.resetModal()},resetModal(){this.isOpen=!1,this.path=[],this.resetFiles()},handleOk(e){e.preventDefault(),this.handleSubmit()},async handleSubmit(){const e=this.item.id;this.patchLoading=!0;try{const t="file"===this.itemType?q["a"].gcodeFile(e):q["a"].gcodeFolder(e);await z.a.patch(t,"parent_folder="+(this.parentFolder||""))}catch(t){this.$swal.Reject.fire({title:"Error",text:t.message})}this.patchLoading=!1,this.$emit("moved"),this.close()}}},Zr=Qr,Xr=(i("25ab"),Object(be["a"])(Zr,Rr,Lr,!1,null,"709a3172",null)),es=Xr.exports,ts=function(){var e=this,t=e._self._c;return t("div")},is=[],ns={name:"RenameModal",props:{item:{type:Object,default:null}},data(){return{isOpen:!1}},created(){},mounted(){},methods:{show(){this.isOpen=!0,this.$bvModal.msgBoxConfirm("Are you sure?",{id:"b-modal-confirm-delete",centered:!0,okTitle:"Delete",okVariant:"danger",size:"sm",autoFocusButton:"ok"}).then(async e=>{if(this.isOpen=!1,e){try{const e=this.item.filename?q["a"].gcodeFile(this.item.id):q["a"].gcodeFolder(this.item.id);await z.a.delete(e)}catch(t){return void console.log(t)}this.$emit("deleted")}}).catch(e=>{console.log(e)})}}},rs=ns,ss=(i("9615"),Object(be["a"])(rs,ts,is,!1,null,null,null)),as=ss.exports;const os=(e,t)=>{const{query:i,path:n,onRequestEnd:r}=t;let s;s=i?{filter:String(i),recursive:!0}:{path:n,recursive:!1,level:1},e.passThruToPrinter({func:"list_files",target:"_file_manager",kwargs:s},(e,t)=>{if(e)r();else if(t){let e=[],n=[];if(null===t||void 0===t||!t.local||!Object.keys(t.local).length)return void r();delete t.local.ObicoUpload;const s=i?ls(t.local):Object.values(t.local);for(const t of s)"folder"===t.type?e.push({id:t.path,path:t.path,name:t.display,numItems:Object.keys(t.children).length}):n.push({...t,id:t.path,filename:t.name,num_bytes:t.size,filesize:Y()(t.size),created_at:Z(new Date(1e3*t.date))});r({folders:e,files:n})}else r()})},ls=e=>{const t=[];for(const i of Object.values(e))i.children?t.push(...ls(i.children)):t.push(i);return t},cs=1e3,ds=24,us={options:{name:{id:1,title:"Name",file_query:"filename",folder_query:"name"},size:{id:2,title:"Size",file_query:"num_bytes"},created_at:{id:3,title:"Created",file_query:"created_at",folder_query:"created_at"}},directions:{asc:{id:1,title:"Ascending",query:"asc"},desc:{id:2,title:"Descending",query:"desc"}}},ps={sorting:"gcode-folders-sorting-id",sortingDirection:"gcode-folders-sorting-direction-id"},hs=e=>Object.values(us.options).find(t=>t.id===e),fs=e=>Object.values(us.directions).find(t=>t.id===e);var ms={name:"GCodeFoldersPage",components:{PageLayout:Xe,SearchInput:kr,vueDropzone:zi.a,GCodeFileStructure:Yr,RenameModal:Nr,MoveModal:es,DeleteConfirmationModal:as,NewFolderModal:Dr},props:{isPopup:{type:Boolean,default:!1},onClose:{type:Function,default:null},scrollContainerId:{type:String,default:null},targetPrinter:{type:Object,default:null},savedPath:{type:Array,default:()=>[]},routeParams:{type:Object,default:()=>({printerId:null,parentFolder:null})}},data(){return{PrintStatus:X,csrf:null,user:null,loading:!1,parentFolder:null,path:[],files:[],folders:[],noMoreFolders:!1,noMoreFiles:!1,currentFoldersPage:1,currentFilesPage:1,sorting:us,activeSorting:hs(o(ps.sorting,us.options.created_at.id)),activeSortingDirection:fs(o(ps.sortingDirection,us.directions.desc.id)),searchQuery:null,searchStateIsActive:!1,searchTimeoutId:null,activeItem:null,printers:[],selectedPrinterId:void 0,selectedPrinterComm:void 0,localFilesLoading:!1}},computed:{isCloud(){return!this.selectedPrinterId},nothingFound(){return this.searchStateIsActive&&!this.searchTimeoutId&&!this.files.length},searchInProgress(){return this.searchStateIsActive&&!!this.searchTimeoutId},maxFilesize(){return this.user.is_pro?500:50},maxTotalFilesize(){return this.user.is_pro?50:1},dropzoneOptions(){return{withCredentials:!0,maxFilesize:this.maxFilesize,timeout:36e5,acceptedFiles:".g,.gcode,.gco",url:q["a"].gcodeFiles(),headers:{"X-CSRFToken":this.csrf}}}},async created(){this.csrf=Object(Xt["b"])(),this.user=Object(se["f"])(),this.savedPath&&this.savedPath.length>=1?(this.parentFolder=this.savedPath.at(-1),this.path=this.savedPath.slice(0,this.savedPath.length-1)):this.parentFolder=this.getRouteParam("parentFolder")||null,this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.isPopup||this.$watch(()=>this.$route.params,(e,t)=>{this.parentFolder=e.parentFolder||null,this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.fetchFilesAndFolders(!0)}),await this.fetchPrinters(),this.fetchFilesAndFolders(!0)},methods:{switchToCloudStorage(){this.parentFolder=null,this.path=[],this.selectedPrinterId=null,this.selectedPrinterComm=null,this.isPopup?this.fetchFilesAndFolders(!0):"/g_code_folders/cloud/"!==this.$route.path&&this.$router.replace("/g_code_folders/cloud/")},switchToPrinterStorage(e){e.isBrowsable()?(this.parentFolder=null,this.path=[],this.selectedPrinterId=e.id,this.selectedPrinterComm=null,this.isPopup?this.fetchFilesAndFolders(!0):Number(this.getRouteParam("printerId"))!==e.id&&this.$router.replace(`/g_code_folders/local/${e.id}/`)):this.$swal.Reject.fire({title:e.name+" isn't available for browsing files for one of the following reasons:",html:`<ul style="text-align: left">\n            <li>${e.agentDisplayName()} is powered off or not connected to the Internet</li>\n            <li>Printer is not connected to ${e.agentDisplayName()}</li>\n            <li>Obico for ${e.agentDisplayName()} plugin is outdated (you need version ${e.browsabilityMinPluginVersion()} or later)</li>\n          </ul>`})},getRouteParam(e){return this.isPopup?this.routeParams[e]:this.$route.params[e]},goBack(){this.path.length&&(this.parentFolder=this.path.pop(),this.fetchFilesAndFolders(!0))},resetFiles(){this.folders=[],this.files=[],this.noMoreFolders=!1,this.noMoreFiles=!1,this.currentFoldersPage=1,this.currentFilesPage=1},async fetchPrinters(){let e;try{e=await z.a.get(q["a"].printers()),e=e.data}catch(t){console.error(t)}e&&(e=e.map(e=>ne(e)),e=e.sort((e,t)=>Number(t.isBrowsable())-Number(e.isBrowsable())),this.printers=this.targetPrinter?e.filter(e=>e.id===this.targetPrinter.id):e)},async fetchLocalFiles(){this.selectedPrinterComm&&(this.localFilesLoading=!0,os(this.selectedPrinterComm,{query:this.searchQuery,path:this.parentFolder?decodeURIComponent(this.parentFolder):null,onRequestEnd:e=>{if(this.localFilesLoading=!1,e){const{folders:t,files:i}=e;this.folders=t,this.files=i}}}))},async fetchFilesAndFolders(e=!1){if(this.loading)return;if(e&&this.resetFiles(),this.selectedPrinterId)return this.printers.find(e=>e.id===this.selectedPrinterId)||this.$swal.Reject.fire({title:"Error",text:"Printer not found or unavailable"}).then(()=>{this.isPopup&&this.onClose?this.onClose():window.location.assign("/g_code_folders/cloud/")}),this.localFilesLoading=!0,void(this.selectedPrinterComm?this.fetchLocalFiles():(this.selectedPrinterComm=Oi(this.selectedPrinterId,q["a"].printerWebSocket(this.selectedPrinterId),e=>{},e=>{}),this.selectedPrinterComm.connect(this.fetchLocalFiles)));if(this.searchQuery&&(this.noMoreFolders=!0),this.noMoreFolders&&this.noMoreFiles)return;this.loading=!0;let t=[],i=[];if(!this.noMoreFolders){try{var n,r;let e=await z.a.get(q["a"].gcodeFolders(),{params:{parent_folder:this.parentFolder,page:this.currentFoldersPage,page_size:ds,sorting:`${this.activeSorting.folder_query}_${this.activeSortingDirection.query}`}});e=e.data,this.noMoreFolders=null===(null===(n=e)||void 0===n?void 0:n.next),t=(null===(r=e)||void 0===r?void 0:r.results)||[]}catch(o){this.loading=!1,this.$swal.Reject.fire({title:"Error",text:o.message}),console.error(o)}this.folders.push(...t.map(e=>ie(e))),this.currentFoldersPage+=1}if(!this.noMoreFiles&&t.length<ds){try{var s,a;let e=await z.a.get(q["a"].gcodeFiles(),{headers:{"Cache-Control":"no-cache"},params:{parent_folder:this.parentFolder,page:this.currentFilesPage,page_size:ds,sorting:`${this.activeSorting.file_query}_${this.activeSortingDirection.query}`,q:this.searchQuery}});e=e.data,this.noMoreFiles=null===(null===(s=e)||void 0===s?void 0:s.next),i=(null===(a=e)||void 0===a?void 0:a.results)||[]}catch(o){this.loading=!1,this.$swal.Reject.fire({title:"Error",text:o.message}),console.error(o)}this.files.push(...i.map(e=>te(e))),this.currentFilesPage+=1}this.loading=!1},updateSearch(e){if(clearTimeout(this.searchTimeoutId),this.searchTimeoutId=null,this.searchStateIsActive=!!e,!this.searchStateIsActive)return this.searchQuery=null,void this.fetchFilesAndFolders(!0);this.searchTimeoutId=setTimeout(async()=>{this.searchQuery=e,this.fetchFilesAndFolders(!0),this.searchTimeoutId=null},cs)},updateSorting(e,t=this.activeSortingDirection){let i=!1;this.activeSorting.id!==e.id&&(this.activeSorting=e,l(ps.sorting,e.id),i=!0),this.activeSortingDirection.id!==t.id&&(this.activeSortingDirection=t,l(ps.sortingDirection,t.id),i=!0),i&&this.fetchFilesAndFolders(!0)},addParentFolderParam(e,t,i){i.append("filename",e.name),null!==this.parentFolder&&i.append("parent_folder",this.parentFolder)},gcodeUploadSuccess(){this.$refs.gcodesDropzone.removeAllFiles(),this.files=[],this.fetchFilesAndFolders(!0)},gcodeUploadError(e,t){this.$swal.Reject.fire({html:`<p class="text-center">${t}</p>`})},renameItem(e){this.activeItem=e,this.$refs.renameModal.show()},verifyItemRename(e){return!(!this.activeItem.filename&&this.folders.find(t=>t.name===e))||"Folder with this name already exists"},onItemRenamed(e){if(!this.activeItem)return;const t=this.activeItem.filename?this.files:this.folders;for(let i in t)if(t[i].id===this.activeItem.id){if(this.activeItem.filename){this.files[i].filename=e;break}this.folders[i].name=e;break}this.activeItem=null},moveItem(e){this.activeItem=e,this.$refs.moveModal.show()},onItemMoved(){this.activeItem&&(this.activeItem=null,this.fetchFilesAndFolders(!0))},deleteItem(e){this.activeItem=e,this.$refs.deleteConfirmationModal.show()},onItemDeleted(){if(!this.activeItem)return;const e=this.activeItem.filename?this.files:this.folders;for(let t in e)if(e[t].id===this.activeItem.id){if(this.activeItem.filename){this.files.splice(t,1);break}this.folders.splice(t,1);break}this.activeItem=null},createFolder(){this.$refs.newFolderModal.show()},verifyNewFolder(e){return!this.folders.find(t=>t.name===e)||"Folder with this name already exists"},onFolderCreated(e){this.fetchFilesAndFolders(!0)},openFolder(e){this.isPopup?(this.path.push(this.parentFolder),this.parentFolder=String(e.id),this.fetchFilesAndFolders(!0)):this.selectedPrinterId?this.$router.push(`/g_code_folders/local/${this.selectedPrinterId}/${encodeURIComponent(e.path)}/`):this.$router.push(`/g_code_folders/cloud/${e.id}/`)},openFile(e){this.isPopup?this.$emit("openFile",this.selectedPrinterId?encodeURIComponent(e.path):e.id,this.selectedPrinterId,[...this.path,this.parentFolder]):this.selectedPrinterId?window.location.assign(`/g_code_files/local/${this.selectedPrinterId}/${encodeURIComponent(e.path)}/`):window.location.assign(`/g_code_files/cloud/${e.id}/`)},onPrintClicked(e){Ai({printerId:this.targetPrinter.id,gcode:e,isCloud:this.isCloud,Swal:this.$swal,onCommandSent:()=>{this.isPopup&&this.$bvModal.hide("b-modal-gcodes")}})}}},vs=ms,gs=(i("ccbb"),Object(be["a"])(vs,vr,gr,!1,null,"227f4c66",null)),bs=gs.exports,_s=function(){var e=this,t=e._self._c;return t("page-layout",{attrs:{"is-popup":e.isPopup},scopedSlots:e._u([{key:"topBarLeft",fn:function(){return[e.isPopup?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Go Back"},on:{click:function(t){return t.preventDefault(),e.goBack.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-chevron-left"})]):e._e()]},proxy:!0},{key:"topBarRight",fn:function(){return[t("div",[e.isCloud?t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-ellipsis-v"})]},proxy:!0}],null,!1,3452768261)},[t("b-dropdown-item",{on:{click:e.renameFile}},[t("i",{staticClass:"fas fa-edit"}),e._v("Rename ")]),t("b-dropdown-item",{on:{click:e.deleteFile}},[t("span",{staticClass:"text-danger"},[t("i",{staticClass:"fas fa-trash-alt"}),e._v("Delete ")])])],1):e._e(),e.onClose?t("a",{staticClass:"btn shadow-none icon-btn d-inline",attrs:{href:"#",title:"Close"},on:{click:function(t){return t.preventDefault(),e.onClose.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-times text-danger"})]):e._e()],1)]},proxy:!0},{key:"content",fn:function(){return[e.loading||e.gcodeNotFound?t("b-container",[t("b-row",[t("b-col",{staticClass:"text-center mt-5"},[e.gcodeNotFound?t("div",[t("p",[e._v("This G-Code file doesn't exists")])]):t("div",[t("b-spinner")],1)])],1)],1):t("b-container",{attrs:{fluid:"xl"}},[t("b-row",[t("b-col",[t("div",{staticClass:"card-container file-info",class:{"full-width":e.isPopup}},[t("b-container",{attrs:{fluid:""}},[t("b-row",[t("b-col",[t("h1",{staticClass:"file-name overflow-truncated"},[e._v(" "+e._s(e.gcode.filename)+" ")])])],1),t("b-row",[t("b-col",{attrs:{sm:e.isCloud?6:12}},[t("div",{staticClass:"file-info-line"},[t("div",[t("i",{staticClass:"fas fa-history"}),e._v("Uploaded")]),t("div",{staticClass:"value"},[e._v(e._s(e.gcode.created_at.fromNow()))])]),t("div",{staticClass:"file-info-line"},[t("div",[t("i",{staticClass:"far fa-file-code"}),e._v("File size")]),t("div",{staticClass:"value"},[e._v(e._s(e.gcode.filesize))])])]),t("b-col",{directives:[{name:"show",rawName:"v-show",value:e.isCloud,expression:"isCloud"}],attrs:{sm:"6"}},[t("div",{staticClass:"file-info-line"},[t("div",[t("i",{staticClass:"fas fa-circle"}),e._v("Times printed")]),t("div",{staticClass:"value"},[e._v(e._s(e.gcode.totalPrints))])]),t("div",{staticClass:"file-info-line"},[t("div",[t("i",{staticClass:"fas fa-circle text-success"}),e._v("Succeeded")]),t("div",{staticClass:"value"},[e._v(e._s(e.gcode.successPrints)+"/"+e._s(e.gcode.totalPrints))])]),t("div",{staticClass:"file-info-line"},[t("div",[t("i",{staticClass:"fas fa-circle text-danger"}),e._v("Failed or cancelled")]),t("div",{staticClass:"value"},[e._v(e._s(e.gcode.failedPrints)+"/"+e._s(e.gcode.totalPrints))])])])],1)],1)],1),t("available-printers",{staticClass:"card-container available-printers",class:{"full-width":e.isPopup},attrs:{"is-popup":e.isPopup,"target-printer-id":e.targetPrinterId||e.selectedPrinterId,gcode:e.gcode,"is-cloud":e.isCloud},on:{refresh:e.onRefresh}}),t("div",{staticClass:"print-history",class:{"full-width":e.isPopup}},[t("h2",{staticClass:"section-title"},[e._v("Print history")]),e.gcode.print_set.length?t("div",e._l(e.gcode.print_set,(function(e){return t("print-history-item",{key:"print_"+e.id,staticClass:"print-item",attrs:{print:e}})})),1):t("div",[t("div",{staticClass:"card-container p-4 justify-content-center text-secondary"},[e._v(" This file doesn't have any prints yet ")])])])],1)],1)],1),t("rename-modal",{ref:"renameModal",attrs:{item:e.gcode},on:{renamed:e.onItemRenamed}}),t("delete-confirmation-modal",{ref:"deleteConfirmationModal",attrs:{item:e.gcode},on:{deleted:e.onItemDeleted}})]},proxy:!0}])})},ws=[],ys=function(){var e=this,t=e._self._c;return t("div",[e.printersLoading||!e.gcode?t("div",{staticClass:"my-5 text-center"},[t("b-spinner")],1):t("div",[e._l(e.printers,(function(i){return t("div",{key:"printer_"+i.id,staticClass:"printer-item",class:{active:e.selectedPrinter&&i.id===e.selectedPrinter.id},on:{click:function(t){return e.selectPrinter(i)}}},[t("div",{staticClass:"selected-indicator"}),t("div",{staticClass:"printer-name overflow-truncated"},[e._v(e._s(i.name))]),t("div",{staticClass:"printer-status",class:[i.isPrintable()?"text-success":"text-warning"]},[e._v(" "+e._s(i.printabilityText())+" ")])])})),e.printersLoading||e.printers.length?e._e():t("p",{staticClass:"text-center text-secondary mt-3 mb-3"},[e._v(" No available printers ")]),t("button",{staticClass:"btn btn-primary mt-3",attrs:{disabled:!e.selectedPrinter||e.isSending},on:{click:e.onPrintClicked}},[e.isSending?t("b-spinner",{attrs:{small:""}}):t("div",[e.selectedPrinter?t("div",{staticClass:"truncate-overflow-text"},[e._v(" Print on "+e._s(e.selectedPrinter.name)+" ")]):t("div",{staticClass:"truncate-overflow-text"},[e._v("Print")])])],1)],2)])},Cs=[],ks={name:"AvailablePrinters",components:{},props:{isPopup:{type:Boolean,default:!1},targetPrinterId:{type:Number,required:!1,default:null},gcode:{type:Object,default:null},isCloud:{type:Boolean,default:!0}},data(){return{printers:[],selectedPrinter:null,printersLoading:!0,isSending:!1}},created(){this.fetchPrinters()},methods:{async fetchPrinters(){var e,t;let i;this.printersLoading=!0;try{i=await z.a.get(q["a"].printers())}catch(n){this.printersLoading=!1,console.error(n)}if(null!==(e=i)&&void 0!==e&&e.data){if(i=null===(t=i)||void 0===t?void 0:t.data,i=i.map(e=>ne(e)),this.targetPrinterId){const e=i.find(e=>e.id===this.targetPrinterId);this.printers=[e],e.isPrintable()&&(this.selectedPrinter=e)}else this.printers=i,this.selectedPrinter=i.find(e=>e.isPrintable());this.printersLoading=!1}else this.printersLoading=!1},selectPrinter(e){e.isPrintable()?this.selectedPrinter=e:this.$swal.Reject.fire({title:e.name+" isn't ready for print for one of the following reasons:",html:`<ul style="text-align: left">\n            <li>${e.agentDisplayName()} is powered off or not connected to the Internet</li>\n            <li>Printer is not connected to ${e.agentDisplayName()}</li>\n            <li>Printer is currently busy</li>\n          </ul>`})},onPrintClicked(){var e;null!==(e=this.selectedPrinter)&&void 0!==e&&e.id&&(this.isSending=!0,Ai({printerId:this.selectedPrinter.id,gcode:this.gcode,isCloud:this.isCloud,Swal:this.$swal,onCommandSent:()=>{this.isPopup&&this.$bvModal.hide("b-modal-gcodes")},onPrinterStatusChanged:()=>{this.isPopup||Mi(this.$swal,()=>this.$emit("refresh")),this.isSending=!1,this.fetchPrinters()}}))}}},Ss=ks,Ps=(i("3141"),Object(be["a"])(Ss,ys,Cs,!1,null,"06c49b74",null)),xs=Ps.exports,Ts={name:"GCodeFilePage",components:{PageLayout:Xe,RenameModal:Nr,DeleteConfirmationModal:as,availablePrinters:xs,PrintHistoryItem:jt},props:{isPopup:{type:Boolean,default:!1},targetPrinterId:{type:Number,default:null},onClose:{type:Function,default:null},routeParams:{type:Object,default:()=>({fileId:null,printerId:null})}},data(){return{gcode:null,loading:!0,gcodeNotFound:!1}},computed:{isCloud(){return!this.selectedPrinterId}},created(){this.selectedPrinterId=Number(this.getRouteParam("printerId"))||null,this.gcodeId=this.getRouteParam("fileId"),this.fetchGcode()},methods:{getRouteParam(e){return this.isPopup?this.routeParams[e]:this.$route.params[e]},goBack(){this.$emit("goBack")},async fetchLocalFile(){if(!this.printerComm)return;this.loading=!0;const e=decodeURIComponent(this.gcodeId),t=e.split("/").at(-1),i=t===e?"":e.slice(0,e.length-t.length-1);os(this.printerComm,{query:t,path:i,onRequestEnd:async t=>{var i;if(this.loading=!1,null!==t&&void 0!==t&&null!==(i=t.files)&&void 0!==i&&i.length){const i=t.files.find(t=>t.path===e);if(!i)return void(this.gcodeNotFound=!0);if(this.gcode={...i,print_set:[]},i.path&&i.hash&&this.getRouteParam("printerId")){const e=i.path.replace(/^.*[\\/]/,"");try{let t=await z.a.get(q["a"].gcodeFiles({resident_printer:this.getRouteParam("printerId"),safe_filename:e,agent_signature:"md5:"+i.hash}));const n=H()(t,"data.results[0]");n&&(this.gcode=te(n))}catch(n){console.error(n)}}}else this.gcodeNotFound=!0}})},async fetchGcode(){var e,t;if(this.selectedPrinterId)return this.printerComm=Oi(this.selectedPrinterId,q["a"].printerWebSocket(this.selectedPrinterId),e=>{},e=>{}),void this.printerComm.connect(this.fetchLocalFile);this.loading=!0;const i=this.getRouteParam("fileId");let n;try{n=await z.a.get(q["a"].gcodeFile(i))}catch(r){this.loading=!1,console.error(r)}if(null===(e=n)||void 0===e||!e.data)return this.loading=!1,void(this.gcodeNotFound=!0);n=null===(t=n)||void 0===t?void 0:t.data,this.gcode=te(n),this.loading=!1},renameFile(){this.$refs.renameModal.show()},onItemRenamed(e){this.gcode.filename=e},deleteFile(){this.$refs.deleteConfirmationModal.show()},onItemDeleted(){this.isPopup?this.$emit("goBack"):window.location.replace("/g_code_folders/cloud/")},onRefresh(){this.$router.go()}}},Fs=Ts,Ds=(i("3890"),Object(be["a"])(Fs,_s,ws,!1,null,"34889e58",null)),Is=Ds.exports;const Os={asc:"fas fa-long-arrow-alt-up",desc:"fas fa-long-arrow-alt-down"},As={StateFilter:"printer-filtering",SortFilter:"printer-sorting"};var Es={name:"PrinterListPage",components:{PrinterCard:mr,PageLayout:Xe,CascadedDropdown:At,GCodeFoldersPage:bs,GCodeFilePage:Is},data:function(){return{user:null,printers:[],loading:!0,isEnt:!1,menuSelections:{"Sort By":o(As.SortFilter,"by-date-desc"),"Filter By":o(As.StateFilter,"all")},menuOptions:{"Sort By":{iconClass:"fas fa-sort-amount-up",options:[{value:"by-date-asc",title:"Sort By Date",iconClass:Os["asc"]},{value:"by-date-desc",title:"Sort By Date",iconClass:Os["desc"]},{value:"by-name-asc",title:"Sort By Name",iconClass:Os["asc"]},{value:"by-name-desc",title:"Sort By Name",iconClass:Os["desc"]}]},"Filter By":{iconClass:"fas fa-filter",options:[{value:"all",title:"All Printers"},{value:"online",title:"Online Printers"},{value:"active",title:"Active Printers"}]}},dontShowFilterWarning:!1,archivedPrinterNum:0,selectedGcodeId:null,selectedPrinterId:null,targetPrinter:null,savedPath:[null]}},computed:{dhBadgeNum(){return this.user&&this.user.is_dh_unlimited?"∞":Math.round(this.user.dh_balance)},visiblePrinters(){let e=this.printers;switch(this.menuSelections["Filter By"]){case"online":e=e.filter(e=>!e.isDisconnected());break;case"active":e=e.filter(e=>e.isActive());break;case"all":break}switch(this.menuSelections["Sort By"]){case"by-date-asc":e=Ae()(e,e=>e.createdAt());break;case"by-date-desc":e=Ki()(Ae()(e,e=>e.createdAt()));break;case"by-name-asc":e=Ae()(e,e=>e.name);break;case"by-name-desc":e=Ki()(Ae()(e,e=>e.name));break}return e},hiddenPrinterCount(){return this.printers.length-this.visiblePrinters.length},shouldShowFilterWarning(){return"all"!==this.menuSelections["Filter By"]},shouldShowArchiveWarning(){return this.archivedPrinterNum>0},activeFiltering(){const e=this.menuOptions["Filter By"].options.filter(e=>e.value===this.menuSelections["Filter By"]);return e.length?e[0].title:null}},created(){const{IS_ENT:e}=Object(se["e"])();this.isEnt=!!e,this.user=Object(se["f"])(),this.fetchPrinters()},methods:{menuSelectionChanged(e,t){const i=t.value;this.$set(this.menuSelections,e,i);const n="Sort By"===e?As.SortFilter:As.StateFilter;l(n,i)},fetchPrinters(){return this.loading=!0,z.a.get(q["a"].printers(),{params:{with_archived:!0}}).then(e=>{this.loading=!1,e.data.forEach(e=>{e.archived_at?this.archivedPrinterNum+=1:this.insertPrinter(ne(e))})})},onShowAllClicked(){this.$set(this.menuSelections,"Filter By","all"),l(As.StateFilter,"all")},insertPrinter(e){this.printers.push(e)},onPrinterUpdated(e){let t=this.printers.findIndex(t=>t.id==e.id);t<0||this.$set(this.printers,t,e)},scrollToTop(){document.querySelector("#b-modal-gcodes").scrollTo(0,0)},resetGcodesModal(){this.selectedGcodeId=null,this.targetPrinter=null}}},Ms=Es,Ns=(i("df8a"),i("a1f5"),Object(be["a"])(Ms,Hi,Ji,!1,null,"1d104dbc",null)),Rs=Ns.exports,Ls=function(){var e=this,t=e._self._c;return t("div",[t("nav-bar",{attrs:{"view-name":"printer_shared"}}),t("div",{staticClass:"row justify-content-center"},[e.loading?t("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}}):e._e(),e.printer?t("div",{staticClass:"col-sm-12 col-lg-6 printer-card"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-header"},[t("div",[e._v(e._s(e.printer.name))])]),t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:!0}}),t("div",{staticClass:"p-3 p-md-5"},[t("p",{staticClass:"text-center"},[e._v(" You are viewing an awesome 3D print your friend shared specifically with you on ")]),t("a",{attrs:{href:"https://www.obico.io/"}},[t("svg",{staticClass:"logo-img",attrs:{width:"100%"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),t("hr"),t("br"),t("br"),t("p",{staticClass:"text-center"},[e._v(" Obico let you monitor and control your printer from anywhere, on your phone. ")]),t("a",{staticClass:"btn btn-block btn-primary",attrs:{href:"/accounts/signup/"}},[e._v("Sign up for a free Obico account")])])],1)]):e._e()],1)],1)},js=[],Bs=function(){var e=this,t=e._self._c;return t("div",[e.inMobileWebView?e._e():t("b-navbar",{class:{"navbar-dark":e.theme===e.themes.Dark,"navbar-light":e.theme===e.themes.Light},attrs:{toggleable:"xl"}},[t("b-container",{staticClass:"p-0"},[t("b-navbar-brand",{attrs:{href:"/"}},[t("svg",{attrs:{width:"100",height:"30"}},[t("use",{attrs:{href:"#svg-logo-full"}})])]),t("b-navbar-toggle",{attrs:{target:"navbar-toggle-collapse"}},[t("span",{staticClass:"navbar-toggler-icon"})]),t("b-collapse",{attrs:{id:"navbar-toggle-collapse","is-nav":""},model:{value:e.showMainMenu,callback:function(t){e.showMainMenu=t},expression:"showMainMenu"}},[t("b-navbar-nav",[e.user?t("b-nav-item",{class:{active:e.viewName.includes("printers")},attrs:{href:"/printers/"}},[e._v("Printer")]):e._e(),e.user?t("b-nav-item",{class:{active:e.viewName.includes("print_history")},attrs:{href:"/print_history/"}},[e._v("Time-lapse")]):e._e(),e.user?t("b-nav-item",{class:{active:e.viewName.includes("g_code_folders")},attrs:{href:"/g_code_folders/cloud/"}},[e._v("G-Code")]):e._e(),e.isEnt&&!e.user?t("b-nav-item",{staticClass:"glowing",class:{active:"publictimelapse_list"===e.viewName},attrs:{href:"/ent_pub/publictimelapses/"}},[e._v("Spaghetti Gallery")]):e._e(),e.isEnt?t("b-nav-item",{class:{active:"pricing"===e.viewName},attrs:{href:"/ent_pub/pricing/"}},[e._v("Pricing")]):e._e(),t("b-nav-item",{attrs:{href:"https://www.obico.io/help/"}},[e._v("Help")]),t("b-nav-item",{attrs:{href:"https://obico.io/discord"}},[e._v("Community")])],1),t("b-navbar-nav",{staticClass:"ml-auto"},[e.user?e._e():t("b-nav-item",{attrs:{href:"/accounts/login/"}},[e._v("SIGN IN")]),!e.user&&e.allowSignUp?t("b-nav-item",{attrs:{href:"/accounts/signup/"}},[e._v("SIGN UP")]):e._e(),e.user?t("b-nav-item-dropdown",{ref:"accountDropdown",attrs:{right:"","toggle-class":"user-menu",text:e.user.first_name||e.user.email}},[t("b-dropdown-item",{attrs:{href:"/user_preferences/"}},[t("i",{staticClass:"fas fa-cog mr-2"}),e._v("Preferences ")]),t("b-dropdown-divider"),t("b-dropdown-item",{attrs:{href:"/accounts/logout/"}},[t("i",{staticClass:"fas fa-sign-out-alt mr-2"}),e._v("Log out ")])],1):e._e()],1)],1)],1)],1)],1)},$s=[],Us={name:"NavBar",components:{},props:{viewName:{default(){return""},type:String}},data(){return{user:null,allowSignUp:!1,isEnt:!1,themes:ni["a"],showMainMenu:!1}},computed:{inMobileWebView(){return Object(se["a"])()},theme(){return Object(T["a"])()}},created(){const{ACCOUNT_ALLOW_SIGN_UP:e,IS_ENT:t}=Object(se["e"])();this.allowSignUp=!!e,this.isEnt=!!t,this.user=Object(se["f"])()},methods:{hideDropdowns(){this.showMainMenu=!1;const e=this.$refs.accountDropdown;e&&e.hide()}}},zs=Us,Vs=(i("8435"),Object(be["a"])(zs,Bs,$s,!1,null,"0bbf66bb",null)),Ws=Vs.exports,qs={name:"SharedPrinterPage",components:{StreamingBox:_n,NavBar:Ws},data:function(){return{printer:null,shareToken:null,videoAvailable:{},loading:!0,webrtc:cn()}},created(){this.shareToken=Se()(window.location.pathname,"/").slice(-2,-1).pop(),this.printerComm=Oi(this.shareToken,q["a"].printerSharedWebSocket(this.shareToken),e=>{this.printer=ne(e,this.printer),this.loading=!1}),this.printerComm.connect(),this.webrtc.openForShareToken(this.shareToken)}},Gs=qs,Hs=(i("da6c"),Object(be["a"])(Gs,Ls,js,!1,null,"998bb74a",null)),Js=Hs.exports,Ys=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{attrs:{lg:"8"}},[e.printer?t("div",{staticClass:"surface with-loading-animation full-on-mobile"},[t("section",{staticClass:"settings"},[t("h2",{staticClass:"section-title"},[e._v("Settings")]),t("div",{staticClass:"form-group mb-4 mt-4"},[t("div",{staticClass:"form-label text-muted mb-2"},[e._v("Give your shiny new printer a name")]),t("saving-animation",{attrs:{errors:e.errorMessages.name,saving:e.saving.name}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.name,expression:"printer.name"}],staticClass:"form-control field_required",attrs:{id:"id_name",type:"text",name:"name",maxlength:"200",placeholder:"",required:"required"},domProps:{value:e.printer.name},on:{input:function(t){t.target.composing||e.$set(e.printer,"name",t.target.value)}}})])],1),t("div",{staticClass:"failure-notification"},[t("div",{staticClass:"form-group mt-4 mb-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("When a potential failure is detected:")]),t("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_NONE,saving:e.saving.action_on_failure_NONE}},[t("div",{staticClass:"custom-control custom-radio mt-1 radio"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{id:"id_action_on_failure_0",type:"radio",name:"action_on_failure",value:"NONE"},domProps:{checked:e._q(e.printer.action_on_failure,"NONE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","NONE")},function(t){return e.updateSetting("action_on_failure")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_0"}},[e._v("Just notify me")])])]),t("saving-animation",{attrs:{errors:e.errorMessages.action_on_failure_PAUSE,saving:e.saving.action_on_failure_PAUSE}},[t("div",{staticClass:"custom-control custom-radio mt-1 radio",attrs:{id:"action_on_failure_PAUSE"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.action_on_failure,expression:"printer.action_on_failure"}],staticClass:"custom-control-input field_required",attrs:{id:"id_action_on_failure_1",type:"radio",name:"action_on_failure",value:"PAUSE"},domProps:{checked:e._q(e.printer.action_on_failure,"PAUSE")},on:{change:[function(t){return e.$set(e.printer,"action_on_failure","PAUSE")},function(t){return e.updateSetting("action_on_failure")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_action_on_failure_1"}},[e._v("Pause the printer and notify me")])])])],1)])]),t("section",{staticClass:"mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Failure Detection")]),t("div",{staticClass:"card-body p-0 pt-3"},[t("p",{staticClass:"text-warning"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" If you are not sure about the settings below, leave the default values to minimize surprises. ")]),t("div",{staticClass:"form-group mt-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("When print is paused,")]),t("saving-animation",{attrs:{errors:e.errorMessages.tools_off_on_pause,saving:e.saving.tools_off_on_pause}},[t("div",{staticClass:"custom-control custom-checkbox mt-2 checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.tools_off_on_pause,expression:"printer.tools_off_on_pause"}],staticClass:"custom-control-input",attrs:{id:"id_tools_off_on_pause",type:"checkbox",name:"tools_off_on_pause"},domProps:{checked:Array.isArray(e.printer.tools_off_on_pause)?e._i(e.printer.tools_off_on_pause,null)>-1:e.printer.tools_off_on_pause},on:{change:[function(t){var i=e.printer.tools_off_on_pause,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&e.$set(e.printer,"tools_off_on_pause",i.concat([s])):a>-1&&e.$set(e.printer,"tools_off_on_pause",i.slice(0,a).concat(i.slice(a+1)))}else e.$set(e.printer,"tools_off_on_pause",r)},function(t){return e.updateSetting("tools_off_on_pause")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_tools_off_on_pause"}},[e._v(" Turn off hotend heater(s) ")])])]),t("saving-animation",{attrs:{errors:e.errorMessages.bed_off_on_pause,saving:e.saving.bed_off_on_pause}},[t("div",{staticClass:"custom-control custom-checkbox mt-2 checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.printer.bed_off_on_pause,expression:"printer.bed_off_on_pause"}],staticClass:"custom-control-input",attrs:{id:"id_bed_off_on_pause",type:"checkbox",name:"bed_off_on_pause"},domProps:{checked:Array.isArray(e.printer.bed_off_on_pause)?e._i(e.printer.bed_off_on_pause,null)>-1:e.printer.bed_off_on_pause},on:{change:[function(t){var i=e.printer.bed_off_on_pause,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&e.$set(e.printer,"bed_off_on_pause",i.concat([s])):a>-1&&e.$set(e.printer,"bed_off_on_pause",i.slice(0,a).concat(i.slice(a+1)))}else e.$set(e.printer,"bed_off_on_pause",r)},function(t){return e.updateSetting("bed_off_on_pause")}]}}),t("label",{staticClass:"custom-control-label",attrs:{for:"id_bed_off_on_pause"}},[e._v(" Turn off bed heater ")])])]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.retract_on_pause,saving:e.saving.retract_on_pause}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.retractFilamentByEnabled,expression:"retractFilamentByEnabled"}],staticClass:"custom-control-input",attrs:{id:"retract-checkbox",type:"checkbox"},domProps:{checked:Array.isArray(e.retractFilamentByEnabled)?e._i(e.retractFilamentByEnabled,null)>-1:e.retractFilamentByEnabled},on:{change:function(t){var i=e.retractFilamentByEnabled,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&(e.retractFilamentByEnabled=i.concat([s])):a>-1&&(e.retractFilamentByEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.retractFilamentByEnabled=r}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"retract-checkbox"}},[e._v("Retract filament by")])]),t("number-input",{staticClass:"wrappable-field",attrs:{step:.5,disable:!e.retractFilamentByEnabled},model:{value:e.retractOnPause,callback:function(t){e.retractOnPause=t},expression:"retractOnPause"}})],1)]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.lift_z_on_pause,saving:e.saving.lift_z_on_pause}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.liftExtruderByEnabled,expression:"liftExtruderByEnabled"}],staticClass:"custom-control-input",attrs:{id:"lift-z-checkbox",type:"checkbox"},domProps:{checked:Array.isArray(e.liftExtruderByEnabled)?e._i(e.liftExtruderByEnabled,null)>-1:e.liftExtruderByEnabled},on:{change:function(t){var i=e.liftExtruderByEnabled,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&(e.liftExtruderByEnabled=i.concat([s])):a>-1&&(e.liftExtruderByEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.liftExtruderByEnabled=r}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"lift-z-checkbox"}},[e._v("Lift extruder along Z axis by")])]),t("number-input",{staticClass:"wrappable-field",attrs:{step:.5,disable:!e.liftExtruderByEnabled},model:{value:e.liftExtruderBy,callback:function(t){e.liftExtruderBy=t},expression:"liftExtruderBy"}})],1)])],1),t("div",{staticClass:"form-group sensitivity my-4"},[t("div",{staticClass:"form-label text-muted"},[e._v("AI failure detection sensitivity")]),t("saving-animation",{attrs:{errors:e.errorMessages.detective_sensitivity,saving:e.saving.detective_sensitivity}},[t("div",{staticClass:"my-2 sensitivity-slider"},[t("vue-slider",{attrs:{lazy:!0,min:.8,max:1.2,interval:.05,"tooltip-formatter":e.sensitivityTooltipFormatter},model:{value:e.detectiveSensitivity,callback:function(t){e.detectiveSensitivity=t},expression:"detectiveSensitivity"}})],1)]),"Low"===e.sensitivityTooltipFormatter(e.printer.detective_sensitivity)?t("div",[e._v(" Low - I don't want a lot of false alarms. Only alert me when you are absolutely sure. ")]):"Medium"===e.sensitivityTooltipFormatter(e.printer.detective_sensitivity)?t("div",[e._v(" Medium - A few false alarms won't bother me. But some well-disguised spaghetti will be missed. ")]):t("div",[e._v(" High - Hit me with all the false alarms. I want to catch as many failures as possible. ")])],1)])]),t("section",{staticClass:"mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Time-lapse")]),e.timelapseOnFinishEnabled&&e.timelapseOnCancelEnabled?e._e():t("p",{staticClass:"text-warning"},[t("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Focused Feedback won't be available when time-lapse recording is turned off. You won't be able to "),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/how-does-credits-work/"}},[e._v("help us get better while earning AI Detection Hours for yourself")]),e._v(". ")]),t("div",{staticClass:"form-group mt-4"},[t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.min_timelapse_secs_on_finish,saving:e.saving.min_timelapse_secs_on_finish}},[t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.timelapseOnFinishEnabled,expression:"timelapseOnFinishEnabled"}],staticClass:"custom-control-input",attrs:{id:"timelapseOnFinishEnabled",type:"checkbox"},domProps:{checked:Array.isArray(e.timelapseOnFinishEnabled)?e._i(e.timelapseOnFinishEnabled,null)>-1:e.timelapseOnFinishEnabled},on:{change:function(t){var i=e.timelapseOnFinishEnabled,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&(e.timelapseOnFinishEnabled=i.concat([s])):a>-1&&(e.timelapseOnFinishEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.timelapseOnFinishEnabled=r}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"timelapseOnFinishEnabled"}},[e._v("Record time-lapse when a print finishes successfully.")])])]),e.timelapseOnFinishEnabled?t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[e._v(" Skip if the print is finished in less than ")]),t("number-input",{staticClass:"wrappable-field",attrs:{step:5,unit:"minutes"},model:{value:e.minTimelapseMinutesOnFinish,callback:function(t){e.minTimelapseMinutesOnFinish=t},expression:"minTimelapseMinutesOnFinish"}})],1):e._e()]),t("saving-animation",{staticClass:"mobile-full-width",attrs:{errors:e.errorMessages.min_timelapse_secs_on_cancel,saving:e.saving.min_timelapse_secs_on_cancel}},[t("div",{staticClass:"form-inline mt-3 mb-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.timelapseOnCancelEnabled,expression:"timelapseOnCancelEnabled"}],staticClass:"custom-control-input",attrs:{id:"timelapseOnCancelEnabled",type:"checkbox"},domProps:{checked:Array.isArray(e.timelapseOnCancelEnabled)?e._i(e.timelapseOnCancelEnabled,null)>-1:e.timelapseOnCancelEnabled},on:{change:function(t){var i=e.timelapseOnCancelEnabled,n=t.target,r=!!n.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);n.checked?a<0&&(e.timelapseOnCancelEnabled=i.concat([s])):a>-1&&(e.timelapseOnCancelEnabled=i.slice(0,a).concat(i.slice(a+1)))}else e.timelapseOnCancelEnabled=r}}}),t("label",{staticClass:"custom-control-label",attrs:{for:"timelapseOnCancelEnabled"}},[e._v("Record time-lapse when a print is cancelled.")])])]),e.timelapseOnCancelEnabled?t("div",{staticClass:"form-inline my-1 checkbox-with-input"},[t("div",{staticClass:"custom-control custom-checkbox"},[e._v(" Skip if the print is cancelled in less than ")]),t("number-input",{staticClass:"wrappable-field",attrs:{step:5,unit:"minutes"},model:{value:e.minTimelapseMinutesOnCancel,callback:function(t){e.minTimelapseMinutesOnCancel=t},expression:"minTimelapseMinutesOnCancel"}})],1):e._e()])],1)]),t("section",{staticClass:"danger mt-5"},[t("h2",{staticClass:"section-title"},[e._v("Danger Zone")]),t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-outline-secondary",attrs:{href:e.printerWizardUrl}},[e._v(" Re-Link Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v('If your printer is always showing as "offline", and you have gone through '),t("a",{attrs:{href:"https://www.obico.io/docs/user-guides/troubleshoot-server-connection-issues/"}},[e._v("all the trouble-shooting steps")]),e._v(", you can try to re-link printer as the last resort.")])])]),t("div",{staticClass:"mt-4"},[t("button",{staticClass:"btn btn-outline-warning",on:{click:e.archivePrinter}},[e._v(" Archive Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v("Archived printers are not counted toward your subscription plan. You won't see them in the app either. Go to "),t("a",{attrs:{href:"/ent/printers/archived/"}},[e._v("this page")]),e._v(" to find all archived printers and/or un-archive them.")])])]),t("div",{staticClass:"mt-4"},[t("button",{staticClass:"btn btn-outline-danger",on:{click:e.deletePrinter}},[e._v(" Delete Printer ")]),t("div",{staticClass:"text-muted mt-1"},[t("small",[e._v("Bye-bye printer.")])])])])]):t("div",{staticClass:"text-center"},[t("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}})],1)])],1)],1)]},proxy:!0}])})},Ks=[],Qs=i("847e"),Zs=function(){var e=this,t=e._self._c;return t("div",{staticClass:"input-group input-group-sm input-wrapper"},[t("div",{staticClass:"input-group-prepend"},[t("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=e.inputValue>0?Math.round(10*(e.inputValue-e.step))/10:0,e.$emit("input",e.inputValue)}}},[e._v(" ↓ ")])]),t("input",{staticClass:"form-control text-center field_required",style:{opacity:e.disable?.3:1},attrs:{type:"text",disabled:"","aria-describedby":"basic-addon1"},domProps:{value:e.inputValue+" "+e.unit}}),t("div",{staticClass:"input-group-append"},[t("button",{staticClass:"btn btn-outline-secondary control-button",attrs:{type:"button",disabled:e.disable},on:{click:function(t){e.inputValue=Math.round(10*(e.inputValue+e.step))/10,e.$emit("input",e.inputValue)}}},[e._v(" ↑ ")])])])},Xs=[],ea={name:"NumberInput",props:{value:{type:Number,default:0},step:{type:Number,default:.5},disable:{type:Boolean,default:!1},unit:{type:String,default:"mm"}},data(){return{inputValue:this.value}},watch:{value(e){this.inputValue=e}}},ta=ea,ia=(i("587d"),Object(be["a"])(ta,Zs,Xs,!1,null,"66233dc0",null)),na=ia.exports,ra={components:{SavingAnimation:Qs["a"],NumberInput:na,PageLayout:Xe,VueSlider:Hn.a},data(){return{printer:null,printerId:"",saving:{},errorMessages:{},delayedSubmit:{name:{delay:1e3,timeoutId:null},retract_on_pause:{delay:1e3,timeoutId:null},lift_z_on_pause:{delay:1e3,timeoutId:null},min_timelapse_secs_on_finish:{delay:1e3,timeoutId:null},min_timelapse_secs_on_cancel:{delay:1e3,timeoutId:null}}}},computed:{retractFilamentByEnabled:{get(){return this.printer.retract_on_pause>0},set(e){this.printer.retract_on_pause=e?6.5:0}},retractOnPause:{get(){return this.printer?this.printer.retract_on_pause:void 0},set(e){this.printer&&(this.printer.retract_on_pause=e)}},liftExtruderByEnabled:{get(){return this.printer.lift_z_on_pause>0},set(e){this.printer.lift_z_on_pause=e?2.5:0}},liftExtruderBy:{get(){return this.printer?this.printer.lift_z_on_pause:void 0},set(e){this.printer&&(this.printer.lift_z_on_pause=e)}},timelapseOnFinishEnabled:{get(){return this.printer.min_timelapse_secs_on_finish>=0},set(e){this.printer.min_timelapse_secs_on_finish=e?600:-1}},minTimelapseMinutesOnFinish:{get(){return this.printer?this.printer.min_timelapse_secs_on_finish/60:void 0},set(e){this.printer&&(this.printer.min_timelapse_secs_on_finish=60*e)}},timelapseOnCancelEnabled:{get(){return this.printer.min_timelapse_secs_on_cancel>=0},set(e){this.printer.min_timelapse_secs_on_cancel=e?300:-1}},minTimelapseMinutesOnCancel:{get(){return this.printer?this.printer.min_timelapse_secs_on_cancel/60:void 0},set(e){this.printer&&(this.printer.min_timelapse_secs_on_cancel=60*e)}},printerWizardUrl(){return q["a"].printerWizard(this.printer.id)},printerName:{get:function(){return this.printer?this.printer.name:void 0},set:function(e){this.printer.name=e}},detectiveSensitivity:{get(){return this.printer.detective_sensitivity},set(e){this.printer.detective_sensitivity=e,this.updateSetting("detective_sensitivity")}}},watch:{printerName:function(e,t){void 0!==t&&this.updateSetting("name")},retractOnPause:function(e,t){void 0!==t&&this.changeRetractOnPause(e)},liftExtruderBy:function(e,t){void 0!==t&&this.changeLiftExtruderBy(e)},minTimelapseMinutesOnFinish:function(e,t){void 0!==t&&this.updateSetting("min_timelapse_secs_on_finish")},minTimelapseMinutesOnCancel:function(e,t){void 0!==t&&this.updateSetting("min_timelapse_secs_on_cancel")}},created(){this.printerId=Se()(window.location.pathname,"/").slice(-2,-1).pop(),this.fetchPrinter()},methods:{fetchPrinter(){return z.a.get(q["a"].printer(this.printerId)).then(e=>{this.printer=ne(e.data,this.printer)})},patchPrinter(e,t){const i=this.getSettingsItemInput(e,t);return this.setSavingStatus(i,!0),z.a.patch(q["a"].printer(this.printerId),{[e]:t}).catch(e=>{if(e.response&&e.response.data&&"object"===typeof e.response.data)if(e.response.data.non_field_errors)this.errorAlert(e.response.data.non_field_errors);else for(const t in e.response.data)this.errorMessages[i]=e.response.data[t];else this.errorAlert()}).then(()=>{this.setSavingStatus(i,!1)})},errorAlert(){this.$swal.Toast.fire({icon:"error",html:'<div>Can not update printer settings.</div><div>Get help from <a href="https://obico.io/discord">the Obico app discussion forum</a> if this error persists.</div>'})},updateSetting(e){if(e in this.delayedSubmit){const t=this.delayedSubmit[e];return t["timeoutId"]&&clearTimeout(t["timeoutId"]),void(this.delayedSubmit[e]["timeoutId"]=setTimeout(()=>{this.patchPrinter(e,this.printer[e])},t["delay"]))}this.patchPrinter(e,this.printer[e])},sensitivityTooltipFormatter:function(e){return e<.95?"Low":e>1.05?"High":"Medium"},deletePrinter(e){this.$swal.Prompt.fire({title:"Are you sure?",text:`Delete ${this.printer.name} printer? This action can not be undone.`,showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then(e=>{e.isConfirmed&&z.a.delete(q["a"].printer(this.printerId)+"?with_archived=true").then(()=>{window.location.href="/printers/"})})},archivePrinter(){this.$swal.Confirm.fire().then(e=>{e.isConfirmed&&z.a.post(q["a"].printerAction(this.printerId,"/archive/")).then(()=>{this.$swal.Prompt.fire({title:"Printer archived",html:`<p>${this.printer.name} is archived.</p><p>You can find it on <a href="/ent/printers/archived/">this page</a> and un-archive it.</p>`,confirmButtonText:"Go to the printer page"}).then(()=>{window.location.href="/printers/"})})})},getSettingsItemInput:function(e,t=""){switch(e){case"action_on_failure":return`${e}_${t}`;default:return""+e}},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},changeRetractOnPause(e){this.printer.retract_on_pause=e,this.updateSetting("retract_on_pause")},changeLiftExtruderBy(e){this.printer.lift_z_on_pause=e,this.updateSetting("lift_z_on_pause")}}},sa=ra,aa=(i("f394"),Object(be["a"])(sa,Ys,Ks,!1,null,"078ec1a2",null)),oa=aa.exports,la=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",[t("b-col",[t("div",{staticClass:"wizard-container form-container full-on-mobile"},[e.verifiedPrinter?t("div",{staticClass:"text-center py-5"},[t("svg",{staticClass:"success-checkmark"},[t("use",{attrs:{href:"#svg-success-checkmark"}})]),t("h3",{staticClass:"pb-4"},[e._v("Successfully linked to your account!")]),t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[t("saving-animation",{attrs:{errors:e.errorMessages.printer_name,saving:e.saving.printer_name}},[t("div",{staticClass:"printer-name-input"},[t("div",{staticClass:"edit-icon"},[t("i",{staticClass:"fas fa-pen"})]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.verifiedPrinter.name,expression:"verifiedPrinter.name"}],staticClass:"dark",attrs:{type:"text",placeholder:"Printer name"},domProps:{value:e.verifiedPrinter.name},on:{input:[function(t){t.target.composing||e.$set(e.verifiedPrinter,"name",t.target.value)},e.updatePrinterName]}})])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" Give your printer a shiny name. ")])])],1),t("br"),t("br"),t("div",{staticClass:"col-sm-12 col-md-8 offset-md-2 col-lg-6 offset-lg-3 d-flex flex-column align-center justify-content-center"},[e.redirectToTunnelCreation?t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:e.redirectToTunnelCreation}},[e._v("Authorize App Access")])]):t("div",[t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-primary btn-block mx-auto btn-lg",attrs:{href:"/printers/"}},[e._v("Go Check Out Printer Feed!")])]),t("div",{staticClass:"mt-5"},[t("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto",attrs:{href:"/user_preferences/notification_twilio/"}},[e._v("Add Phone Number")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" Receive text (SMS) in case of print failures. ")])]),t("div",{staticClass:"mt-4"},[t("a",{staticClass:"btn btn-outline-secondary btn-block mx-auto",attrs:{href:e.editPrinterUrl}},[e._v("Change Printer Settings")])]),t("div",[t("div",{staticClass:"text-muted mx-auto text-center font-weight-light"},[e._v(" You can always change it later. ")])])])])]):t("div",[e.$route.path===e.routes.printerWizardSetup?t("div",[t("form-wizard",{attrs:{color:"var(--color-primary)","step-size":"sm"},scopedSlots:e._u([{key:"footer",fn:function(i){return[t("div",{staticClass:"wizard-footer-left"},[i.activeTabIndex>0?t("wizard-button",{staticClass:"btn btn-link btn-back",nativeOn:{click:function(t){i.prevTab(),e.prevTab(i.activeTabIndex)}}},[e._v("< Back")]):e._e()],1),t("div",{staticClass:"wizard-footer-right"},[i.isLastStep?e._e():t("wizard-button",{staticClass:"wizard-footer-right wizard-btn",style:{...i.fillButtonStyle,color:"var(--color-on-primary)"},nativeOn:{click:function(t){i.nextTab(),e.nextTab(i.activeTabIndex)}}},[e._v("Next >")])],1)]}}],null,!1,2853193433)},[t("h3",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.title)+" ")]),e.targetMoonraker?t("tab-content",{attrs:{title:"Install Obico for Klipper"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("SSH to the Raspberry Pi your Klipper runs on.")]),t("li",[t("div",[e._v("Run:")]),t("pre",{staticClass:"mt-2"},[e._v("cd ~\ngit clone https://github.com/TheSpaghettiDetective/moonraker-obico.git\ncd moonraker-obico\n./install.sh\n                              ")])]),t("li",[e._v("Follow the installation steps.")]),t("li",[e._v(" At the end, you will be asked to enter a 6-digit verification code. ")])])])])])]):e._e(),e.printerIdToLink&&e.targetOctoPrint?t("tab-content",{attrs:{title:"Open Plugin Settings"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("div",{staticClass:"text-warning"},[e._v(" Warning: Re-Linking OctoPrint should be your last resort to solve issues. Please make sure you have exhausted all options on "),t("a",{attrs:{href:"https://www.obico.io/help/"}},[e._v("Obico's help website")]),e._v(". ")]),t("ol",[t("li",[e._v("Open OctoPrint in another browser tab.")]),t("li",[e._v(" Select "),t("em",[e._v('"OctoPrint settings menu → Obico for OctoPrint"')]),e._v(". ")]),t("li",[e._v("Select "),t("em",[e._v('"Troubleshooting → Re-run Wizard"')]),e._v(".")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto",attrs:{src:i("b231")}})])])])]):e._e(),!e.printerIdToLink&&e.targetOctoPrint?t("tab-content",{attrs:{title:"Install Plugin"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("Open OctoPrint in another browser tab.")]),t("li",[e._v(" Select "),t("em",[e._v('"OctoPrint settings menu → Plugin Manager → Get More..."')]),e._v(". ")]),t("li",[e._v('Enter "Obico" to locate the plugin. Click '),t("em",[e._v('"Install"')]),e._v(".")]),t("li",[e._v("Restart OctoPrint when prompted.")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto screenshot",attrs:{src:i("2814")},on:{click:function(t){return e.zoomIn(t)}}})])])])]):e._e(),e.discoveryEnabled?[e.targetOctoPrint?t("tab-content",{attrs:{title:"Link It!"}},[t("loading",{attrs:{active:null!=e.chosenDeviceId,"can-cancel":!1}}),t("div",{staticClass:"discover"},[t("div",{staticClass:"discover-body"},[e.canStartLinking?t("div",[t("div",{staticClass:"lead my-3"},[t("div",{staticClass:"spinner-border",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"})]),t("span",{staticClass:"sr-only"}),e._v("Scanning..., "+e._s(e.discoveredPrinters.length)+" OctoPrint(s) found on your local network: ")]),e._l(e.discoveredPrinters,(function(i){return t("discovered-printer",{key:i.device_id,attrs:{"discovered-printer":i},on:{"auto-link-printer":e.autoLinkPrinter}})}))],2):t("div",{staticStyle:{"text-align":"center"}},[t("div",{staticClass:"spinner-border big",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"})]),t("div",{staticClass:"lead"},[e._v("Scanning...")])]),t("div",{staticClass:"mt-5 mb-3"},[e._v(" Can't find the OctoPrint you want to link? Switch to "),t("a",{staticClass:"link",on:{click:function(t){e.discoveryEnabled=!1}}},[e._v("Manual Setup")]),e._v(" instead. ")]),e.discoveryCount>=2?t("div",{staticClass:"text-muted"},[t("div",[e._v("To link your OctoPrint, please make sure:")]),t("ul",[t("li",[e._v("The Raspberry Pi is powered on.")]),t("li",[e._v(" The Raspberry Pi is connected to the same local network as your phone/computer. ")]),t("li",[e._v("The Obico plugin version is 1.8.0 or above.")])])]):e._e()])])],1):e._e()]:[e.targetOctoPrint?t("tab-content",{attrs:{title:"Plugin Wizard"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8"},[t("ol",[t("li",[e._v("Wait for "),t("em",[e._v('"Obico for OctoPrint"')]),e._v(" wizard to popup.")]),t("li",[e._v("Follow the instructions in the wizard.")]),t("li",[e._v("Select "),t("em",[e._v('"Web Setup"')]),e._v(" when asked.")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[t("img",{staticClass:"mx-auto screenshot",attrs:{src:i("4e03")},on:{click:function(t){return e.zoomIn(t)}}})])])])]):e._e(),t("tab-content",{attrs:{title:"Enter Code"}},[t("div",{staticClass:"container"},[t("div",{staticClass:"row justify-content-center pb-3"},[t("div",{staticClass:"col-sm-12 col-lg-8 d-flex flex-column align-items-center"},[t("input",{ref:"code",staticClass:"code-btn",attrs:{disabled:""},domProps:{value:""+(e.verificationCode&&e.verificationCode.code)}}),t("small",{staticClass:"mx-auto py-1",class:{"text-muted":!e.copied}},[e._v(e._s(e.copied?"Code copied to system clipboard":"Ctrl-C/Cmd-C to copy the code"))]),t("div",{staticClass:"mx-auto pt-1 pb-4"},[t("span",{staticClass:"text-muted"},[e._v("Code will expire in ")]),e._v(e._s(e.timeToExpire)+" ")]),t("div",{staticClass:"lead"},[e._v(" Enter the "),t("strong",[e._v("6-digit verification code")])])])]),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-sm-12 col-lg-8 img-container"},[e.targetOctoPrint?t("img",{staticClass:"screenshot",attrs:{src:i("f1f6")},on:{click:function(t){return e.zoomIn(t)}}}):e._e(),e.targetMoonraker?t("img",{staticClass:"screenshot",attrs:{src:i("1c3a")},on:{click:function(t){return e.zoomIn(t)}}}):e._e(),t("div",{staticClass:"helper mx-auto py-2"},[t("a",{staticClass:"link font-weight-bold",on:{click:e.showVerificationCodeHelpModal}},[e._v("Can't find the page to enter the 6-digit code?")])])])])])])]],2),t("div",{staticClass:"row"},[t("div",{staticClass:"helper col-sm-12"},[e._v(" Need help? Check out the "),t("a",{attrs:{target:"_blank",href:e.targetMoonraker?"https://www.obico.io/docs/user-guides/klipper-setup/":"https://www.obico.io/docs/user-guides/octoprint-plugin-setup/"}},[e._v("step-by-step set up guide.")])])])],1):t("div",{staticClass:"container"},[t("div",{staticClass:"row"},[t("h3",{staticClass:"col-sm-12 text-center p-3"},[e._v("Which platform are you using?")])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-sm-12 col-lg-6 p-4"},[t("div",{staticClass:"wizard-card",on:{click:function(t){return e.setTargetPlatform("octoprint")}}},[t("img",{attrs:{src:i("2e7f")}}),t("h3",{staticClass:"mt-4"},[e._v("OctoPrint")]),t("div",[e._v("Including OctoPrint for Klipper such as OctoKlipper.")])])]),t("div",{staticClass:"col-sm-12 col-lg-6 p-4"},[t("div",{staticClass:"wizard-card",on:{click:function(t){return e.setTargetPlatform("moonraker")}}},[t("div",[t("img",{attrs:{src:i("886f")}}),t("img",{attrs:{src:i("1f6a")}}),t("img",{attrs:{src:i("a085")}})]),t("h3",{staticClass:"mt-4"},[e._v("Klipper")]),t("h5",[e._v("with Mainsail/Fluidd/Moonraker")])])])])])])])])],1)],1)]},proxy:!0}])})},ca=[],da=i("ccf6"),ua=i("2ee4"),pa=(i("da93"),i("767e")),ha=i.n(pa),fa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"discovered-printers mt-4"},[t("div",{staticClass:"flex-grow-0 pt-1 mr-2"},[e.discoveredPrinter.rpi_model?t("img",{staticClass:"logo-img",attrs:{src:i("9605")}}):t("img",{staticClass:"logo-img",attrs:{src:i("2e7f")}})]),t("div",{staticClass:"row flex-grow-1 ml-1 link-action"},[t("div",{staticClass:"col-sm-12 col-md-10 pb-2"},[e.discoveredPrinter.rpi_model?t("div",[e._v(" "+e._s(e.discoveredPrinter.rpi_model)+" ")]):e._e(),e.discoveredPrinter.machine_type?t("div",[e._v(" "+e._s(e.discoveredPrinter.machine_type)+" ")]):e._e(),e.discoveredPrinter.agent?t("div",{staticClass:"text-muted small"},[e._v(" Platform: "+e._s(e.discoveredPrinter.agent)+" ")]):e._e(),e.discoveredPrinter.host_or_ip?t("div",{staticClass:"text-muted small"},[e._v(" IP address: "+e._s(e.discoveredPrinter.host_or_ip)+" ")]):e._e(),e.discoveredPrinter.hostname?t("div",{staticClass:"text-muted small"},[e._v(" Hostname: "+e._s(e.discoveredPrinter.hostname)+" ")]):e._e(),e.discoveredPrinter.octopi_version?t("div",{staticClass:"text-muted small"},[e._v(" OctoPi: "+e._s(e.discoveredPrinter.octopi_version)+" ")]):e._e(),!e.discoveredPrinter.octopi_version&&e.discoveredPrinter.os?t("div",{staticClass:"text-muted small"},[e._v(" OS: "+e._s(e.discoveredPrinter.os)+" ")]):e._e()]),t("div",{staticClass:"col-sm-12 col-md-2 center px-3"},[t("button",{staticClass:"btn btn-block btn-primary",on:{click:function(t){return e.$emit("auto-link-printer",{...e.discoveredPrinter})}}},[e._v(" Link ")])])])])},ma=[],va={name:"DiscoveredPrinter",props:{discoveredPrinter:{type:Object,required:!0}}},ga=va,ba=(i("6727"),Object(be["a"])(ga,fa,ma,!1,null,null,null)),_a=ba.exports,wa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"px-2"},[t("div",{staticClass:"title-pic"},[t("img",{staticClass:"pic-item",attrs:{src:i("4de7")}}),e._m(0),t("img",{staticClass:"pic-item",attrs:{src:i("2e7f")}})]),e._m(1),t("div",[t("div",{staticClass:"row my-2"},[t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-block btn-primary mt-2",attrs:{disabled:e.linking},on:{click:e.autoLinkPrinter}},[e.linking?t("b-spinner",{attrs:{small:""}}):e._e(),e._v("Link Now "),t("i",{staticClass:"fas fa-external-link-alt"})],1)]),t("div",{staticClass:"col-sm-6"},[t("button",{staticClass:"btn btn-block btn-secondary mt-2",on:{click:e.cancel}},[e._v("Cancel")])])])])])},ya=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"pic-item"},[t("i",{staticClass:"fas fa-ellipsis-h fa-2x"}),t("i",{staticClass:"fas fa-ellipsis-h fa-2x"})])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-4"},[t("p",[e._v("The Obico app needs to make sure you have access to selected OctoPrint.")]),t("p",[e._v(' When you press "Link Now" button below, a new browser window will pop up to finish a handshake with this OctoPrint. ')])])}],Ca={name:"AutoLinkPopup",props:{discoveredPrinter:{type:Object,required:!0},switchToManualLinking:{type:Function,required:!0},secretObtained:{type:Function,required:!0}},data(){return{linking:!1}},mounted(){window.addEventListener("message",this.gotWindowMessage)},beforeDestroy(){window.removeEventListener("message",this.gotWindowMessage)},methods:{autoLinkPrinter(){if(this.linking=!0,this.gotSecret=null,this.obicoDiscoveryPopup=window.open(this.destUrl(),"_blank","toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=500,height=100"),!this.obicoDiscoveryPopup)return this.cancel(),void this.$swal.Prompt.fire({icon:"error",title:"Oops!",html:"<p>Handshake failed because the pop-up was blcoked.</p><p>Please unblock the pop-up in your browser and try it again.</p>",confirmButtonText:"Okay!",showCancelButton:!0,cancelButtonText:"Switch to Manual Setup"}).then(e=>{e.isDismissed&&"cancel"===e.dismiss&&this.switchToManualLinking()});setTimeout(()=>{this.closeDiscoveryPopup(),this.gotSecret||(this.cancel(),this.$swal.Prompt.fire({icon:"error",title:"Handshake failed!",html:`<p>Please make sure:</p>\n              <ul>\n                <li>The OctoPrint you want to link is at ${this.discoveredPrinter.host_or_ip}:${this.discoveredPrinter.port}, and it's connected to the same local network as your computer/phone.</li>\n                <li>The version of plugin is 1.8.0 or above.</li>\n              </ul>`,confirmButtonText:"Okay!",showCancelButton:!0,cancelButtonText:"Switch to Manual Setup"}).then(e=>{e.isDismissed&&"cancel"===e.dismiss&&this.switchToManualLinking()}))},5e3)},destUrl(){const e=this.discoveredPrinter.agent?"obico":"thespaghettidetective";return`http://${this.discoveredPrinter.host_or_ip}:${this.discoveredPrinter.port||"80"}/plugin/${e}/grab-discovery-secret?device_id=${this.discoveredPrinter.device_id}`},switchToManual(){this.cancel(),this.switchToManualLinking()},closeDiscoveryPopup(){this.obicoDiscoveryPopup&&(this.obicoDiscoveryPopup.close(),this.obicoDiscoveryPopup=null)},gotWindowMessage(e){const t={...(null===e||void 0===e?void 0:e.data)||{}};!this.gotSecret&&this.discoveredPrinter.device_id&&t.device_secret?(this.gotSecret=t,this.secretObtained(this.discoveredPrinter.device_id,t.device_secret),this.cancel()):console.log("Ignored message",e)},cancel(){this.closeDiscoveryPopup(),this.$swal.close()}}},ka=Ca,Sa=(i("c49c"),Object(be["a"])(ka,wa,ya,!1,null,"7fccd11b",null)),Pa=Sa.exports;const xa=60;var Ta={components:{FormWizard:ua["FormWizard"],TabContent:ua["TabContent"],WizardButton:ua["WizardButton"],Loading:je.a,PageLayout:Xe,SavingAnimation:Qs["a"],DiscoveredPrinter:_a},data(){return{theme:ha.a,verificationCode:null,verifiedPrinter:null,onVerificationStep:!1,copied:!1,saving:{},errorMessages:{},delayedSubmit:{printer_name:{delay:1e3,timeoutId:null}},discoveryEnabled:!0,discoveryCount:0,discoveredPrinters:[],chosenDeviceId:null,gotSecret:null,obicoDiscoveryPopup:null,apiCallIntervalId:null,targetPlatform:null,routes:j}},computed:{printerIdToLink(){return new URLSearchParams(window.location.search.substring(1)).get("printerId")},title(){return this.printerIdToLink?"Re-Link Printer":"Link Printer"},editPrinterUrl(){return`/printers/${this.verifiedPrinter.id}/`},expiryMoment(){return this.verificationCode?W()(this.verificationCode.expired_at):null},timeToExpire(){return this.expiryMoment?W.a.duration(this.expiryMoment.diff(W()())).humanize():"-"},canStartLinking(){var e,t;return(null===(e=this.verificationCode)||void 0===e?void 0:e.code)&&(null===(t=this.discoveredPrinters)||void 0===t?void 0:t.length)>0},redirectToTunnelCreation(){return new URLSearchParams(window.location.search).get("redirectToTunnelCreation")},targetOctoPrint(){return"octoprint"===this.targetPlatform},targetMoonraker(){return"moonraker"===this.targetPlatform}},created(){this.printerIdToLink&&(this.discoveryEnabled=!1),this.getVerificationCode(),this.$route.path!==j.printerWizard&&this.$router.push(j.printerWizard+"?"+window.location.search)},methods:{setTargetPlatform(e){this.targetPlatform=e,"moonraker"===e&&(this.discoveryEnabled=!1),this.$router.push(j.printerWizardSetup+"?"+window.location.search)},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},updatePrinterName(){if("name"in this.verifiedPrinter&&this.verifiedPrinter.name){const e=this.delayedSubmit["printer_name"];return e["timeoutId"]&&clearTimeout(e["timeoutId"]),void(this.delayedSubmit["printer_name"]["timeoutId"]=setTimeout(()=>(this.setSavingStatus("printer_name",!0),z.a.patch(q["a"].printer(this.verifiedPrinter.id),{name:this.verifiedPrinter.name}).catch(e=>{console.log(e)}).then(()=>{this.setSavingStatus("printer_name",!1)})),e["delay"]))}{const e=this.delayedSubmit["printer_name"];e["timeoutId"]&&clearTimeout(e["timeoutId"])}},prevTab(){document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.remove("checked"),this.onVerificationStep=!1},nextTab(e){if(document.querySelector(".wizard-nav.wizard-nav-pills li.active .wizard-icon-circle").classList.add("checked"),this.onVerificationStep=1==e,0==e&&this.discoveryEnabled&&0==this.discoveryCount&&this.discoverPrinter(),this.onVerificationStep){const e=this.copyCode;let t=!1,i=17,n=91,r=67;document.addEventListener("keydown",(function(e){e.keyCode!=i&&e.keyCode!=n||(t=!0)})),document.addEventListener("keyup",(function(e){e.keyCode!=i&&e.keyCode!=n||(t=!1)})),document.addEventListener("keydown",(function(i){t&&i.keyCode==r&&e()}))}},verificationCodeUrl(){const e=q["a"].verificationCode();return this.verificationCode?this.verificationCode.verified_at||W()().isBefore(this.expiryMoment)?`${e}${this.verificationCode.id}/`:e:this.printerIdToLink?`${e}?printer_id=${this.printerIdToLink}`:e},copyCode(){if(this.onVerificationStep&&this.verificationCode){let t=document.createElement("textarea");t.value=this.verificationCode.code,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.copied=!0}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}},callVerificationCodeApi(){z.a.get(this.verificationCodeUrl()).then(e=>{e.data&&(this.verificationCode=e.data,this.verificationCode.verified_at&&(this.verifiedPrinter=e.data.printer,da["onPrinterLinked"]&&Object(da["onPrinterLinked"])()))})},getVerificationCode(){this.callVerificationCodeApi(),this.apiCallIntervalId=setInterval(()=>{this.verifiedPrinter?clearInterval(this.apiCallIntervalId):this.callVerificationCodeApi()},5e3)},showVerificationCodeHelpModal(){let e='<p>The 6-digit code needs to be entered in the Obico plugin in OctoPrint. There are a few reasons why you can\'t find this page:</p>\n        <p><ul>\n        <li style="margin: 10px 0;">You don\'t have the plugin installed or you haven\'t restarted OctoPrint after installation. Click <a href="/printers/wizard/">here</a> to walk through the process again.</li>\n        <li style="margin: 10px 0;">The installed plugin is on a version earlier than 1.5.0. You need to upgrade the plugin to <b>1.5.0</b> or later.</li>\n        <li style="margin: 10px 0;">Still no dice? Check out the step-by-step <a target="_blank" href="https://www.obico.io/docs/user-guides/octoprint-plugin-setup/">set up guide</a>.</li>\n        </ul></p>';this.targetOctoPrint||(e='<p>The 6-digit code needs to be entered to the <em>Obico for OctoPrint</em> installation script.</p>\n        <p>Check <a target="_blank" href="https://www.obico.io/docs/user-guides/klipper-setup/">this set up guide</a> for detailed instructions.</p>'),this.$swal.fire({title:"Can't find the page to enter the 6-digit code?",html:e,customClass:{container:"dark-backdrop"}})},zoomIn(e){e.target.classList.toggle("zoomedIn")},callPrinterDiscoveryApi(){this.discoveryEnabled&&(this.discoveryCount>=xa&&0===this.discoveredPrinters.length&&(this.discoveryEnabled=!1,this.$swal.Toast.fire({title:"No OctoPrint discovered on your local network. Switched to manual linking."})),this.discoveryCount+=1,z.a.get(q["a"].printerDiscovery()).then(e=>{this.discoveredPrinters=Ae()(e.data,e=>e.device_id)}))},discoverPrinter(){this.discoveryEnabled&&!this.verifiedPrinter&&(this.callPrinterDiscoveryApi(),setTimeout(()=>{this.discoverPrinter()},5e3))},autoLinkPrinter(e){this.$swal.openModalWithComponent(Pa,{discoveredPrinter:e,switchToManualLinking:()=>this.discoveryEnabled=!1,secretObtained:(e,t)=>this.secretObtained(e,t)},{title:"Browser Pop-up",showConfirmButton:!1,allowOutsideClick:!1})},secretObtained(e,t){this.chosenDeviceId=e,z.a.post(q["a"].printerDiscovery(),{code:this.verificationCode.code,device_id:this.chosenDeviceId,device_secret:t}),setTimeout(()=>{this.chosenDeviceId&&!this.verifiedPrinter&&(this.chosenDeviceId=null,this.$swal.Toast.fire({icon:"error",title:"Something went wrong. Switched to using 6-digit code to link OctoPrint."}),this.discoveryEnabled=!1),this.chosenDeviceId=null},2e4)}}},Fa=Ta,Da=(i("7c08"),i("67e5"),Object(be["a"])(Fa,la,ca,!1,null,"74dd6023",null)),Ia=Da.exports,Oa=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("b-col",{attrs:{lg:"8"}},[e.printer?t("div",{staticClass:"printer-card m-0"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-header"},[t("div",{staticClass:"title-box"},[t("div",{staticClass:"printer-name"},[e._v(e._s(e.printer.name))])])]),t("streaming-box",{attrs:{printer:e.printer,webrtc:e.webrtc,autoplay:e.user.is_pro}}),t("div",{staticClass:"card-body",class:{overlay:e.printer.isActive()}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.printer.isActive(),expression:"printer.isActive()"}],staticClass:"overlay-top text-center",staticStyle:{left:"0",width:"100%",top:"50%","margin-top":"-85px"}},[t("div",[e._v("Printer controls are disabled")]),t("div",[e._v("because the printer is not idle.")])]),t("div",{staticClass:"printer-controls"},[t("div",{staticClass:"xy-controls"},[t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"y","data-dir":"up"},on:{click:function(t){return e.control(e.axis.y,e.directions.up)}}},[t("i",{staticClass:"fas fa-angle-up fa-lg"})]),t("div",{staticClass:"x-controls"},[t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"x","data-dir":"down"},on:{click:function(t){return e.control(e.axis.x,e.directions.down)}}},[t("i",{staticClass:"fas fa-angle-left fa-lg"})]),t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"xy","data-dir":"home"},on:{click:function(t){return e.control(e.axis.xy,e.directions.home)}}},[t("i",{staticClass:"fas fa-home fa-lg"})]),t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"x","data-dir":"up"},on:{click:function(t){return e.control(e.axis.x,e.directions.up)}}},[t("i",{staticClass:"fas fa-angle-right fa-lg"})])]),t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"y","data-dir":"down"},on:{click:function(t){return e.control(e.axis.y,e.directions.down)}}},[t("i",{staticClass:"fas fa-angle-down fa-lg"})])]),t("div",{staticClass:"z-controls"},[t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"up"},on:{click:function(t){return e.control(e.axis.z,e.directions.up)}}},[t("i",{staticClass:"fas fa-angle-up fa-lg"})]),t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"home"},on:{click:function(t){return e.control(e.axis.z,e.directions.home)}}},[t("i",{staticClass:"fas fa-home fa-lg"})]),t("button",{staticClass:"btn",attrs:{type:"button","data-axis":"z","data-dir":"down"},on:{click:function(t){return e.control(e.axis.z,e.directions.down)}}},[t("i",{staticClass:"fas fa-angle-down fa-lg"})])])]),t("br"),t("div",{staticClass:"control-options"},[t("b-form-group",{scopedSlots:e._u([{key:"default",fn:function({ariaDescribedby:i}){return[t("b-form-radio-group",{attrs:{options:e.jogDistanceOptions.map(e=>({text:e+"mm",value:e})),name:"jogDistance","button-variant":"default","aria-describedby":i,buttons:""},model:{value:e.jogDistance,callback:function(t){e.jogDistance=t},expression:"jogDistance"}})]}}],null,!1,3268279119)})],1)])],1)]):e._e()])],1)],1)]},proxy:!0}])})},Aa=[];const Ea={x:"x",y:"y",z:"z",xy:["x","y"]},Ma={up:1,down:-1,home:0};var Na={name:"PrinterControlPage",components:{StreamingBox:_n,PageLayout:Xe},data(){return{axis:Ea,directions:Ma,user:null,printerId:null,printer:null,webrtc:null,jogDistance:10,jogDistanceOptions:[.1,1,10,100]}},watch:{jogDistance:function(e){Object(a["a"])()&&localStorage.setItem("mm-per-step-"+this.printerId,e)}},created(){this.user=Object(se["f"])(),this.printerId=Se()(window.location.pathname,"/").slice(-3,-2).pop();const e=Object(a["a"])()?localStorage.getItem("mm-per-step-"+this.printerId):null;this.jogDistance=e||this.jogDistance,this.webrtc=cn(),this.printerComm=Oi(this.printerId,q["a"].printerWebSocket(this.printerId),e=>{this.printer=ne(e,this.printer),this.webrtc&&!this.webrtc.initialized&&(this.webrtc.openForPrinter(this.printer.id,this.printer.auth_token),this.printerComm.setWebRTC(this.webrtc))}),this.printerComm.connect()},methods:{control(e,t){let i=[],n="jog";t===this.directions.home?(i.push(e),n="home"):i.push({[e]:t*this.jogDistance});const r={func:n,target:"_printer",args:i};this.printerComm.passThruToPrinter(r,(e,t)=>{null!==t&&void 0!==t&&t.error&&this.$swal.Toast.fire({icon:"error",title:t.error})})}}},Ra=Na,La=(i("25bf"),Object(be["a"])(Ra,Oa,Aa,!1,null,"0a5a3186",null)),ja=La.exports,Ba=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"content",fn:function(){return[t("b-container",{staticClass:"flex-full-size",class:{"is-in-mobile":e.useMobileLayout},attrs:{fluid:"xl"}},[t("b-row",{staticClass:"flex-full-size"},[t("b-col",{staticClass:"flex-full-size"},[e.user?t("div",{staticClass:"flex-full-size"},[e.useMobileLayout?t("div",{staticClass:"mobile-settings-wrapper full-on-mobile"},["/user_preferences/"===e.$route.path?t("div",{staticClass:"mobile-settings-categories"},[t("h2",{directives:[{name:"show",rawName:"v-show",value:!e.onlyNotifications(),expression:"!onlyNotifications()"}],staticClass:"categories-title section-title"},[e._v(" Account ")]),e._l(e.sections,(function(i,n){return[i.isHidden?e._e():t("router-link",{key:n,class:i.isSubcategory?"subcategory":"",attrs:{to:i.route}},[t("span",[i.faIcon?t("i",{class:[i.faIcon,"mr-2"],staticStyle:{"font-size":"1.125rem"}}):e._e(),t("span",[e._v(e._s(i.title))])]),t("i",{staticClass:"fas fa-arrow-right"})])]})),e.onlyNotifications()?e._e():t("a",{attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.logout.apply(null,arguments)}}},[t("span",[t("i",{class:["fas fa-sign-out-alt","mr-2"],staticStyle:{"font-size":"1.125rem"}}),e._v(" Logout ")])])],2):t("div",{staticClass:"mobile-settings-content",class:{"is-in-mobile":e.useMobileLayout}},[!e.currentSection||e.currentSection.isNotificationChannel&&!e.availableNotificationPlugins?e._e():t(e.currentRouteComponent,{tag:"component",attrs:{user:e.user,"error-messages":e.errorMessages,saving:e.saving,config:e.config,"notification-channel":e.currentSection&&e.currentSection.isNotificationChannel?e.currentSection:{}},on:{createNotificationChannel:e.createNotificationChannel,updateNotificationChannel:e.patchNotificationChannel,deleteNotificationChannel:e.deleteNotificationChannel,clearErrorMessages:e.clearErrorMessages,addErrorMessage:e.addErrorMessage,updateSetting:e.updateSetting,errorAlert:e.errorAlert}})],1)]):t("b-tabs",{staticClass:"desktop-settings-wrapper",attrs:{vertical:!0,"nav-wrapper-class":"settings-nav","active-nav-item-class":"","content-class":"desktop-settings-content"},on:{"activate-tab":e.updateRoute},scopedSlots:e._u([{key:"tabs-end",fn:function(){return[t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.logout.apply(null,arguments)}}},[t("i",{class:["fas fa-sign-out-alt","mr-2"]}),e._v(" Logout ")])])]},proxy:!0}],null,!1,1810625595)},[e._l(e.sections,(function(i,n){return[i.isHidden?e._e():t("b-tab",{key:n,attrs:{"title-item-class":i.isSubcategory?"subcategory":"",active:e.$route.path===i.route,disabled:i.isNotificationChannel&&!e.user.notification_enabled},scopedSlots:e._u([{key:"title",fn:function(){return[i.faIcon?t("i",{class:[i.faIcon,"mr-2"]}):e._e(),e._v(" "+e._s(i.title)+" ")]},proxy:!0}],null,!0)},[!i.isNotificationChannel||e.availableNotificationPlugins?t(n,{tag:"component",attrs:{user:e.user,"error-messages":e.errorMessages,saving:e.saving,config:e.config,"notification-channel":i.isNotificationChannel?i:{}},on:{createNotificationChannel:e.createNotificationChannel,updateNotificationChannel:e.patchNotificationChannel,deleteNotificationChannel:e.deleteNotificationChannel,clearErrorMessages:e.clearErrorMessages,addErrorMessage:e.addErrorMessage,updateSetting:e.updateSetting,errorAlert:e.errorAlert}}):e._e()],1)]}))],2)],1):t("div",{staticClass:"text-center"},[t("b-spinner",{staticClass:"mt-5",attrs:{label:"Loading..."}})],1)])],1)],1)]},proxy:!0}])})},$a=[];const Ua={ThemePreferences:{title:"Appearance",faIcon:"fas fa-magic",importComponent:()=>i.e("chunk-9a5a2602").then(i.bind(null,"3922")),route:R.ThemePreferences,isHidden:Object(se["a"])()&&!("true"===new URLSearchParams(window.location.search).get("themeable"))||Object(se["d"])()},ProfilePreferences:{title:"Profile",faIcon:"fas fa-user-edit",importComponent:()=>i.e("chunk-2d22c522").then(i.bind(null,"f376")),route:R.ProfilePreferences,isHidden:Object(se["d"])()},AuthorizedApps:{title:"Authorized Apps",faIcon:"fas fa-check-circle",importComponent:()=>i.e("chunk-2d21a9b7").then(i.bind(null,"bbde")),route:R.AuthorizedApps,isHidden:Object(se["d"])()},GeneralNotifications:{title:"Notifications",faIcon:"fas fa-bell",importComponent:()=>i.e("chunk-35ec7b04").then(i.bind(null,"9c95")),route:R.GeneralNotifications},PushNotifications:{title:"Push Notification",isSubcategory:!0,isNotificationChannel:!0,importComponent:()=>({}),route:R.PushNotifications,isHidden:!Object(se["a"])()}},za=Object.keys(E).reduce((e,t)=>Object.assign(e,{[t]:{title:E[t].displayName,channelName:t,isSubcategory:!0,isNotificationChannel:!0,route:R[t],importComponent:()=>i("17ae")("./"+E[t].componentName)}}),{});var Va={...Ua,...za},Wa={name:"UserPreferencesPage",components:{PageLayout:Xe,...Object.keys(Va).reduce((e,t)=>Object.assign(e,{[t]:Va[t].importComponent}),{})},props:{config:{default(){return{}},type:Object}},data(){return{sections:Va,availableNotificationPlugins:null,configuredNotificationChannels:null,onlyNotifications:se["d"],user:null,saving:{},errorMessages:{},delayedSubmit:{first_name:{delay:1e3,timeoutId:null},last_name:{delay:1e3,timeoutId:null}},combinedInputs:{},useMobileLayout:!1}},computed:{visibleSections(){return Object.values(Va).filter(e=>!e.isHidden)},currentRouteComponent(){for(const[e,t]of Object.entries(R))if(this.$route.path===t)return e;return null},currentSection(){for(const e of Object.values(this.sections))if(e.route===this.$route.path)return e;return null},inMobileWebView(){return Object(se["a"])()},clientIsThemeable(){return!Object(se["a"])()||"true"===new URLSearchParams(window.location.search).get("themeable")}},created(){this.fetchNotificationPlugins(),this.fetchNotificationChannels(),this.fetchUser()},mounted(){this.checkMobileLayout(),window.onresize=this.checkMobileLayout,this.useMobileLayout&&(document.querySelector("body").style.paddingTop="0px")},methods:{updateRoute(e){const t=Object.values(this.visibleSections)[e];this.$router.replace({path:t.route})},logout(){this.$swal.Confirm.fire({title:"Confirmation",html:'<p class="text-center">You a going to logout from your account</p>',confirmButtonText:"Logout",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&window.location.replace("/accounts/logout/")})},checkMobileLayout(){const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);this.useMobileLayout=Object(se["a"])()||e<1140},fetchUser(){return z.a.get(q["a"].user()).then(e=>{this.user=e.data})},fetchNotificationPlugins(){return z.a.get(q["a"].notificationPlugins()).then(e=>{const t=e.data.plugins||{};this.availableNotificationPlugins=t;for(const[i,n]of Object.entries(this.sections))n.isNotificationChannel&&(this.sections[i].pluginInfo=t[n.channelName])})},fetchNotificationChannels(){return z.a.get(q["a"].notificationChannels()).then(e=>{const t=e.data;this.configuredNotificationChannels=t;for(const[i,n]of Object.entries(this.sections))n.isNotificationChannel&&(this.sections[i].channelInfo=t.find(e=>e.name===n.channelName))})},createNotificationChannel({section:e,config:t,opts:i={}}){const n={user:this.user.id,name:e.channelName,config:t,...i},r=Object(Xt["d"])(e,"config");return this.setSavingStatus(r,!0),z.a.post(q["a"].notificationChannels(),n).then(()=>{this.setSavingStatus(r,!1),this.$router.go()}).catch(t=>{if(this.setSavingStatus(r,!1),t.response&&t.response.data&&"object"===typeof t.response.data){let i=[];for(const e of Object.values(t.response.data))if("object"===typeof e)for(const t of Object.values(e))i.push(t);else"string"===typeof e?i.push(e):(console.warn("Undefined error object structure"),console.log(t.response));const n=Object(Xt["d"])(e,"config");this.$set(this.errorMessages,n,i)}else console.log(t.response),this.errorAlert()})},patchNotificationChannel({section:e,propNames:t,propValues:i}){void 0!==i&&i.forEach((i,n)=>{const r=t[n];this.sections[e.channelName].channelInfo[r]=i});let n={name:e.channelName};for(const r of t)n[r]=e.channelInfo[r];for(const r of t){const t=Object(Xt["d"])(e,r);this.setSavingStatus(t,!0)}return z.a.patch(q["a"].updateNotificationChannel(e.channelInfo.id),n).then(()=>{for(const i of t){const t=Object(Xt["d"])(e,i);this.setSavingStatus(t,!1)}}).catch(i=>{for(const n of t){const t=Object(Xt["d"])(e,n);this.setSavingStatus(t,!1)}if(i.response&&i.response.data&&"object"===typeof i.response.data){let n=[];for(const e of Object.values(i.response.data))if("object"===typeof e)for(const t of Object.values(e))n.push(t);else"string"===typeof e?n.push(e):(console.warn("Undefined error object structure"),console.log(i.response));for(const i of t){const t=Object(Xt["d"])(e,i);this.$set(this.errorMessages,t,n)}}else console.log(i.response),this.errorAlert()})},deleteNotificationChannel(e){return z.a.delete(q["a"].updateNotificationChannel(e.channelInfo.id)).then(()=>{this.$router.go()}).catch(e=>{console.log(e.response),this.errorAlert()})},clearErrorMessages(e){this.errorMessages[e]=[]},addErrorMessage(e,t){this.errorMessages[e]?this.errorMessages[e].push(t):this.errorMessages[e]=[t]},patchUser(e,t){let i={},n=e;const r=this.checkForCombinedValues(e);if(r){for(const s of r.inputs){n=r.key;const e=this.user[s];i[s]=e}const e=Object.values(i),t=e.filter(e=>!e);if(t.length!==e.length&&0!==t.length)return}else i={[e]:t};return this.setSavingStatus(n,!0),z.a.patch(q["a"].user(),i).catch(e=>{if(e.response&&e.response.data&&"object"===typeof e.response.data)if(e.response.data.non_field_errors)this.errorAlert(e.response.data.non_field_errors);else for(const t in e.response.data)this.errorMessages[n]=e.response.data[t];else this.errorAlert()}).then(()=>{window.ReactNativeWebView&&("first_name"===n?window.ReactNativeWebView.postMessage(JSON.stringify({firstName:this.user.first_name})):"last_name"===n&&window.ReactNativeWebView.postMessage(JSON.stringify({lastName:this.user.last_name}))),this.setSavingStatus(n,!1)})},checkForCombinedValues(e){for(const[t,i]of Object.entries(this.combinedInputs))if(i.includes(e))return{inputs:i,key:t};return null},setSavingStatus(e,t){t&&delete this.errorMessages[e],this.$set(this.saving,e,t)},errorAlert(e=null){this.$swal({icon:"error",html:`<p>${e||"Can not update your preferences."}</p><p>Get help from <a href="https://obico.io/discord">the Obico app discussion forum</a> if this error persists.</p>`})},updateSetting(e,t){if(void 0!==t&&(this.user[e]=t),e in this.delayedSubmit){const t=this.delayedSubmit[e];return t["timeoutId"]&&clearTimeout(t["timeoutId"]),void(this.delayedSubmit[e]["timeoutId"]=setTimeout(()=>{this.patchUser(e,this.user[e])},t["delay"]))}this.patchUser(e,this.user[e])}}},qa=Wa,Ga=(i("8c2a"),Object(be["a"])(qa,Ba,$a,!1,null,"0361f75e",null)),Ha=Ga.exports,Ja=function(){var e=this,t=e._self._c;return t("page-layout",{scopedSlots:e._u([{key:"topBarRight",fn:function(){return[t("div",[t("b-dropdown",{attrs:{right:"","no-caret":"","toggle-class":"icon-btn"},scopedSlots:e._u([{key:"button-content",fn:function(){return[t("i",{staticClass:"fas fa-filter"})]},proxy:!0}])},[e._l(e.eventClassFiltering,(function(i){return t("b-dropdown-item",{key:i.key,on:{click:function(t){return e.toggleEventFiltering("eventClassFiltering",i.key)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:i.selected?"visible":"hidden"}}),t("span",{class:e.cssClassFromEventClass(i.key)},[e._v(e._s(i.title))])])})),t("b-dropdown-divider"),e._l(e.eventTypeFiltering,(function(i){return t("b-dropdown-item",{key:i.key,on:{click:function(t){return e.toggleEventFiltering("eventTypeFiltering",i.key)}}},[t("i",{staticClass:"fas fa-check text-primary",style:{visibility:i.selected?"visible":"hidden"}}),e._v(e._s(i.title)+" ")])}))],2)],1)]},proxy:!0},{key:"content",fn:function(){return[t("b-container",[t("b-row",{staticClass:"justify-content-center"},[t("div",{staticClass:"col-sm-12 col-md-10 col-lg-8"},[e.loading||0!==e.printerEvents.length?t("div",[e._l(e.printerEvents,(function(e){return t("printer-event-card",{key:e.id,attrs:{"printer-event":e}})})),t("mugen-scroll",{staticClass:"text-center p-4",attrs:{handler:e.fetchMoreData,"should-handle":!e.loading}},[e.noMoreData?t("div",{staticClass:"text-center p-2"},[e._v("No more notifications.")]):e._e(),e.noMoreData?e._e():t("b-spinner",{attrs:{label:"Loading..."}})],1)],2):t("div",{staticClass:"text-center"},[t("img",{staticClass:"w-25 my-4",attrs:{src:i("f23d")}}),t("h5",{staticClass:"text-primary"},[e._v("Nothing to look here. Enjoy your vacation!")])])])])],1)]},proxy:!0}])})},Ya=[],Ka=function(){var e=this,t=e._self._c;return t("div",{staticClass:"printer-event-card my-3",class:e.tintBorderClass},[t("div",{staticClass:"printer-event-text",class:{link:e.printerEvent.info_url},on:{click:e.onTextClick}},[t("div",{staticClass:"title font-weight-bold my-2",class:e.tintClass},[e._v(" "+e._s(e.eventTitle)+" "),e.printerEvent.info_url?t("i",{staticClass:"fas fa-external-link-alt"}):e._e()]),t("div",{staticClass:"description",domProps:{innerHTML:e._s(e.printerEvent.event_text)}}),t("div",{staticClass:"my-2 text-muted font-weight-light small"},[e._v(" "+e._s(e.printerEvent.created_at.format("LLLL"))+" ")])]),e.printerEvent.image_url?t("div",{staticClass:"printer-event-snapshot",style:{backgroundImage:`url(${e.printerEvent.image_url})`}}):e._e()])},Qa=[],Za={name:"PrinterEventCard",components:{},props:{printerEvent:{type:Object,required:!0}},computed:{eventTitle(){return this.printerEvent.event_title||"Unknown event"},tintClass(){switch(this.printerEvent.event_class){case"ERROR":return"text-danger";case"WARNING":return"text-warning";case"SUCCESS":return"text-success";default:return""}},tintBorderClass(){switch(this.printerEvent.event_class){case"ERROR":return"border-danger";case"WARNING":return"border-warning";case"SUCCESS":return"border-success";default:return""}}},methods:{onTextClick(){this.printerEvent.info_url&&window.open(this.printerEvent.info_url,"_blank")}}},Xa=Za,eo=(i("86d5"),Object(be["a"])(Xa,Ka,Qa,!1,null,"0f7e8e5e",null)),to=eo.exports;const io={eventClassFiltering:"printer-event-class-filtering",eventTypeFiltering:"printer-event-type-filtering"},no=(e,t)=>`${io["prefix"]}.${t}`,ro=(e,t,i)=>o(no(e,t),i),so=12;var ao={name:"PrinterEventsPage",components:{MugenScroll:xt.a,PageLayout:Xe,PrinterEventCard:to},props:{},data(){return{printerEvents:[],loading:!1,noMoreData:!1,eventClassFiltering:[{key:"ERROR",title:"Error",selected:ro("eventClassFiltering","ERROR",!0)},{key:"WARNING",title:"Warning",selected:ro("eventClassFiltering","WARNING",!0)},{key:"SUCCESS",title:"Successs",selected:ro("eventClassFiltering","SUCCESS",!0)},{key:"INFO",title:"Other",selected:ro("eventClassFiltering","INFO",!0)}],eventTypeFiltering:[{key:"ALERT",title:"Failure Detection",selected:ro("eventTypeFiltering","ALERT",!0)},{key:"ENDED",title:"Print Job Ended",selected:ro("eventTypeFiltering","ENDED",!0)},{key:"STARTED",title:"Print Job Started",selected:ro("eventTypeFiltering","STARTED",!0)},{key:"PAUSE_RESUME",title:"Print Job Paused/Resumed",selected:ro("eventTypeFiltering","PAUSE_RESUME",!0)},{key:"FILAMENT_CHANGE",title:"Filament Change",selected:ro("eventTypeFiltering","FILAMENT_CHANGE",!0)},{key:"PRINTER_ERROR",title:"Printer Error",selected:ro("eventTypeFiltering","PRINTER_ERROR",!0)}]}},created(){this.refetchData()},methods:{fetchMoreData(){if(this.noMoreData)return;this.loading=!0;const e=Jt()(Zt()(this.eventClassFiltering,"selected"),"key"),t=Jt()(Zt()(this.eventTypeFiltering,"selected"),"key");z.a.get(q["a"].printerEvents(),{params:{start:this.printerEvents.length,limit:so,filter_by_classes:e,filter_by_types:t}}).then(e=>{this.loading=!1,this.noMoreData=e.data.length<so,this.printerEvents.push(...e.data.map(e=>re(e)))})},refetchData(){this.printerEvents=[],this.noMoreData=!1,this.fetchMoreData()},cssClassFromEventClass(e){switch(e){case"ERROR":return"text-danger";case"INFO":return"";default:return"text-"+e.toLowerCase()}},toggleEventFiltering(e,t){const i=Me()(this[e],e=>e.key==t),n=this[e][i];this.$set(this[e],i,{...n,selected:!n.selected}),l(no("eventClassFiltering",e.key),!n.selected),this.refetchData()}}},oo=ao,lo=Object(be["a"])(oo,Ja,Ya,!1,null,"170eef32",null),co=lo.exports;const uo=new r["a"]({mode:"history",routes:[{path:"/g_code_folders/cloud/:parentFolder",component:bs},{path:"/g_code_folders/local/:printerId/:parentFolder?",component:bs},{path:"/g_code_files/cloud/:fileId",component:Is},{path:"/g_code_files/local/:printerId/:fileId",component:Is},{path:"/user_preferences",component:Ha},...Object.values(R).map(e=>({path:e,component:Ha})),...Object.values(j).map(e=>({path:e,component:Ia}))]}),po={NewOctoPrintTunnelPage:we,OctoPrintTunnelPage:Fe,PrintShotFeedbackApp:Ct,PrinterListPage:Rs,SharedPrinterPage:Js,PrinterSettingsPage:oa,PrinterWizardPage:Ia,PrinterControlPage:ja,GCodeFoldersPage:bs,GCodeFilePage:Is,PrintsPage:ki,PrintPage:ji,PrintHistoryPage:Wt,UploadPrintPage:Gi,UserPreferencesPage:Ha,PrinterEventsPage:co};A(uo,po)},"587d":function(e,t,i){"use strict";i("9135")},"58d0":function(e,t,i){"use strict";i("30c2")},"59cf":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"d",(function(){return d}));var n=i("6c44");const r={Light:"Light",Dark:"Dark",System:"System"},s=(Object(n["a"])()?localStorage.getItem("colorTheme"):r.Dark)||r.Dark,a=[{name:"primary",values:{[r.Light]:"#01A299",[r.Dark]:"#03DAC5"}},{name:"primary-hover",values:{[r.Light]:"#019592",[r.Dark]:"#70EFDE"}},{name:"primary-muted",values:{[r.Light]:"#03DAC5",[r.Dark]:"#018786"}},{name:"on-primary",values:{[r.Light]:"#FFFFFF",[r.Dark]:"#001210"}},{name:"secondary",values:{[r.Light]:"#28303A",[r.Dark]:"#EBEBEB"}},{name:"secondary-hover",values:{[r.Light]:"#424A54",[r.Dark]:"#D0D0D0"}},{name:"on-secondary",values:{[r.Light]:"#EBEBEB",[r.Dark]:"#28303A"}},{name:"success",values:{[r.Light]:"#5CB85C",[r.Dark]:"#5CB85C"}},{name:"success-hover",values:{[r.Light]:"#4CAE4C",[r.Dark]:"#4CAE4C"}},{name:"on-success",values:{[r.Light]:"#ffffff",[r.Dark]:"#ffffff"}},{name:"danger",values:{[r.Light]:"#D9534F",[r.Dark]:"#D9534F"}},{name:"danger-hover",values:{[r.Light]:"#C2413D",[r.Dark]:"#C2413D"}},{name:"on-danger",values:{[r.Light]:"#ffffff",[r.Dark]:"#ffffff"}},{name:"warning",values:{[r.Light]:"#F0AD4E",[r.Dark]:"#F0AD4E"}},{name:"warning-hover",values:{[r.Light]:"#DB9A3F",[r.Dark]:"#DB9A3F"}},{name:"on-warning",values:{[r.Light]:"#ffffff",[r.Dark]:"#ffffff"}},{name:"on-warning-2",values:{[r.Light]:"#000000",[r.Dark]:"#000000"}},{name:"background",values:{[r.Light]:"#EBEBEB",[r.Dark]:"#233141"}},{name:"surface-primary",values:{[r.Light]:"#ffffff",[r.Dark]:"#485B71"}},{name:"surface-secondary",values:{[r.Light]:"#F5F5F5",[r.Dark]:"#2D3E4F"}},{name:"overlay",values:{[r.Light]:"#F5F5F5CC",[r.Dark]:"#000000CC"}},{name:"hover",values:{[r.Light]:"#66666613",[r.Dark]:"#FFFFFF13"}},{name:"hover-accent",values:{[r.Light]:"#66666626",[r.Dark]:"#C9E0FA26"}},{name:"divider",values:{[r.Light]:"#ABB6C2",[r.Dark]:"#6A7B8A"}},{name:"divider-muted",values:{[r.Light]:"#ABB6C266",[r.Dark]:"#6A7B8A66"}},{name:"text-primary",values:{[r.Light]:"#28303A",[r.Dark]:"#EBEBEB"}},{name:"text-secondary",values:{[r.Light]:"#8A94A2",[r.Dark]:"#AAACB0"}},{name:"text-help",values:{[r.Light]:"#4C9BE8",[r.Dark]:"#4C9BE8"}},{name:"input-background",values:{[r.Light]:"#E2E8ED",[r.Dark]:"#42566B"}},{name:"input-placeholder",values:{[r.Light]:"#28303A80",[r.Dark]:"#EBEBEB80"}},{name:"table-accent",values:{[r.Light]:"#E3E3E3",[r.Dark]:"#283848"}},{name:"icon-tunneling-1",values:{[r.Light]:"#4E5D6C",[r.Dark]:"#EAEAEA"}},{name:"icon-tunneling-2",values:{[r.Light]:"#1D2935",[r.Dark]:"#CDCDCD"}}],o=[{name:"loader",values:{[r.Light]:'url("/static/img/loader/loader_light-scheme.svg")',[r.Dark]:'url("/static/img/loader/loader_dark-scheme.svg")'}}],l=[{name:"top-nav",values:{[r.Light]:"0px 2px 10px rgb(0 0 0 / .1)",[r.Dark]:"0px 2px 10px rgb(0 0 0 / .3)"}}];function c(e){return e.value===r.System?"not all"!==window.matchMedia("(prefers-color-scheme)").media&&window.matchMedia("(prefers-color-scheme: light)").matches?r.Light:r.Dark:e.value}function d(e){a.forEach((function(t){if(document.documentElement.style.setProperty("--color-"+t.name,t.values[e]),"surface-secondary"===t.name){let i=document.querySelector('meta[name="theme-color"]');i.content=t.values[e]}})),o.forEach((function(t){document.documentElement.style.setProperty("--url-"+t.name,t.values[e])})),l.forEach((function(t){document.documentElement.style.setProperty("--shadow-"+t.name,t.values[e])}))}},"5a0b":function(e,t,i){"use strict";i("ffb3")},"5e59":function(e,t,i){},6181:function(e,t,i){"use strict";i("d6fc")},"63f8":function(e,t,i){},"664c":function(e,t,i){},6711:function(e,t,i){"use strict";i("b304")},6727:function(e,t,i){"use strict";i("f444")},"67e5":function(e,t,i){"use strict";i("63f8")},6892:function(e,t,i){"use strict";i("04b2")},"6c44":function(e,t,i){"use strict";function n(){try{const e="__random_key_we_are_not_going_to_use__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}i.d(t,"a",(function(){return n}))},"767e":function(e,t,i){e.exports={primary:"#00c4b4",white:"#fff"}},"7a9c":function(e,t,i){"use strict";i("26a6")},"7c08":function(e,t,i){"use strict";i("db28")},"7ca1":function(e,t,i){},8435:function(e,t,i){"use strict";i("feae")},"847e":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("div",{class:{"saving-in-progress":e.savingClass,"successfully-saved":e.savingDoneClass,"failed-to-save":e.savingFailedClass,"small-height":e.smallHeightClass}},[e._t("default")],2),e.errors&&e.errors.length>0?t("small",{staticClass:"text-danger"},[e._v(e._s(e.errorMsg))]):e._e()])},r=[],s={name:"SavingAnimation",props:{saving:{default(){return!1},type:Boolean},errors:{type:Array,default:null},height:{default(){return"normal"},type:String}},data(){return{savingTimeout:null,savingDoneTimeout:null}},computed:{savingClass(){return this.saving&&this.savingTimeout},savingDoneClass(){return!this.saving&&this.savingDoneTimeout&&!this.errors},savingFailedClass(){return!this.saving&&this.savingDoneTimeout&&this.errors&&this.errors.length>0},smallHeightClass(){return"small"===this.height},errorMsg(){return this.errors?this.errors.join(" "):""}},watch:{saving:function(e,t){!t&&e?(this.clearSavingTimeout(),this.savingTimeout=setTimeout(this.clearSavingTimeout,15e3)):t&&!e&&(this.clearSavingTimeout(),this.savingDoneTimeout=setTimeout(()=>{clearTimeout(this.savingDoneTimeout),this.savingDoneTimeout=null},2e3))}},methods:{clearSavingTimeout(){this.savingTimeout&&(clearTimeout(this.savingTimeout),this.savingTimeout=null)}}},a=s,o=(i("8a34"),i("2877")),l=Object(o["a"])(a,n,r,!1,null,"2e4df370",null);t["a"]=l.exports},"86d5":function(e,t,i){"use strict";i("d689")},"86e4":function(e,t,i){},"886f":function(e,t,i){e.exports=i.p+"img/klipper_logo.jpg"},"8a34":function(e,t,i){"use strict";i("0fcf")},"8aab":function(e,t,i){},"8c2a":function(e,t,i){"use strict";i("d5e6")},"8e26":function(e,t,i){},"8f46":function(e,t,i){},"90a6":function(e,t,i){},9135:function(e,t,i){},9193:function(e,t,i){},9605:function(e,t,i){e.exports=i.p+"img/raspberry_pi.png"},9615:function(e,t,i){"use strict";i("d3c7")},9675:function(e,t,i){"use strict";i("49f2")},"99bb":function(e,t,i){},a085:function(e,t,i){e.exports=i.p+"img/fluidd_logo.png"},a1f5:function(e,t,i){"use strict";i("90a6")},a21a:function(e,t,i){"use strict";i("b877")},a31e:function(e,t,i){"use strict";i("86e4")},a499:function(e,t,i){"use strict";i("3cd0")},a67f:function(e,t,i){},abc7:function(e,t,i){"use strict";i("d75f")},ac93:function(e,t,i){"use strict";i("8aab")},b231:function(e,t,i){e.exports=i.p+"img/plugin_rerun_setup.png"},b279:function(e,t,i){"use strict";i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return p})),i.d(t,"c",(function(){return h})),i.d(t,"f",(function(){return f})),i.d(t,"b",(function(){return m})),i.d(t,"a",(function(){return v}));var n=i("e740"),r=i.n(n),s=i("2f9f"),a=i.n(s),o=i("6373"),l=i.n(o),c=i("9b02"),d=i.n(c);function u(e,t){return`${e.channelName}_${t}`}function p(e){return r()(a()(l()(e,/_/g," ")))}const h=(e,t,i)=>{const n=Math.round(e.length*t),r=i?"p":"fields.normalized_p";return d()(e[n],""+r,0)},f=(e,t)=>{if(e)if(e instanceof Blob){const i=new FileReader;i.addEventListener("loadend",e=>{e.srcElement&&t(e.srcElement.result)}),i.readAsArrayBuffer(e)}else t(e)},m=()=>{var e;return null===(e=document.getElementsByName("csrfmiddlewaretoken")[0])||void 0===e?void 0:e.value},v=(e,t)=>{fetch(e).then(e=>e.blob()).then(e=>{const i=document.createElement("a");i.setAttribute("download",t);const n=URL.createObjectURL(e);i.href=n,i.setAttribute("target","_blank"),i.click(),URL.revokeObjectURL(n)})}},b304:function(e,t,i){},b630:function(e,t,i){},b877:function(e,t,i){},c0f2:function(e,t,i){},c15a:function(e,t,i){"use strict";i("3840")},c25c:function(e,t,i){"use strict";i("152e")},c49c:function(e,t,i){"use strict";i("8f46")},c7f6:function(e,t,i){"use strict";var n=i("0b49"),r=i.n(n),s=i("dd61"),a=i.n(s);t["a"]={printShotFeedback:(e,t)=>`/api/v1/printshotfeedbacks/${e}/?print_id=${t}`,print:e=>`/api/v1/prints/${e}/`,prints:()=>"/api/v1/prints/",printsBulkDelete:()=>"/api/v1/prints/bulk_delete/",printers:()=>"/api/v1/printers/",printer:e=>`/api/v1/printers/${e}/`,printerAction:(e,t)=>`/api/v1/printers/${e}${t}`,pubPrinter:()=>"/api/v1p/printer/",tunnels:()=>"/api/v1/tunnels/",tunnel:e=>`/api/v1/tunnels/${e}/`,tunnelUsage:()=>"/api/v1/tunnelusage/",verificationCode:()=>"/api/v1/onetimeverificationcodes/",user:()=>"/api/v1/users/me/",sharedResources:e=>"/api/v1/sharedresources/?"+a()(r()(e),e=>e.join("=")).join("&"),sharedResource:e=>`/api/v1/sharedresources/${e}/`,printerDiscovery:()=>"/api/v1/printer_discovery/",printerEvents:()=>"/api/v1/printer_events/",notificationPlugins:()=>"/api/v1/notification_settings/available_plugins/",notificationChannels:()=>"/api/v1/notification_settings/",updateNotificationChannel:e=>`/api/v1/notification_settings/${e}/`,testNotificationChannel:e=>`/api/v1/notification_settings/${e}/send_test_message/`,printerControl:e=>`/printers/${e}/control/`,printerWebSocket:e=>`/ws/web/${e}/`,printerSharedWebSocket:e=>`/ws/share_token/web/${e}/`,printerWizard:e=>"/printers/wizard/?printerId="+e,gcodeFile:e=>`/api/v1/g_code_files/${e}/`,gcodeFiles:()=>"/api/v1/g_code_files/",gcodeFolder:e=>`/api/v1/g_code_folders/${e}/`,gcodeFolders:()=>"/api/v1/g_code_folders/",gcode:e=>`/api/v1/g_code_files/${e}/`}},ca14:function(e,t,i){e.exports=i.p+"img/octoapp.webp"},ccbb:function(e,t,i){"use strict";i("140e")},ccf6:function(e,t){},d1d5:function(e,t,i){e.exports=i.p+"img/generic-app.png"},d337:function(e,t,i){},d3c7:function(e,t,i){},d5e6:function(e,t,i){},d689:function(e,t,i){},d6fc:function(e,t,i){},d75f:function(e,t,i){},d764:function(e,t,i){"use strict";i("a67f")},da6c:function(e,t,i){"use strict";i("28eb")},db28:function(e,t,i){},df8a:function(e,t,i){"use strict";i("d337")},ea12:function(e,t,i){"use strict";i("c0f2")},f121:function(e,t,i){},f1f6:function(e,t,i){e.exports=i.p+"img/plugin_verification_code.png"},f23d:function(e,t,i){e.exports=i.p+"img/vacation.gif"},f394:function(e,t,i){"use strict";i("7ca1")},f444:function(e,t,i){},f74a:function(e,t,i){},feae:function(e,t,i){},ff7a:function(e,t,i){"use strict";i("4bc7")},ffb3:function(e,t,i){}});
//# sourceMappingURL=root.js.map